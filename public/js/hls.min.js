!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Hls=t():e.Hls=t()}(this,function(){return function(e){function t(s){if(n[s])return n[s].exports;var o=n[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=27)}([function(e,t,n){"use strict";function s(){}function a(e,t){return t="["+e+"] > "+t}function r(e){var t=self.console[e];return t?function(){for(var o=arguments.length,n=Array(o),s=0;s<o;s++)n[s]=arguments[s];n[0]&&(n[0]=a(e,n[0])),t.apply(self.console,n)}:s}function c(e){for(var n=arguments.length,s=Array(n>1?n-1:0),t=1;t<n;t++)s[t-1]=arguments[t];s.forEach(function(t){o[t]=e[t]?e[t].bind(e):r(t)})}n.d(t,"a",function(){return d}),n.d(t,"b",function(){return u});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i={trace:s,debug:s,log:s,warn:s,info:s,error:s},o=i,d=function(e){if(!0===e||"object"===(void 0===e?"undefined":l(e))){c(e,"debug","log","info","warn","error");try{o.log()}catch{o=i}}else o=i},u=o},function(e,t){"use strict";var s={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"};t.a=s},function(e,t,n){"use strict";n.d(t,"b",function(){return s}),n.d(t,"a",function(){return o});var s={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},o={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),s=n(2),a=n(1),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=new Set(["hlsEventGeneric","hlsHandlerDestroying","hlsHandlerDestroyed"]),l=function(){function e(t){o(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var s=arguments.length,i=Array(s>1?s-1:0),n=1;n<s;n++)i[n-1]=arguments[n];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}return e.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},e.prototype.onHandlerDestroying=function(){},e.prototype.onHandlerDestroyed=function(){},e.prototype.isEventHandler=function(){return"object"===r(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},e.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(c.has(e))throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)},this)},e.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},e.prototype.onEvent=function(e,t){this.onEventGeneric(e,t)},e.prototype.onEventGeneric=function(e,t){var n=function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)};try{n.call(this,e,t).call()}catch(t){i.b.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(a.a.ERROR,{type:s.b.OTHER_ERROR,details:s.a.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}();t.a=l},function(e){!function(){var s=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^/;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,o=/^([^/;?#]*)(.*)$/,i=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,n={buildAbsoluteURL:function(e,t,s){if(s=s||{},e=e.trim(),!(t=t.trim())){if(!s.alwaysNormalize)return e;if(c=this.parseURL(e),!a)throw new Error("Error trying to parse base URL.");return c.path=n.normalizePath(c.path),n.buildURLFromParts(c)}if(i=this.parseURL(t),!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return s.alwaysNormalize?(i.path=n.normalizePath(i.path),n.buildURLFromParts(i)):t;if(a=this.parseURL(e),!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]&&(l=o.exec(a.path),a.netLoc=l[1],a.path=l[2]),a.netLoc&&!a.path&&(a.path="/"),r={scheme:a.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment},!i.netLoc&&(r.netLoc=a.netLoc,"/"!==i.path[0]))if(i.path){var i,a,r,c,l,d=a.path,u=d.substring(0,d.lastIndexOf("/")+1)+i.path;r.path=n.normalizePath(u)}else r.path=a.path,i.params||(r.params=a.params,i.query||(r.query=a.query));return null===r.path&&(r.path=s.alwaysNormalize?n.normalizePath(i.path):i.path),n.buildURLFromParts(r)},parseURL:function(e){var t=s.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(i,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=n}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"b",function(){return i});var s=function(){function e(){o(this,e)}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,n){for(var o=n,s=0;e.isHeader(t,n);)s+=10,s+=e._readSize(t,n+6),e.isFooter(t,n+10)&&(s+=10),n+=s;if(s>0)return t.subarray(o,o+s)},e._readSize=function(e,t){var n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3]},e.getTimeStamp=function(t){for(var s,o=e.getID3Frames(t),n=0;n<o.length;n++)if(s=o[n],e.isTimeStampFrame(s))return e._readTimeStamp(s)},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var s=String.fromCharCode(t[0],t[1],t[2],t[3]),n=e._readSize(t,4);return{type:s,size:n,data:t.subarray(10,10+n)}},e.getID3Frames=function(t){for(var s,o,a,r,n=0,i=[];e.isHeader(t,n);){a=e._readSize(t,n+6),n+=10;for(r=n+a;n+8<r;)s=e._getFrameData(t.subarray(n)),o=e._decodeFrame(s),o&&i.push(o),n+=s.size+10;e.isFooter(t,n)&&(n+=10)}return i},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"T"===t.type[0]?e._decodeTextFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):void 0},e._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),s=1&t[3],n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,s&&(n+=47721858.84),Math.round(n)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var n=e._utf8ArrayToStr(t.data,!0),s=new Uint8Array(t.data.subarray(n.length+1));return{key:t.type,info:n,data:s.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var o,i,n=1,s=e._utf8ArrayToStr(t.data.subarray(n));return n+=s.length+1,o=e._utf8ArrayToStr(t.data.subarray(n)),{key:t.type,info:s,data:o}}return i=e._utf8ArrayToStr(t.data.subarray(1)),{key:t.type,data:i}}},e._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var o,i,n=1,s=e._utf8ArrayToStr(t.data.subarray(n));return n+=s.length+1,o=e._utf8ArrayToStr(t.data.subarray(n)),{key:t.type,info:s,data:o}}return i=e._utf8ArrayToStr(t.data),{key:t.type,data:i}},e._utf8ArrayToStr=function(e){for(var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.length,t=void 0,o=void 0,i=void 0,n="",s=0;s<r;){if(0===(t=e[s++])&&a)return n;if(0!==t&&3!==t)switch(t>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(t);break;case 12:case 13:o=e[s++],n+=String.fromCharCode((31&t)<<6|63&o);break;case 14:o=e[s++],i=e[s++],n+=String.fromCharCode((15&t)<<12|(63&o)<<6|(63&i)<<0)}}return n},e}(),i=s._utf8ArrayToStr;t.a=s},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(4),i=n.n(o),a=n(16),r=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),c=function(){function e(){var t;s(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this._elementaryStreams=(t={},t[e.ElementaryStreamTypes.AUDIO]=!1,t[e.ElementaryStreamTypes.VIDEO]=!1,t)}return e.prototype.addElementaryStream=function(e){this._elementaryStreams[e]=!0},e.prototype.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},e.prototype.createInitializationVector=function(e){for(var n=new Uint8Array(16),t=12;t<16;t++)n[t]=e>>8*(15-t)&255;return n},e.prototype.fragmentDecryptdataFromLevelkey=function(e,t){var n=e;return e&&e.method&&e.uri&&!e.iv&&(n=new a.a,n.method=e.method,n.baseuri=e.baseuri,n.reluri=e.reluri,n.iv=this.createInitializationVector(t)),n},r(e,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=i.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var t,n,e=[];return this.rawByteRange&&(t=this.rawByteRange.split("@",2),1===t.length?(n=this.lastByteRangeEndOffset,e[0]=n||0):e[0]=parseInt(t[1]),e[1]=parseInt(t[0])+e[0],this._byteRange=e),e}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}],[{key:"ElementaryStreamTypes",get:function(){return{AUDIO:"audio",VIDEO:"video"}}}]),e}();t.a=c},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return s}),n.d(t,"b",function(){return l});var i=n(3),o=n(1),s={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},l=function(e){function t(n){a(this,t);var s=r(this,e.call(this,n,o.a.BUFFER_APPENDED,o.a.FRAG_BUFFERED,o.a.FRAG_LOADED));return s.bufferPadding=.2,s.fragments=Object.create(null),s.timeRanges=Object.create(null),s.config=n.config,s}return c(t,e),t.prototype.destroy=function(){this.fragments=null,this.timeRanges=null,this.config=null,i.a.prototype.destroy.call(this),e.prototype.destroy.call(this)},t.prototype.getBufferedFrag=function(e,t){var o,n=this.fragments,s=Object.keys(n).filter(function(s){var i,o=n[s];return o.body.type===t&&!!o.buffered&&(i=o.body,i.startPTS<=e&&e<=i.endPTS)});return 0===s.length?null:(o=s.pop(),n[o].body)},t.prototype.detectEvictedFragments=function(e,t){var n=this,s=void 0,o=void 0;Object.keys(this.fragments).forEach(function(i){var a,c,r=n.fragments[i];if(!0===r.buffered&&(c=r.range[e],c)){s=c.time;for(a=0;a<s.length;a++)if(o=s[a],!1===n.isTimeBuffered(o.startPTS,o.endPTS,t)){n.removeFragment(r.body);break}}})},t.prototype.detectPartialFragments=function(e){var n=this,s=this.getFragmentKey(e),t=this.fragments[s];t&&(t.buffered=!0,Object.keys(this.timeRanges).forEach(function(s){if(!0===e.hasElementaryStream(s)){var o=n.timeRanges[s];t.range[s]=n.getBufferedTimes(e.startPTS,e.endPTS,o)}}))},t.prototype.getBufferedTimes=function(e,t,n){for(var i=[],o=void 0,a=void 0,r=!1,s=0;s<n.length;s++){if(o=n.start(s)-this.bufferPadding,a=n.end(s)+this.bufferPadding,e>=o&&t<=a){i.push({startPTS:Math.max(e,n.start(s)),endPTS:Math.min(t,n.end(s))});break}if(e<a&&t>o)i.push({startPTS:Math.max(e,n.start(s)),endPTS:Math.min(t,n.end(s))}),r=!0;else if(t<=o)break}return{time:i,partial:r}},t.prototype.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.sn},t.prototype.getPartialFragment=function(e){var t=this,n=void 0,s=void 0,o=void 0,i=null,a=0;return Object.keys(this.fragments).forEach(function(r){var c=t.fragments[r];t.isPartial(c)&&(s=c.body.startPTS-t.bufferPadding,o=c.body.endPTS+t.bufferPadding,e>=s&&e<=o&&(n=Math.min(e-s,o-e),a<=n&&(i=c.body,a=n)))}),i},t.prototype.getState=function(e){var o=this.getFragmentKey(e),t=this.fragments[o],n=s.NOT_LOADED;return void 0!==t&&(n=t.buffered?!0===this.isPartial(t)?s.PARTIAL:s.OK:s.APPENDING),n},t.prototype.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},t.prototype.isTimeBuffered=function(e,t,n){for(var o=void 0,i=void 0,s=0;s<n.length;s++){if(o=n.start(s)-this.bufferPadding,i=n.end(s)+this.bufferPadding,e>=o&&t<=i)return!0;if(t<=o)return!1}return!1},t.prototype.onFragLoaded=function(e){if(t=e.frag,!isNaN(t.sn)){var t,n=this.getFragmentKey(t),s={body:t,range:Object.create(null),buffered:!1};this.fragments[n]=s}},t.prototype.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(e){var n=t.timeRanges[e];t.detectEvictedFragments(e,n)})},t.prototype.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},t.prototype.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},t.prototype.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},t.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},t}(i.a)},function(e,t){"use strict";var s={search:function(e,t){for(var a,s=0,o=e.length-1,n=null,i=null;s<=o;)if(n=(s+o)/2|0,i=e[n],a=t(i),a>0)s=n+1;else{if(!(a<0))return i;o=n-1}return null}};t.a=s},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return o});var o=function(){function e(){s(this,e)}return e.isBuffered=function(e,t){try{if(e)for(var s=e.buffered,n=0;n<s.length;n++)if(t>=s.start(n)&&t<=s.end(n))return!0}catch{}return!1},e.bufferInfo=function(e,t,n){try{if(e){var o=e.buffered,i=[],s=void 0;for(s=0;s<o.length;s++)i.push({start:o.start(s),end:o.end(s)});return this.bufferedInfo(i,t,n)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,n){var i,r,d,u,o=[],c=void 0,l=void 0,a=void 0,h=void 0,s=void 0;for(e.sort(function(e,t){var n=e.start-t.start;return n||t.end-e.end}),s=0;s<e.length;s++)r=o.length,r?(d=o[r-1].end,e[s].start-d<n?e[s].end>d&&(o[r-1].end=e[s].end):o.push(e[s])):o.push(e[s]);for(s=0,c=0,l=a=t;s<o.length;s++)if(i=o[s].start,u=o[s].end,t+n>=i&&t<u)l=i,a=u,c=a-t;else if(t+n<i){h=i;break}return{len:c,start:l,end:a,nextStart:h}},e}()},function(e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(e){return"function"==typeof e}function a(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((n=arguments[1])instanceof Error)throw n;var t,n,a,r,c,l,d=new Error('Uncaught, unspecified "error" event. ('+n+")");throw d.context=n,d}if(t=this._events[e],i(t))return!1;if(s(t))switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),t.apply(this,a)}else if(o(t))for(a=Array.prototype.slice.call(arguments,1),c=t.slice(),l=c.length,r=0;r<l;r++)c[r].apply(this,a);return!0},n.prototype.addListener=function(e,t){var a;if(!s(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,s(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(a=i(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[e].length>a&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),o||(o=!0,t.apply(this,arguments))}if(!s(t))throw TypeError("listener must be a function");var o=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,a,r;if(!s(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],r=n.length,a=-1,n===t||s(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(i=r;i-- >0;)if(n[i]===t||n[i].listener&&n[i].listener===t){a=i;break}if(a<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(n in this._events)"removeListener"!==n&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events={},this}if(t=this._events[e],s(t))this.removeListener(e,t);else if(t)for(var t,n;t.length;)this.removeListener(e,t[t.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?s(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(s(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=n(34),r=n(35),c=n(36),o=n(2),s=n(0),l=function(){function e(t,n){var s,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.removePKCS7Padding,a=void 0===o||o;if(i(this,e),this.logEnabled=!0,this.observer=t,this.config=n,this.removePKCS7Padding=a,a)try{s=crypto||self.crypto,this.subtle=s.subtle||s.webkitSubtle}catch{}this.disableWebCrypto=!this.subtle}return e.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},e.prototype.decrypt=function(e,t,n,o){var i,l,d=this;this.disableWebCrypto&&this.config.enableSoftwareAES?(this.logEnabled&&(s.b.log("JS AES decrypt"),this.logEnabled=!1),i=this.decryptor,i||(this.decryptor=i=new c.a),i.expandKey(t),o(i.decrypt(e,0,n,this.removePKCS7Padding))):(this.logEnabled&&(s.b.log("WebCrypto AES decrypt"),this.logEnabled=!1),l=this.subtle,this.key!==t&&(this.key=t,this.fastAesKey=new r.a(l,t)),this.fastAesKey.expandKey().then(function(s){new a.a(l,n).decrypt(e,s).catch(function(s){d.onWebCryptoError(s,e,t,n,o)}).then(function(e){o(e)})}).catch(function(s){d.onWebCryptoError(s,e,t,n,o)}))},e.prototype.onWebCryptoError=function(e,t,n,i,a){this.config.enableSoftwareAES?(s.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,n,i,a)):(s.b.error("decrypting error : "+e.message),this.observer.trigger(Event.ERROR,{type:o.b.MEDIA_ERROR,details:o.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},e.prototype.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}();t.a=l},function(e,t){"use strict";function s(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}t.a=s},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(3),r=function(e){function t(n){s(this,t);for(var i,r=arguments.length,c=Array(r>1?r-1:0),a=1;a<r;a++)c[a-1]=arguments[a];return i=o(this,e.call.apply(e,[this,n].concat(c))),i._tickInterval=null,i._tickTimer=null,i._tickCallCount=0,i._boundTick=i.tick.bind(i),i}return i(t,e),t.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.prototype.hasInterval=function(){return!!this._tickInterval},t.prototype.hasNextTick=function(){return!!this._tickTimer},t.prototype.setInterval=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,e),!0)}),t.prototype.clearInterval=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)}),t.prototype.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.prototype.tick=function(){1===++this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},t.prototype.doTick=function(){},t}(a.a);t.a=r},function(e,t,n){"use strict";function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=n(1),l=n(3),i=n(2),a=n(0),h=n(15),r=n(28),m=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),s={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},c={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},p=function(e){function t(n){u(this,t);var s=f(this,e.call(this,n,o.a.MANIFEST_LOADING,o.a.LEVEL_LOADING,o.a.AUDIO_TRACK_LOADING,o.a.SUBTITLE_TRACK_LOADING));return s.loaders={},s}return d(t,e),t.canHaveQualityLevels=function(e){return e!==s.AUDIO_TRACK&&e!==s.SUBTITLE_TRACK},t.mapContextToLevelType=function(e){switch(e.type){case s.AUDIO_TRACK:return c.AUDIO;case s.SUBTITLE_TRACK:return c.SUBTITLE;default:return c.MAIN}},t.getResponseUrl=function(e,t){var n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n},t.prototype.createInternalLoader=function(e){var t=this.hls.config,s=t.pLoader,o=t.loader,i=s||o,n=new i(t);return e.loader=n,this.loaders[e.type]=n,n},t.prototype.getInternalLoader=function(e){return this.loaders[e.type]},t.prototype.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.prototype.destroyInternalLoaders=function(){for(e in this.loaders){var e,t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.prototype.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},t.prototype.onManifestLoading=function(e){this.load(e.url,{type:s.MANIFEST})},t.prototype.onLevelLoading=function(e){this.load(e.url,{type:s.LEVEL,level:e.level,id:e.id})},t.prototype.onAudioTrackLoading=function(e){this.load(e.url,{type:s.AUDIO_TRACK,id:e.id})},t.prototype.onSubtitleTrackLoading=function(e){this.load(e.url,{type:s.SUBTITLE_TRACK,id:e.id})},t.prototype.load=function(e,t){if(n=this.hls.config,o=this.getInternalLoader(t),o){if(c=o.context,c&&c.url===e)return a.b.trace("playlist request ongoing"),!1;a.b.warn("aborting previous loader for type: "+t.type),o.abort()}var n,o,c,u,h,i=void 0,r=void 0,l=void 0,d=void 0;switch(t.type){case s.MANIFEST:i=n.manifestLoadingMaxRetry,r=n.manifestLoadingTimeOut,l=n.manifestLoadingRetryDelay,d=n.manifestLoadingMaxRetryTimeout;break;case s.LEVEL:i=0,r=n.levelLoadingTimeOut;break;default:i=n.levelLoadingMaxRetry,r=n.levelLoadingTimeOut,l=n.levelLoadingRetryDelay,d=n.levelLoadingMaxRetryTimeout,a.b.log("Playlist loader for "+t.type+" "+(t.level||t.id))}return o=this.createInternalLoader(t),t.url=e,t.responseType=t.responseType||"",u=void 0,h=void 0,u={timeout:r,maxRetry:i,retryDelay:l,maxRetryDelay:d},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},o.load(t,u,h),!0},t.prototype.loadsuccess=function(e,t,n){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(n.isSidxRequest)return this._handleSidxRequest(e,n),void this._handlePlaylistLoaded(e,t,n,s);if(this.resetInternalLoader(n.type),o=e.data,t.tload=performance.now(),0!==o.indexOf("#EXTM3U"))return void this._handleManifestParsingError(e,n,"no EXTM3U delimiter",s);o.indexOf("#EXTINF:")>0||o.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,n,s):this._handleMasterPlaylist(e,t,n,s)},t.prototype.loaderror=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,n)},t.prototype.loadtimeout=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,n,!0)},t.prototype._handleMasterPlaylist=function(e,n,s,i){var h,m=this.hls,u=e.data,l=t.getResponseUrl(e,s),c=r.a.parseMasterPlaylist(u,l);if(!c.length)return void this._handleManifestParsingError(e,s,"no level found in manifest",i);var f=c.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),d=r.a.parseMasterPlaylistMedia(u,l,"AUDIO",f),p=r.a.parseMasterPlaylistMedia(u,l,"SUBTITLES");d.length&&(h=!1,d.forEach(function(e){e.url||(h=!0)}),!1===h&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(a.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),d.unshift({type:"main",name:"main"}))),m.trigger(o.a.MANIFEST_LOADED,{levels:c,audioTracks:d,subtitles:p,url:l,stats:n,networkDetails:i})},t.prototype._handleTrackOrLevelPlaylist=function(e,n,i,a){var m,f,p=this.hls,l=i.id,d=i.level,h=i.type,u=t.getResponseUrl(e,i),g=isNaN(d)?isNaN(l)?0:l:d,v=t.mapContextToLevelType(i),c=r.a.parseLevelPlaylist(e.data,u,g,v);if((c.tload=n.tload,h===s.MANIFEST)&&(m={url:u,details:c},p.trigger(o.a.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:u,stats:n,networkDetails:a})),n.tparsed=performance.now(),c.needSidxRanges)return f=c.initSegment.url,void this.load(f,{isSidxRequest:!0,type:h,level:d,levelDetails:c,id:l,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"});i.levelDetails=c,this._handlePlaylistLoaded(e,n,i,a)},t.prototype._handleSidxRequest=function(e,t){var n=h.a.parseSegmentIndex(new Uint8Array(e.data));n.references.forEach(function(e,n){var s=e.info,o=t.levelDetails.fragments[n];0===o.byteRange.length&&(o.rawByteRange=String(1+s.end-s.start)+"@"+String(s.start))}),t.levelDetails.initSegment.rawByteRange=String(n.moovEndOffset)+"@0"},t.prototype._handleManifestParsingError=function(e,t,n,s){this.hls.trigger(o.a.ERROR,{type:i.b.NETWORK_ERROR,details:i.a.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:n,networkDetails:s})},t.prototype._handleNetworkError=function(e,t){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=void 0,n=void 0,r=this.getInternalLoader(e);switch(e.type){case s.MANIFEST:a=c?i.a.MANIFEST_LOAD_TIMEOUT:i.a.MANIFEST_LOAD_ERROR,n=!0;break;case s.LEVEL:a=c?i.a.LEVEL_LOAD_TIMEOUT:i.a.LEVEL_LOAD_ERROR,n=!1;break;case s.AUDIO_TRACK:a=c?i.a.AUDIO_TRACK_LOAD_TIMEOUT:i.a.AUDIO_TRACK_LOAD_ERROR,n=!1;break;default:n=!1}r&&(r.abort(),this.resetInternalLoader(e.type)),this.hls.trigger(o.a.ERROR,{type:i.b.NETWORK_ERROR,details:a,fatal:n,url:r.url,loader:r,context:e,networkDetails:t})},t.prototype._handlePlaylistLoaded=function(e,n,i,a){var l=i.type,d=i.level,c=i.id,r=i.levelDetails;if(!r.targetduration)return void this._handleManifestParsingError(e,i,"invalid target duration",a);if(t.canHaveQualityLevels(i.type))this.hls.trigger(o.a.LEVEL_LOADED,{details:r,level:d||0,id:c||0,stats:n,networkDetails:a});else switch(l){case s.AUDIO_TRACK:this.hls.trigger(o.a.AUDIO_TRACK_LOADED,{details:r,id:c,stats:n,networkDetails:a});break;case s.SUBTITLE_TRACK:this.hls.trigger(o.a.SUBTITLE_TRACK_LOADED,{details:r,id:c,stats:n,networkDetails:a})}},m(t,null,[{key:"ContextType",get:function(){return s}},{key:"LevelType",get:function(){return c}}]),t}(l.a);t.a=p},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=n(0),s=n(1),o=Math.pow(2,32)-1,r=function(){function e(t,n){i(this,e),this.observer=t,this.remuxer=n}return e.prototype.resetTimeStamp=function(e){this.initPTS=e},e.prototype.resetInitSegment=function(t,n,o,i){if(t&&t.byteLength){var a,r=this.initData=e.parseInitSegment(t);n==null&&(n="mp4a.40.5"),o==null&&(o="avc1.42e01e"),a={},r.audio&&r.video?a.audiovideo={container:"video/mp4",codec:n+","+o,initSegment:i?t:null}:(r.audio&&(a.audio={container:"audio/mp4",codec:n,initSegment:i?t:null}),r.video&&(a.video={container:"video/mp4",codec:o,initSegment:i?t:null})),this.observer.trigger(s.a.FRAG_PARSING_INIT_SEGMENT,{tracks:a})}else n&&(this.audioCodec=n),o&&(this.videoCodec=o)},e.probe=function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<8|e[t+1];return n<0?65536+n:n},e.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return n<0?4294967296+n:n},e.writeUint32=function(e,t,n){e.data&&(t+=e.start,e=e.data),e[t]=n>>24,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},e.findBox=function(t,n){var o=[],s=void 0,r=void 0,d=void 0,i=void 0,c=void 0,l=void 0,a=void 0;if(t.data?(l=t.start,i=t.end,t=t.data):(l=0,i=t.byteLength),!n.length)return null;for(s=l;s<i;)r=e.readUint32(t,s),d=e.bin2str(t.subarray(s+4,s+8)),a=r>1?s+r:i,d===n[0]&&(1===n.length?o.push({data:t,start:s+8,end:a}):(c=e.findBox({data:t,start:s+8,end:a},n.slice(1)),c.length&&(o=o.concat(c)))),s=a;return o},e.parseSegmentIndex=function(t){var o,i,a,r,c,l,d,h,m,f=e.findBox(t,["moov"])[0],p=f?f.end:null,s=0,n=e.findBox(t,["sidx"]),u=void 0;if(!n||!n[0])return null;u=[],n=n[0],r=n.data[0],s=0===r?8:16,c=e.readUint32(n,s),s+=4,s+=0===r?8:16,s+=2,i=n.end+0,l=e.readUint16(n,s),s+=2;for(d=0;d<l;d++){if(o=s,h=e.readUint32(n,o),o+=4,a=2147483647&h,1===(2147483648&h)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");m=e.readUint32(n,o),o+=4,u.push({referenceSize:a,subsegmentDuration:m,info:{duration:m/c,start:i,end:i+a-1}}),i+=a,o+=4,s=o}return{earliestPresentationTime:0,timescale:c,version:r,referencesCount:l,references:u,moovEndOffset:p}},e.parseInitSegment=function(t){var n=[];return e.findBox(t,["moov","trak"]).forEach(function(t){if(o=e.findBox(t,["tkhd"])[0],o){var s,o,i,r,u,m,f,l=o.data[o.start],d=0===l?12:20,h=e.readUint32(o,d),c=e.findBox(t,["mdia","mdhd"])[0];c&&(l=c.data[c.start],d=0===l?12:20,u=e.readUint32(c,d),i=e.findBox(t,["mdia","hdlr"])[0],i&&(m=e.bin2str(i.data.subarray(i.start+8,i.start+12)),r={soun:"audio",vide:"video"}[m],r&&(s=e.findBox(t,["mdia","minf","stbl","stsd"]),s.length&&(s=s[0],f=e.bin2str(s.data.subarray(s.start+12,s.start+16)),a.b.log("MP4Demuxer:"+r+":"+f+" found")),n[h]={timescale:u,type:r},n[r]={timescale:u,id:h})))}}),n},e.getStartDTS=function(t,n){var o=void 0,i=void 0,s=void 0;return o=e.findBox(n,["moof","traf"]),i=[].concat.apply([],o.map(function(n){return e.findBox(n,["tfhd"]).map(function(s){var o=void 0,i=void 0;return o=e.readUint32(s,4),i=t[o].timescale||9e4,e.findBox(n,["tfdt"]).map(function(t){var s=void 0,n=void 0;return s=t.data[t.start],n=e.readUint32(t,4),1===s&&(n*=Math.pow(2,32),n+=e.readUint32(t,8)),n})[0]/i})})),s=Math.min.apply(null,i),isFinite(s)?s:0},e.offsetStartDTS=function(t,n,s){e.findBox(n,["moof","traf"]).map(function(n){return e.findBox(n,["tfhd"]).map(function(i){var r=e.readUint32(i,4),a=t[r].timescale||9e4;e.findBox(n,["tfdt"]).map(function(t){var i,r,c=t.data[t.start],n=e.readUint32(t,4);0===c?e.writeUint32(t,4,n-s*a):(n*=Math.pow(2,32),n+=e.readUint32(t,8),n-=s*a,n=Math.max(n,0),i=Math.floor(n/(o+1)),r=Math.floor(n%(o+1)),e.writeUint32(t,4,i),e.writeUint32(t,8,r))})})})},e.prototype.append=function(t,n,o,i){a=this.initData,a||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),a=this.initData);var a,l,c=void 0,r=this.initPTS;void 0===r&&(l=e.getStartDTS(a,t),this.initPTS=r=l-n,this.observer.trigger(s.a.INIT_PTS_FOUND,{initPTS:r})),e.offsetStartDTS(a,t,r),c=e.getStartDTS(a,t),this.remuxer.remux(a.audio,a.video,null,null,c,o,i,t)},e.prototype.destroy=function(){},e}();t.a=r},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(4),i=n.n(o),a=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),r=function(){function e(){s(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return a(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=i.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}();t.a=r},function(e,t,n){"use strict";function s(e,t){var n=i[t];return!!n&&!0===n[e.slice(0,4)]}function o(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}n.d(t,"b",function(){return s}),n.d(t,"a",function(){return o});var i={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}}},function(e,t,n){"use strict";function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=n(10),d=n.n(l),u=n(33),h=n.n(u),s=n(1),a=n(19),o=n(0),r=n(2),m=n(12),i=Object(m.a)(),f=function(){function e(t,n){c(this,e),this.hls=t,this.id=n;var u,m,p,g,l=this.observer=new d.a,f=t.config;if(l.trigger=function(e){for(var n=arguments.length,s=Array(n>1?n-1:0),t=1;t<n;t++)s[t-1]=arguments[t];l.emit.apply(l,[e,e].concat(s))},l.off=function(e){for(var n=arguments.length,s=Array(n>1?n-1:0),t=1;t<n;t++)s[t-1]=arguments[t];l.removeListener.apply(l,[e].concat(s))},u=function(e,n){n=n||{},n.frag=this.frag,n.id=this.id,t.trigger(e,n)}.bind(this),l.on(s.a.FRAG_DECRYPTED,u),l.on(s.a.FRAG_PARSING_INIT_SEGMENT,u),l.on(s.a.FRAG_PARSING_DATA,u),l.on(s.a.FRAG_PARSED,u),l.on(s.a.ERROR,u),l.on(s.a.FRAG_PARSING_METADATA,u),l.on(s.a.FRAG_PARSING_USERDATA,u),l.on(s.a.INIT_PTS_FOUND,u),p={mp4:i.isTypeSupported("video/mp4"),mpeg:i.isTypeSupported("audio/mpeg"),mp3:i.isTypeSupported('audio/mp4; codecs="mp3"')},g=navigator.vendor,f.enableWorker&&"undefined"!=typeof Worker){o.b.log("demuxing in webworker"),m=void 0;try{m=this.w=h()(46),this.onwmsg=this.onWorkerMessage.bind(this),m.addEventListener("message",this.onwmsg),m.onerror=function(e){t.trigger(s.a.ERROR,{type:r.b.OTHER_ERROR,details:r.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},m.postMessage({cmd:"init",typeSupported:p,vendor:g,id:n,config:JSON.stringify(f)})}catch{o.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),m&&URL.revokeObjectURL(m.objectURL),this.demuxer=new a.a(l,p,f,g),this.w=void 0}}else this.demuxer=new a.a(l,p,f,g)}return e.prototype.destroy=function(){var t,n,e=this.w;e?(e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null):(t=this.demuxer,t&&(t.destroy(),this.demuxer=null)),n=this.observer,n&&(n.removeAllListeners(),this.observer=null)},e.prototype.push=function(e,t,n,s,i,a,r,c){var h,m=this.w,f=isNaN(i.startDTS)?i.start:i.startDTS,p=i.decryptdata,l=this.frag,u=!l||i.cc!==l.cc,d=!l||i.level!==l.level,v=l&&i.sn===l.sn+1,g=!d&&v;u&&o.b.log(this.id+":discontinuity detected"),d&&o.b.log(this.id+":switch detected"),this.frag=i,m?m.postMessage({cmd:"demux",data:e,decryptdata:p,initSegment:t,audioCodec:n,videoCodec:s,timeOffset:f,discontinuity:u,trackSwitch:d,contiguous:g,duration:a,accurateTimeOffset:r,defaultInitPTS:c},e instanceof ArrayBuffer?[e]:[]):(h=this.demuxer,h&&h.push(e,p,t,n,s,f,u,d,g,a,r,c))},e.prototype.onWorkerMessage=function(e){var t=e.data,n=this.hls;switch(t.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case s.a.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data)}},e}();t.a=f},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(1),i=n(2),r=n(11),c=n(37),l=n(15),d=n(38),u=n(41),s=n(42),h=n(45),m=function(){function e(t,n,s,o){a(this,e),this.observer=t,this.typeSupported=n,this.config=s,this.vendor=o}return e.prototype.destroy=function(){var e=this.demuxer;e&&e.destroy()},e.prototype.push=function(e,t,n,s,i,a,c,l,d,u,h,m){if(e.byteLength>0&&t!=null&&null!=t.key&&"AES-128"===t.method){f=this.decrypter,f==null&&(f=this.decrypter=new r.a(this.observer,this.config));var f,g=this,p=void 0;try{p=performance.now()}catch{p=Date.now()}f.decrypt(e,t.key.buffer,t.iv.buffer,function(e){var r=void 0;try{r=performance.now()}catch{r=Date.now()}g.observer.trigger(o.a.FRAG_DECRYPTED,{stats:{tstart:p,tdecrypt:r}}),g.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),s,i,a,c,l,d,u,h,m)})}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),s,i,a,c,l,d,u,h,m)},e.prototype.pushDecrypted=function(e,t,n,a,r,m,f,p,g,v,b,j){if(y=this.demuxer,!y||(f||p)&&!this.probe(e)){for(var y,_,x,C,S,w=this.observer,E=this.typeSupported,k=this.config,A=[{demux:d.a,remux:s.a},{demux:l.a,remux:h.a},{demux:c.a,remux:s.a},{demux:u.a,remux:s.a}],O=0,M=A.length;O<M;O++)if(_=A[O],x=_.demux.probe,x(e)){S=this.remuxer=new _.remux(w,k,E,this.vendor),y=new _.demux(w,S,k,E),this.probe=x;break}if(!y)return void w.trigger(o.a.ERROR,{type:i.b.MEDIA_ERROR,details:i.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=y}C=this.remuxer,(f||p)&&(y.resetInitSegment(n,a,r,v),C.resetInitSegment()),f&&(y.resetTimeStamp(j),C.resetTimeStamp(j)),"function"==typeof y.setDecryptData&&y.setDecryptData(t),y.append(e,m,g,b)},e}();t.a=m},function(e,t,n){"use strict";function l(e,t,n,s){var a=void 0,o=void 0,l=void 0,d=void 0,i=void 0,u=navigator.userAgent.toLowerCase(),m=s,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return a=1+((192&t[n+2])>>>6),(o=(60&t[n+2])>>>2)>h.length-1?void e.trigger(Event.ERROR,{type:c.b.MEDIA_ERROR,details:c.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o}):(d=(1&t[n+2])<<2,d|=(192&t[n+3])>>>6,r.b.log("manifest codec:"+s+",ADTS data:type:"+a+",sampleingIndex:"+o+"["+h[o]+"Hz],channelConfig:"+d),/firefox/i.test(u)?o>=6?(a=5,i=new Array(4),l=o-3):(a=2,i=new Array(2),l=o):-1!==u.indexOf("android")?(a=2,i=new Array(2),l=o):(a=5,i=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&o>=6?l=o-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(o>=6&&1===d||/vivaldi/i.test(u))||!s&&1===d)&&(a=2,i=new Array(2)),l=o)),i[0]=a<<3,i[0]|=(14&o)>>1,i[1]|=(1&o)<<7,i[1]|=d<<3,5===a&&(i[1]|=(14&l)>>1,i[2]=(1&l)<<7,i[2]|=8,i[3]=0),{config:i,samplerate:h[o],channelCount:d,codec:"mp4a.40."+a,manifestCodec:m})}function s(e,t){return 255===e[t]&&240==(246&e[t+1])}function o(e,t){return 1&e[t+1]?7:9}function i(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function d(e,t){return!!(t+1<e.length&&s(e,t))}function u(e,t){if(t+1<e.length&&s(e,t)){var n,r=o(e,t),a=r;if(t+5<e.length&&(a=i(e,t)),n=t+a,n===e.length||n+1<e.length&&s(e,n))return!0}return!1}function h(e,t,n,s,o){if(!e.samplerate){var i=l(t,n,s,o);e.config=i.config,e.samplerate=i.samplerate,e.channelCount=i.channelCount,e.codec=i.codec,e.manifestCodec=i.manifestCodec,r.b.log("parsed codec:"+e.codec+",rate:"+i.samplerate+",nb channel:"+i.channelCount)}}function a(e){return 9216e4/e}function m(e,t,n,s,a){var r=void 0,c=void 0,l=void 0,d=e.length;if(r=o(e,t),c=i(e,t),(c-=r)>0&&t+r+c<=d)return l=n+s*a,{headerLength:r,frameLength:c,stamp:l}}function f(e,t,n,s,o){if(l=a(e.samplerate),i=m(t,n,s,o,l),i){var i,l,d=i.stamp,r=i.headerLength,c=i.frameLength,u={unit:t.subarray(n+r,n+r+c),pts:d,dts:d};return e.samples.push(u),e.len+=c,{sample:u,length:c+r}}}t.d=d,t.e=u,t.c=h,t.b=a,t.a=f;var r=n(0),c=n(2)},function(e,t){"use strict";var s={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,n,s,o){if(!(n+24>t.length)&&(i=this.parseHeader(t,n),i&&n+i.frameLength<=t.length)){var i,c=9e4*i.samplesPerFrame/i.sampleRate,a=s+o*c,r={unit:t.subarray(n,n+i.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=i.channelCount,e.samplerate=i.sampleRate,e.samples.push(r),e.len+=i.frameLength,{sample:r,length:i.frameLength}}},parseHeader:function(e,t){var n=e[t+1]>>3&3,o=e[t+1]>>1&3,i=e[t+2]>>4&15,r=e[t+2]>>2&3,f=e[t+2]>>1&1;if(1!==n&&0!==i&&15!==i&&3!==r){var m=3===n?3-o:3===o?3:4,d=1e3*s.BitratesMap[14*m+i-1],u=3===n?0:2===n?1:2,a=s.SamplingRateMap[3*u+r],h=e[t+3]>>6==3?1:2,l=s.SamplesCoefficients[n][o],c=s.BytesInSlot[o],p=8*l*c;return{sampleRate:a,channelCount:h,frameLength:parseInt(l*d/a+f,10)*c,samplesPerFrame:p}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var n,s=this.parseHeader(e,t),o=4;if(s&&s.frameLength&&(o=s.frameLength),n=t+o,n===e.length||n+1<e.length&&this.isHeaderPattern(e,n))return!0}return!1}};t.a=s},function(e,t,n){"use strict";function o(e,t,n){var o=e[t],i=e[n],a=i.startPTS;isNaN(a)?i.start=n>t?o.start+o.duration:Math.max(o.start-i.duration,0):n>t?(o.duration=a-o.start,o.duration<0&&s.b.warn("negative duration computed for frag "+o.sn+",level "+o.level+", there should be some duration drift between playlist and fragment!")):(i.duration=o.start-a,i.duration<0&&s.b.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!"))}function i(e,t,n,s,i,a){if(u=n,isNaN(t.startPTS)||(h=Math.abs(t.startPTS-n),isNaN(t.deltaPTS)?t.deltaPTS=h:t.deltaPTS=Math.max(h,t.deltaPTS),u=Math.max(n,t.startPTS),n=Math.min(n,t.startPTS),s=Math.max(s,t.endPTS),i=Math.min(i,t.startDTS),a=Math.max(a,t.endDTS)),m=n-t.start,t.start=t.startPTS=n,t.maxStartPTS=u,t.endPTS=s,t.startDTS=i,t.endDTS=a,t.duration=s-n,l=t.sn,!e||l<e.startSN||l>e.endSN)return 0;var l,u,h,m,d=void 0,c=void 0,r=void 0;for(d=l-e.startSN,c=e.fragments,c[d]=t,r=d;r>0;r--)o(c,r,r-1);for(r=d;r<c.length-1;r++)o(c,r,r+1);return e.PTSKnown=!0,m}function a(e,t){var n,o,a,f,h=Math.max(e.startSN,t.startSN)-t.startSN,m=Math.min(e.endSN,t.endSN)-t.startSN,l=t.startSN-e.startSN,d=e.fragments,c=t.fragments,u=0,r=void 0;if(t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment),m<h)return void(t.PTSKnown=!1);for(n=h;n<=m;n++)a=d[l+n],o=c[n],o&&a&&(u=a.cc-o.cc,isNaN(a.startPTS)||(o.start=o.startPTS=a.startPTS,o.endPTS=a.endPTS,o.duration=a.duration,o.backtracked=a.backtracked,o.dropped=a.dropped,r=o));if(u)for(s.b.log("discontinuity sliding from playlist, take drift into account"),n=0;n<c.length;n++)c[n].cc+=u;if(r)i(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS);else if(l>=0&&l<d.length){f=d[l].start;for(n=0;n<c.length;n++)c[n].start+=f}t.PTSKnown=e.PTSKnown}t.b=i,t.a=a;var s=n(0)},function(e,t){"use strict";var s={toString:function(e){for(var n="",s=e.length,t=0;t<s;t++)n+="["+e.start(t).toFixed(3)+","+e.end(t).toFixed(3)+"]";return n}};t.a=s},function(e,t,n){"use strict";function i(e,t){for(var n,o=null,s=0;s<e.length;s+=1)if(n=e[s],n&&n.cc===t){o=n;break}return o}function a(e,t){return d.a.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})}function r(e,t,n){var s=!1;return t&&t.details&&n&&(n.endCC>n.startCC||e&&e.cc<n.startCC)&&(s=!0),s}function c(e,t){var n,o=e.fragments,a=t.fragments;return!a.length||!o.length?void s.b.log("No fragments to align"):(n=i(o,a[0].cc),!n||n&&!n.startPTS?void s.b.log("No frag in previous level to align on"):n)}function o(e,t){t.fragments.forEach(function(t){if(t){var n=t.start+e;t.start=t.startPTS=n,t.endPTS=n+t.duration}}),t.PTSKnown=!0}function l(e,t,n){if(r(e,t,n)&&(i=c(t.details,n),i&&(s.b.log("Adjusting PTS using last level due to CC increase within current level"),o(i.start,n))),!1===n.PTSKnown&&t&&t.details&&t.details.fragments&&t.details.fragments.length){var i,l=t.details.programDateTime,d=n.programDateTime,a=(d-l)/1e3+t.details.fragments[0].start;isNaN(a)||(s.b.log("adjusting PTS using programDateTime delta, sliding:"+a.toFixed(3)),o(a,n))}}t.b=a,t.a=l;var d=n(8),s=n(0)},function(e,t){"use strict";function s(e,t){var n=null;try{n=new window.Event("addtrack")}catch{n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function o(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}t.b=s,t.a=o},function(e,t,n){"use strict";function i(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new h,this.regionList=[]}function d(e){function n(e,t,n,s){return 3600*(0|e)+60*(0|t)+(0|n)+(0|s)/1e3}var t=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return t?t[3]?n(t[1],t[2],t[3].replace(":",""),t[4]):t[1]>59?n(t[1],t[2],0,t[4]):n(0,t[1],t[2],t[4]):null}function a(){this.values=Object.create(null)}function r(e,t,n,s){o=s?e.split(s):[e];for(a in o)if("string"==typeof o[a]&&(i=o[a].split(n),2===i.length)){var o,i,a,r=i[0],c=i[1];t(r,c)}}function u(e,t,n){function c(){var t=d(e);if(null===t)throw new Error("Malformed timestamp: "+l);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function i(){e=e.replace(/^\s+/,"")}var l=e;if(i(),t.startTime=c(),i(),"-->"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+l);e=e.substr(3),i(),t.endTime=c(),i(),function(e,t){var c,l,i=new a;r(e,function(e,t){switch(e){case"region":for(a=n.length-1;a>=0;a--)if(n[a].id===t){i.set(e,n[a].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":var a,o=t.split(","),r=o[0];i.integer(e,r),i.percent(e,r)&&i.set("snapToLines",!1),i.alt(e,r,["auto"]),2===o.length&&i.alt("lineAlign",o[1],["start",s,"end"]);break;case"position":o=t.split(","),i.percent(e,o[0]),2===o.length&&i.alt("positionAlign",o[1],["start",s,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",s,"end","left","right"])}},/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical",""),c=i.get("line","auto"),"auto"===c&&-1===o.line&&(c=-1),t.line=c,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",s),l=i.get("position","auto"),"auto"===l&&50===o.position&&(l="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=l}(e,t)}function c(e){return e.replace(/<br(?: \/)?>/gi,`
`)}n.d(t,"b",function(){return c});var s,o,l=n(61),h=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};a.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var s=0;s<n.length;++s)if(t===n[s]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}},o=new l.a(0,0,0),s="middle"===o.align?"middle":"center",i.prototype={parse:function(e){function i(){var s,n=t.buffer,e=0;for(n=c(n);e<n.length&&``!==n[e]&&`
`!==n[e];)++e;return s=n.substr(0,e),``===n[e]&&++e,`
`===n[e]&&++e,t.buffer=n.substr(e),s}var n,s,o,a,t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{if(n=void 0,"INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;if(n=i(),o=n.match(/^()?WEBVTT([ \t].*)?$/),!o||!o[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(s=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:n=i(),t.state){case"HEADER":/:/.test(n)?function(e){r(e,function(e,t){switch(e){case"Region":console.log("parse region",t)}},/:/)}(n):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new l.a(0,0,""),t.state="CUE",-1===n.indexOf("-->")){t.cue.id=n;continue}case"CUE":try{u(n,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":if(a=-1!==n.indexOf("-->"),!n||a&&(s=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID");continue}}}catch{"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+=`

`,e.parse()),"INITIAL"===e.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return e.onflush&&e.onflush(),this}},t.a=i},function(e,t,n){"use strict";function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i,_=n(4),y=n.n(_),r=n(2),c=n(14),l=n(30),p=n(31),d=n(7),u=n(32),h=n(47),m=n(48),f=n(49),s=n(0),g=n(50),o=n(1),b=n(10),j=n.n(b),a=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}();n(70),i=function(){function e(){if(_=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},v(this,e),r=e.DefaultConfig,(t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(f in r)f in t||(t[f]=r[f]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(s.a)(t.debug),this.config=t,this._autoLevelCapping=-1,n=this.observer=new j.a,n.trigger=function(e){for(var s=arguments.length,o=Array(s>1?s-1:0),t=1;t<s;t++)o[t-1]=arguments[t];n.emit.apply(n,[e,e].concat(o))},n.off=function(e){for(var s=arguments.length,o=Array(s>1?s-1:0),t=1;t<s;t++)o[t-1]=arguments[t];n.removeListener.apply(n,[e].concat(o))},this.on=n.on.bind(n),this.off=n.off.bind(n),this.trigger=n.trigger.bind(n);var t,n,i,r,f,g,b,y,_,T=this.abrController=new t.abrController(this),F=new t.bufferController(this),M=new t.capLevelController(this),S=new t.fpsController(this),A=new c.a(this),O=new l.a(this),k=new p.a(this),C=new m.a(this),x=this.levelController=new h.a(this),a=new d.b(this),E=this.streamController=new u.a(this,a),w=[x,E],o=t.audioStreamController;o&&w.push(new o(this,a)),this.networkControllers=w,i=[A,O,k,T,F,M,S,C,a],(o=t.audioTrackController)&&(y=new o(this),this.audioTrackController=y,i.push(y)),(o=t.subtitleTrackController)&&(b=new o(this),this.subtitleTrackController=b,i.push(b)),(o=t.emeController)&&(g=new o(this),this.emeController=g,i.push(g)),[t.subtitleStreamController,t.timelineController].forEach(function(e){e&&i.push(new e(_))}),this.coreComponents=i}return e.isSupported=function(){return Object(f.a)()},a(e,null,[{key:"version",get:function(){return"0.9.1"}},{key:"Events",get:function(){return o.a}},{key:"ErrorTypes",get:function(){return r.b}},{key:"ErrorDetails",get:function(){return r.a}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:g.a},set:function(t){e.defaultConfig=t}}]),e.prototype.destroy=function(){s.b.log("destroy"),this.trigger(o.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},e.prototype.attachMedia=function(e){s.b.log("attachMedia"),this.media=e,this.trigger(o.a.MEDIA_ATTACHING,{media:e})},e.prototype.detachMedia=function(){s.b.log("detachMedia"),this.trigger(o.a.MEDIA_DETACHING),this.media=null},e.prototype.loadSource=function(e){e=y.a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),s.b.log("loadSource:"+e),this.url=e,this.trigger(o.a.MANIFEST_LOADING,{url:e})},e.prototype.startLoad=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;s.b.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},e.prototype.stopLoad=function(){s.b.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},e.prototype.swapAudioCodec=function(){s.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},e.prototype.recoverMediaError=function(){s.b.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)},a(e,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){s.b.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){s.b.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){s.b.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){s.b.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){s.b.log("set startLevel:"+e);var t=this;-1!==e&&(e=Math.max(e,t.minAutoLevel)),t.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){s.b.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var n=this,t=n.levels,s=n.config.minAutoBitrate,o=t?t.length:0,e=0;e<o;e++)if((t[e].realBitrate?Math.max(t[e].realBitrate,t[e].bitrate):t[e].bitrate)>s)return e;return 0}},{key:"maxAutoLevel",get:function(){var t=this,e=t.levels,n=t.autoLevelCapping;return-1===n&&e&&e.length?e.length-1:n}},{key:"nextAutoLevel",get:function(){var e=this;return Math.min(Math.max(e.abrController.nextAutoLevel,e.minAutoLevel),e.maxAutoLevel)},set:function(e){var t=this;t.abrController.nextAutoLevel=Math.max(t.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),e}(),t.default=i},function(e,t,n){"use strict";function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=n(4),d=n.n(u),o=n(6),a=n(16),s=n(29),i=n(0),m=n(17),r=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,c=/#EXT-X-MEDIA:(.*)/g,l=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),f=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,p=function(){function e(){h(this,e)}return e.findGroup=function(e,t){if(!e)return null;for(var s,o=null,n=0;n<e.length;n++)s=e[n],s.id===t&&(o=s);return o},e.convertAVC1ToAVCOTI=function(e){var t=void 0,n=e.split(".");return n.length>2?(t=n.shift()+".",t+=parseInt(n.shift()).toString(16),t+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return d.a.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,n){var o,i,a,l=[],c=void 0;for(r.lastIndex=0;null!=(c=r.exec(t));)o={},i=o.attrs=new s.a(c[1]),o.url=e.resolve(c[2],n),a=i.decimalResolution("RESOLUTION"),a&&(o.width=a.width,o.height=a.height),o.bitrate=i.decimalInteger("AVERAGE-BANDWIDTH")||i.decimalInteger("BANDWIDTH"),o.name=i.NAME,function(e,t){["video","audio"].forEach(function(n){var o,s=e.filter(function(e){return Object(m.b)(e,n)});s.length&&(o=s.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}),t[n+"Codec"]=o.length>0?o[0]:s[0],e=e.filter(function(e){return-1===s.indexOf(e)}))}),t.unknownCodecs=e}([].concat((i.CODECS||"").split(/[ ,]+/)),o),o.videoCodec&&-1!==o.videoCodec.indexOf("avc1")&&(o.videoCodec=e.convertAVC1ToAVCOTI(o.videoCodec)),l.push(o);return l},e.parseMasterPlaylistMedia=function(t,n,o){var i,a,l,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],d=void 0,u=[],h=0;for(c.lastIndex=0;null!==(d=c.exec(t));)i={},a=new s.a(d[1]),a.TYPE===o&&((i.groupId=a["GROUP-ID"],i.name=a.NAME,i.type=o,i.default="YES"===a.DEFAULT,i.autoselect="YES"===a.AUTOSELECT,i.forced="YES"===a.FORCED,a.URI&&(i.url=e.resolve(a.URI,n)),i.lang=a.LANGUAGE,i.name||(i.name=i.lang),r.length)&&(l=e.findGroup(r,i.groupId),i.audioCodec=l?l.codec:r[0].codec),i.id=h++,u.push(i));return u},e.parseLevelPlaylist=function(e,t,n,r){var h,b,y,_,O,E,k,w=0,v=0,d={type:null,version:null,url:t,fragments:[],live:!0,startSN:0},m=new a.a,j=0,p=null,c=new o.a,u=void 0,g=void 0;for(l.lastIndex=0;null!==(u=l.exec(e));)if(b=u[1],b)c.duration=parseFloat(b),y=(" "+u[2]).slice(1),c.title=y||null,c.tagList.push(y?["INF",b,y]:["INF",b]);else if(u[3])isNaN(c.duration)||(k=w++,c.type=r,c.start=v,c.levelkey=m,c.sn=k,c.level=n,c.cc=j,c.baseurl=t,c.relurl=(" "+u[3]).slice(1),d.programDateTime&&(p?c.rawProgramDateTime?c.pdt=Date.parse(c.rawProgramDateTime):c.pdt=p.pdt+1e3*p.duration:c.pdt=Date.parse(d.programDateTime),c.endPdt=c.pdt+1e3*c.duration),d.fragments.push(c),p=c,v+=c.duration,c=new o.a);else if(u[4])c.rawByteRange=(" "+u[4]).slice(1),p&&(_=p.byteRangeEndOffset,_&&(c.lastByteRangeEndOffset=_));else if(u[5])c.rawProgramDateTime=(" "+u[5]).slice(1),c.tagList.push(["PROGRAM-DATE-TIME",c.rawProgramDateTime]),void 0===d.programDateTime&&(d.programDateTime=new Date(new Date(Date.parse(u[5]))-1e3*v));else{for(u=u[0].match(f),g=1;g<u.length&&void 0===u[g];g++);switch(h=(" "+u[g+1]).slice(1),O=(" "+u[g+2]).slice(1),u[g]){case"#":c.tagList.push(O?[h,O]:[h]);break;case"PLAYLIST-TYPE":d.type=h.toUpperCase();break;case"MEDIA-SEQUENCE":w=d.startSN=parseInt(h);break;case"TARGETDURATION":d.targetduration=parseFloat(h);break;case"VERSION":d.version=parseInt(h);break;case"EXTM3U":break;case"ENDLIST":d.live=!1;break;case"DIS":j++,c.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":j=parseInt(h);break;case"KEY":var M=h,x=new s.a(M),C=x.enumeratedString("METHOD"),A=x.URI,F=x.hexadecimalInteger("IV");C&&(m=new a.a,A&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(C)>=0&&(m.method=C,m.baseuri=t,m.reluri=A,m.key=null,m.iv=F));break;case"START":var T=h,z=new s.a(T),S=z.decimalFloatingPoint("TIME-OFFSET");isNaN(S)||(d.startTimeOffset=S);break;case"MAP":E=new s.a(h),c.relurl=E.URI,c.rawByteRange=E.BYTERANGE,c.baseurl=t,c.level=n,c.type=r,c.sn="initSegment",d.initSegment=c,c=new o.a;break;default:i.b.warn("line parsed but not handled: "+u)}}return c=p,c&&!c.relurl&&(d.fragments.pop(),v-=c.duration),d.totalduration=v,d.averagetargetduration=v/d.fragments.length,d.endSN=w-1,d.startCC=d.fragments[0]?d.fragments[0].cc:0,d.endCC=j,!d.initSegment&&d.fragments.length&&d.fragments.every(function(e){return e.relurl.endsWith(".mp4")})&&(i.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),c=new o.a,c.relurl=d.fragments[0].relurl,c.baseurl=t,c.level=n,c.type=r,c.sn="initSegment",d.initSegment=c,d.needSidxRanges=!0),d},e}();t.a=p},function(e,t){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=/^(\d+)x(\d+)$/,s=/\s*(.+?)\s*=((?:".*?")|.*?)(?:,|$)/g,a=function(){function e(t){o(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])}return e.prototype.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.prototype.hexadecimalInteger=function(e){if(this[e]){t=(this[e]||"0x").slice(2),t=(1&t.length?"0":"")+t;for(var t,s=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)s[n]=parseInt(t.slice(2*n,2*n+2),16);return s}return null},e.prototype.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.prototype.decimalFloatingPoint=function(e){return parseFloat(this[e])},e.prototype.enumeratedString=function(e){return this[e]},e.prototype.decimalResolution=function(e){var t=i.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,n=void 0,o={};for(s.lastIndex=0;null!==(n=s.exec(e));)t=n[2],0===t.indexOf('"')&&t.lastIndexOf('"')===t.length-1&&(t=t.slice(1,-1)),o[n[1]]=t;return o},e}();t.a=a},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(1),c=n(3),o=n(2),l=n(0),d=function(e){function t(n){i(this,t);var o=a(this,e.call(this,n,s.a.FRAG_LOADING));return o.loaders={},o}return r(t,e),t.prototype.destroy=function(){var t,s,n=this.loaders;for(s in n)t=n[s],t&&t.destroy();this.loaders={},e.prototype.destroy.call(this)},t.prototype.onFragLoading=function(e){var t=e.frag,i=t.type,a=this.loaders,n=this.hls.config,h=n.fLoader,m=n.loader;t.loaded=0,s=a[i],s&&(l.b.warn("abort previous fragment loader for type: "+i),s.abort());var s=a[i]=t.loader=n.fLoader?new h(n):new m(n),o=void 0,r=void 0,c=void 0,o={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1},d=t.byteRangeStartOffset,u=t.byteRangeEndOffset;isNaN(d)||isNaN(u)||(o.rangeStart=d,o.rangeEnd=u),r={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},s.load(o,r,c)},t.prototype.loadsuccess=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=e.data,o=n.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(s.a.FRAG_LOADED,{payload:a,frag:o,stats:t,networkDetails:i})},t.prototype.loaderror=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(s.a.ERROR,{type:o.b.NETWORK_ERROR,details:o.a.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:i})},t.prototype.loadtimeout=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(s.a.ERROR,{type:o.b.NETWORK_ERROR,details:o.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:i})},t.prototype.loadprogress=function(e,t){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=t.frag;o.loaded=e.loaded,this.hls.trigger(s.a.FRAG_LOAD_PROGRESS,{frag:o,stats:e,networkDetails:i})},t}(c.a);t.a=d},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(1),i=n(3),o=n(2),l=n(0),d=function(e){function t(n){a(this,t);var o=r(this,e.call(this,n,s.a.KEY_LOADING));return o.loaders={},o.decryptkey=null,o.decrypturl=null,o}return c(t,e),t.prototype.destroy=function(){for(t in this.loaders){var t,e=this.loaders[t];e&&e.destroy()}this.loaders={},i.a.prototype.destroy.call(this)},t.prototype.onKeyLoading=function(e){var t,n=e.frag,o=n.type,a=this.loaders[o],r=n.decryptdata,i=r.uri;if(i!==this.decrypturl||null===this.decryptkey){t=this.hls.config,a&&(l.b.warn("abort previous key loader for type:"+o),a.abort()),n.loader=this.loaders[o]=new t.loader(t),this.decrypturl=i,this.decryptkey=null;var c=void 0,d=void 0,u=void 0,c={url:i,frag:n,responseType:"arraybuffer"},d={timeout:t.fragLoadingTimeOut,maxRetry:t.fragLoadingMaxRetry,retryDelay:t.fragLoadingRetryDelay,maxRetryDelay:t.fragLoadingMaxRetryTimeout},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};n.loader.load(c,d,u)}else this.decryptkey&&(r.key=this.decryptkey,this.hls.trigger(s.a.KEY_LOADED,{frag:n}))},t.prototype.loadsuccess=function(e,t,n){var o=n.frag;this.decryptkey=o.decryptdata.key=new Uint8Array(e.data),o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(s.a.KEY_LOADED,{frag:o})},t.prototype.loaderror=function(e,t){var n=t.frag,i=n.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(s.a.ERROR,{type:o.b.NETWORK_ERROR,details:o.a.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})},t.prototype.loadtimeout=function(e,t){var n=t.frag,i=n.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(s.a.ERROR,{type:o.b.NETWORK_ERROR,details:o.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},t}(i.a);t.a=d},function(e,t,n){"use strict";function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=n(8),r=n(9),m=n(18),i=n(1),d=n(7),c=n(6),p=n(14),u=n(22),g=n(23),a=n(2),s=n(0),l=n(24),b=n(13),j=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},_=function(e){function t(n,s){f(this,t);var a=y(this,e.call(this,n,i.a.MEDIA_ATTACHED,i.a.MEDIA_DETACHING,i.a.MANIFEST_LOADING,i.a.MANIFEST_PARSED,i.a.LEVEL_LOADED,i.a.KEY_LOADED,i.a.FRAG_LOADED,i.a.FRAG_LOAD_EMERGENCY_ABORTED,i.a.FRAG_PARSING_INIT_SEGMENT,i.a.FRAG_PARSING_DATA,i.a.FRAG_PARSED,i.a.ERROR,i.a.AUDIO_TRACK_SWITCHING,i.a.AUDIO_TRACK_SWITCHED,i.a.BUFFER_CREATED,i.a.BUFFER_APPENDED,i.a.BUFFER_FLUSHED));return a.fragmentTracker=s,a.config=n.config,a.audioCodecSwap=!1,a._state=o.STOPPED,a.stallReported=!1,a}return v(t,e),t.prototype.onHandlerDestroying=function(){this.stopLoad()},t.prototype.onHandlerDestroyed=function(){this.state=o.STOPPED,this.fragmentTracker=null},t.prototype.startLoad=function(e){if(this.levels){var t,n=this.lastCurrentTime,i=this.hls;(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested)&&(t=i.startLevel,-1===t&&(t=0,this.bitrateTest=!0),this.level=i.nextLoadLevel=t,this.loadedmetadata=!1),n>0&&-1===e&&(s.b.log("override startPosition with lastCurrentTime @"+n.toFixed(3)),e=n),this.state=o.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=o.STOPPED},t.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.clearInterval(),this.state=o.STOPPED,this.forceStartLoad=!1},t.prototype.doTick=function(){switch(this.state){case o.BUFFER_FLUSHING:this.fragLoadError=0;break;case o.IDLE:this._doTickIdle();break;case o.WAITING_LEVEL:e=this.levels[this.level],e&&e.details&&(this.state=o.IDLE);break;case o.FRAG_LOADING_WAITING_RETRY:var e,n=performance.now(),t=this.retryDate;(!t||n>=t||this.media&&this.media.seeking)&&(s.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=o.IDLE);break;case o.ERROR:case o.STOPPED:case o.FRAG_LOADING:case o.PARSING:case o.PARSED:case o.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},t.prototype._doTickIdle=function(){var e,t,a,c,d,u,h,m,f,g,p=this.hls,n=p.config,l=this.media;if(void 0!==this.levelLastLoaded&&(l||!this.startFragRequested&&n.startFragPrefetch)&&(d=void 0,d=this.loadedmetadata?l.currentTime:this.nextLoadPosition,u=p.nextLoadLevel,h=this.levels[u],h&&(m=h.bitrate,a=void 0,a=m?Math.max(8*n.maxBufferSize/m,n.maxBufferLength):n.maxBufferLength,a=Math.min(a,n.maxMaxBufferLength),c=r.a.bufferInfo(this.mediaBuffer?this.mediaBuffer:l,d,n.maxBufferHole),f=c.len,!(f>=a)))){if(s.b.trace("buffer length of "+f.toFixed(3)+" is below max of "+a.toFixed(3)+". checking for more payload ..."),this.level=p.nextLoadLevel=u,t=h.details,void 0===t||!0===t.live&&this.levelLastLoaded!==u)return void(this.state=o.WAITING_LEVEL);if(e=this.fragPrevious,!t.live&&e&&!e.backtracked&&e.sn===t.endSN&&!c.nextStart&&Math.min(l.duration,e.start+e.duration)-Math.max(c.end,e.start)<=Math.max(.2,e.duration))return g={},this.altAudio&&(g.type="video"),this.hls.trigger(i.a.BUFFER_EOS,g),void(this.state=o.ENDED);this._fetchPayloadOrEos(d,c,t)}},t.prototype._fetchPayloadOrEos=function(e,t,n){var l,d=this.fragPrevious,h=this.level,o=n.fragments,i=o.length;if(0!==i){var c=o[0].start,u=o[i-1].start+o[i-1].duration,r=t.end,a=void 0;if(n.initSegment&&!n.initSegment.data)a=n.initSegment;else if(n.live){{if(l=this.config.initialLiveManifestSize,i<l)return void s.b.warn("Can not start playback of a level, reason: not enough fragments "+i+" < "+l);if(null===(a=this._ensureFragmentAtLivePoint(n,r,c,u,d,o,i)))return}}else r<c&&(a=o[0]);a||(a=this._findFragment(c,d,i,o,r,u,n)),a&&this._loadFragmentOrKey(a,h,n,e,r)}},t.prototype._ensureFragmentAtLivePoint=function(e,t,n,o,i,a,r){var d,m,f,u=this.hls.config,l=this.media,c=void 0,p=void 0!==u.liveMaxLatencyDuration?u.liveMaxLatencyDuration:u.liveMaxLatencyDurationCount*e.targetduration;return t<Math.max(n-u.maxFragLookUpTolerance,o-p)&&(d=this.liveSyncPosition=this.computeLivePosition(n,e),s.b.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+d.toFixed(3)),t=d,l&&l.readyState&&l.duration>d&&(l.currentTime=d),this.nextLoadPosition=d),e.PTSKnown&&t>o&&l&&l.readyState?null:(this.startFragRequested&&!e.PTSKnown&&(i&&(e.programDateTime?c=this._findFragmentByPDT(a,i.endPdt+1):(m=i.sn+1,m>=e.startSN&&m<=e.endSN&&(f=a[m-e.startSN],i.cc===f.cc&&(c=f,s.b.log("live playlist, switching playlist, load frag with next SN: "+c.sn))),c||(c=h.a.search(a,function(e){return i.cc-e.cc}))&&s.b.log("live playlist, switching playlist, load frag with same CC: "+c.sn))),c||(c=a[Math.min(r-1,Math.round(r/2))],s.b.log("live playlist, switching playlist, unknown, load middle frag : "+c.sn))),c)},t.prototype._findFragmentByPDT=function(e,t){if(!e||void 0===t)return null;if(t<e[0].pdt)return null;if(t>=e[e.length-1].endPdt)return null;for(var s,n=0;n<e.length;++n)if(s=e[n],t<s.endPdt)return s;return null},t.prototype._findFragmentBySN=function(e,t,n,s){var c=this.hls.config,a=void 0,o=c.maxFragLookUpTolerance,i=e?t[e.sn-t[0].sn+1]:void 0,r=function(e){var t=Math.min(o,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=n?1:e.start-t>n&&e.start?-1:0};return n<s&&(n>s-o&&(o=0),a=i&&!r(i)?i:h.a.search(t,r)),a},t.prototype._findFragment=function(e,t,n,o,i,a,r){var f=this.hls.config,c=void 0,m=void 0;if(m=i<a?r.programDateTime?this._findFragmentByPDT(o,1e3*i+(r.programDateTime?Date.parse(r.programDateTime):0)-1e3*e):this._findFragmentBySN(t,o,i,a):o[n-1]){c=m;var h,d=c.sn-r.startSN,p=t&&c.level===t.level,u=o[d-1],l=o[d+1];t&&c.sn===t.sn&&(p&&!c.backtracked?c.sn<r.endSN?(h=t.deltaPTS,h&&h>f.maxBufferHole&&t.dropped&&d?(c=u,s.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(c=l,s.b.log("SN just loaded, load next one: "+c.sn))):c=null:c.backtracked&&(l&&l.backtracked?(s.b.warn("Already backtracked from fragment "+l.sn+", will not backtrack to fragment "+c.sn+". Loading fragment "+l.sn),c=l):(s.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),c.dropped=0,u?(c=u,c.backtracked=!0):d&&(c=null))))}return c},t.prototype._loadFragmentOrKey=function(e,t,n,a,r){if(e.decryptdata&&null!=e.decryptdata.uri&&null==e.decryptdata.key)s.b.log("Loading key for "+e.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t),this.state=o.KEY_LOADING,this.hls.trigger(i.a.KEY_LOADING,{frag:e});else{s.b.log("Loading "+e.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t+", currentTime:"+a.toFixed(3)+",bufferEnd:"+r.toFixed(3));var c=this.fragmentTracker.getState(e);this.fragCurrent=e,this.startFragRequested=!0,isNaN(e.sn)||e.bitrateTest||(this.nextLoadPosition=e.start+e.duration),e.backtracked||c===d.a.NOT_LOADED?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(i.a.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new m.a(this.hls,"main")),this.state=o.FRAG_LOADING):c===d.a.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)}},t.prototype.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,p.a.LevelType.MAIN)},t.prototype.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},t.prototype._checkFragmentChanged=function(){var n,o,s=void 0,e=void 0,t=this.media;t&&t.readyState&&!1===t.seeking&&(e=t.currentTime,e>t.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=e),r.a.isBuffered(t,e)?s=this.getBufferedFrag(e):r.a.isBuffered(t,e+.1)&&(s=this.getBufferedFrag(e+.1)),s)&&(n=s,n!==this.fragPlaying&&(this.hls.trigger(i.a.FRAG_CHANGED,{frag:n}),o=n.level,this.fragPlaying&&this.fragPlaying.level===o||this.hls.trigger(i.a.LEVEL_SWITCHED,{level:o}),this.fragPlaying=n))},t.prototype.immediateLevelSwitch=function(){if(s.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e,t=this.media,n=void 0;t?(n=t.paused,t.pause()):n=!0,this.previouslyPaused=n}e=this.fragCurrent,e&&e.loader&&e.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},t.prototype.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,r.a.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},t.prototype.nextLevelSwitch=function(){if(e=this.media,e&&e.readyState){var e,s,o=void 0,t=void 0,n=void 0;if(t=this.getBufferedFrag(e.currentTime),t&&t.startPTS>1&&this.flushMainBuffer(0,t.startPTS-1),e.paused)o=0;else{var a=this.hls.nextLoadLevel,r=this.levels[a],i=this.fragLastKbps;o=i&&this.fragCurrent?this.fragCurrent.duration*r.bitrate/(1e3*i)+1:0}(n=this.getBufferedFrag(e.currentTime+o))&&(n=this.followingBufferedFrag(n))&&(s=this.fragCurrent,s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(n.maxStartPTS,Number.POSITIVE_INFINITY))}},t.prototype.flushMainBuffer=function(e,t){this.state=o.BUFFER_FLUSHING;var n={startOffset:e,endOffset:t};this.altAudio&&(n.type="video"),this.hls.trigger(i.a.BUFFER_FLUSHING,n)},t.prototype.onMediaAttached=function(e){var n,t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended),n=this.config,this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition)},t.prototype.onMediaDetaching=function(){var t,e=this.media;e&&e.ended&&(s.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t=this.levels,t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},t.prototype.onMediaSeeking=function(){var t,i,a,n=this.media,e=n?n.currentTime:void 0,l=this.config;if(isNaN(e)||s.b.log("media seeking to "+e.toFixed(3)),a=this.mediaBuffer?this.mediaBuffer:n,i=r.a.bufferInfo(a,e,this.config.maxBufferHole),this.state===o.FRAG_LOADING){if(t=this.fragCurrent,0===i.len&&t){var c=l.maxFragLookUpTolerance,d=t.start-c,u=t.start+t.duration+c;e<d||e>u?(t.loader&&(s.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=o.IDLE):s.b.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===o.ENDED&&(0===i.len&&(this.fragPrevious=0),this.state=o.IDLE);n&&(this.lastCurrentTime=e),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=e),this.tick()},t.prototype.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;isNaN(t)||s.b.log("media seeked to "+t.toFixed(3)),this.tick()},t.prototype.onMediaEnded=function(){s.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},t.prototype.onManifestLoading=function(){s.b.log("trigger BUFFER_RESET"),this.hls.trigger(i.a.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},t.prototype.onManifestParsed=function(e){var n,o=!1,i=!1,t=void 0;e.levels.forEach(function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(o=!0),-1!==t.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=o&&i,this.audioCodecSwitch&&s.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1,n=this.config,(n.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(n.startPosition)},t.prototype.onLevelLoaded=function(e){var n,c,t=e.details,r=e.level,d=this.levels[this.levelLastLoaded],h=this.levels[r],m=t.totalduration,a=0;s.b.log("level "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+m),t.live?(c=h.details,c&&t.fragments.length>0?(u.a(c,t),a=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,c),t.PTSKnown&&!isNaN(a)?s.b.log("live playlist sliding:"+a.toFixed(3)):(s.b.log("live playlist - outdated PTS, unknown sliding"),Object(l.a)(this.fragPrevious,d,t))):(s.b.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,Object(l.a)(this.fragPrevious,d,t))):t.PTSKnown=!1,(h.details=t,this.levelLastLoaded=r,this.hls.trigger(i.a.LEVEL_UPDATED,{details:t,level:r}),!1===this.startFragRequested)&&((-1===this.startPosition||-1===this.lastCurrentTime)&&(n=t.startTimeOffset,isNaN(n)?t.live?(this.startPosition=this.computeLivePosition(a,t),s.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(n<0&&(s.b.log("negative start time offset "+n+", count from end of last fragment"),n=a+m+n),s.b.log("start time offset found in playlist, adjust startPosition to "+n),this.startPosition=n),this.lastCurrentTime=this.startPosition),this.nextLoadPosition=this.startPosition),this.state===o.WAITING_LEVEL&&(this.state=o.IDLE),this.tick()},t.prototype.onKeyLoaded=function(){this.state===o.KEY_LOADING&&(this.state=o.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){if(t=this.fragCurrent,c=e.frag,this.state===o.FRAG_LOADING&&t&&"main"===c.type&&c.level===t.level&&c.sn===t.sn){var a=e.stats,d=this.levels[t.level],n=d.details;if(s.b.log("Loaded  "+t.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t.level),this.bitrateTest=!1,this.stats=a,!0===c.bitrateTest&&this.hls.nextLoadLevel)this.state=o.IDLE,this.startFragRequested=!1,a.tparsed=a.tbuffered=performance.now(),this.hls.trigger(i.a.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),this.tick();else if("initSegment"===c.sn)this.state=o.IDLE,a.tparsed=a.tbuffered=performance.now(),n.initSegment.data=e.payload,this.hls.trigger(i.a.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),this.tick();else{this.state=o.PARSING;var t,c,l,p=n.totalduration,f=t.level,h=t.sn,r=this.config.defaultAudioCodec||d.audioCodec;this.audioCodecSwap&&(s.b.log("swapping playlist audio codec"),void 0===r&&(r=this.lastAudioCodec),r&&(r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,s.b.log("Parsing "+h+" of ["+n.startSN+" ,"+n.endSN+"],level "+f+", cc "+t.cc),l=this.demuxer,l||(l=this.demuxer=new m.a(this.hls,"main"));var u=this.media,g=u&&u.seeking,v=!g&&(n.PTSKnown||!n.live),b=n.initSegment?n.initSegment.data:[];l.push(e.payload,b,r,d.videoCodec,t,p,v,void 0)}}this.fragLoadError=0},t.prototype.onFragParsingInitSegment=function(e){if(r=this.fragCurrent,l=e.frag,r&&"main"===e.id&&l.sn===r.sn&&l.level===r.level&&this.state===o.PARSING){var n,r,l,d,u,a=e.tracks,c=void 0,t=void 0;(a.audio&&this.altAudio&&delete a.audio,t=a.audio)&&(n=this.levels[this.level].audioCodec,d=navigator.userAgent.toLowerCase(),n&&this.audioCodecSwap&&(s.b.log("swapping playlist audio codec"),n=-1!==n.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==t.metadata.channelCount&&-1===d.indexOf("firefox")&&(n="mp4a.40.5"),-1!==d.indexOf("android")&&"audio/mpeg"!==t.container&&(n="mp4a.40.2",s.b.log("Android: force audio codec to "+n)),t.levelCodec=n,t.id=e.id),t=a.video,t&&(t.levelCodec=this.levels[this.level].videoCodec,t.id=e.id),this.hls.trigger(i.a.BUFFER_CODECS,a);for(c in a)t=a[c],s.b.log("main track:"+c+",container:"+t.container+",codecs[level/parsed]=["+t.levelCodec+"/"+t.codec+"]"),u=t.initSegment,u&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(i.a.BUFFER_APPENDING,{type:c,data:u,parent:"main",content:"initSegment"}));this.tick()}},t.prototype.onFragParsingData=function(e){var t,a,l,d,m,r=this,n=this.fragCurrent,h=e.frag;if(n&&"main"===e.id&&h.sn===n.sn&&h.level===n.level&&("audio"!==e.type||!this.altAudio)&&this.state===o.PARSING){if(a=this.levels[this.level],t=n,isNaN(e.endPTS)&&(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),!0===e.hasAudio&&t.addElementaryStream(c.a.ElementaryStreamTypes.AUDIO),!0===e.hasVideo&&t.addElementaryStream(c.a.ElementaryStreamTypes.VIDEO),s.b.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(t.dropped=e.dropped,t.dropped)if(t.backtracked)s.b.warn("Already backtracked on this fragment, appending with the gap");else{if(l=a.details,!l||t.sn!==l.startSN)return s.b.warn("missing video frame(s), backtracking fragment"),this.fragmentTracker.removeFragment(t),t.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=o.IDLE,this.fragPrevious=t,void this.tick();s.b.warn("missing video frame(s) on first frag, appending with gap")}else t.backtracked=!1;m=u.b(a.details,t,e.startPTS,e.endPTS,e.startDTS,e.endDTS),d=this.hls,d.trigger(i.a.LEVEL_PTS_UPDATED,{details:a.details,level:this.level,drift:m,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(t){t&&t.length&&r.state===o.PARSING&&(r.appended=!0,r.pendingBuffering=!0,d.trigger(i.a.BUFFER_APPENDING,{type:e.type,data:t,parent:"main",content:"data"}))}),this.tick()}},t.prototype.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===o.PARSING&&(this.stats.tparsed=performance.now(),this.state=o.PARSED,this._checkAppendedParsed())},t.prototype.onAudioTrackSwitching=function(e){var t,n,a=!!e.url,r=e.id;a||(this.mediaBuffer!==this.media&&(s.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,t=this.fragCurrent,t.loader&&(s.b.log("switching to main audio track, cancel main fragment load"),t.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=o.IDLE),n=this.hls,n.trigger(i.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),n.trigger(i.a.AUDIO_TRACK_SWITCHED,{id:r}),this.altAudio=!1)},t.prototype.onAudioTrackSwitched=function(e){var t,o=e.id,n=!!this.hls.audioTracks[o].url;n&&(t=this.videoBuffer,t&&this.mediaBuffer!==t&&(s.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=t)),this.altAudio=n,this.tick()},t.prototype.onBufferCreated=function(e){var t,i,n=e.tracks,o=void 0,a=void 0,r=!1;for(t in n)i=n[t],"main"===i.id?(a=t,o=i,"video"===t&&(this.videoBuffer=n[t].buffer)):r=!0;r&&o?(s.b.log("alternate track found, use "+a+".buffered to schedule main fragment loading"),this.mediaBuffer=o.buffer):this.mediaBuffer=this.media},t.prototype.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==o.PARSING&&t!==o.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},t.prototype._checkAppendedParsed=function(){if(!(this.state!==o.PARSED||this.appended&&this.pendingBuffering)){var e,n,t=this.fragCurrent;t&&(n=this.mediaBuffer?this.mediaBuffer:this.media,s.b.log("main buffered : "+g.a.toString(n.buffered)),this.fragPrevious=t,e=this.stats,e.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*e.total/(e.tbuffered-e.tfirst)),this.hls.trigger(i.a.FRAG_BUFFERED,{stats:e,frag:t,id:"main"}),this.state=o.IDLE),this.tick()}},t.prototype.onError=function(e){var t,i,n=e.frag||this.fragCurrent;if(!n||"main"===n.type)switch(i=!!this.media&&r.a.isBuffered(this.media,this.media.currentTime)&&r.a.isBuffered(this.media,this.media.currentTime+.5),e.details){case a.a.FRAG_LOAD_ERROR:case a.a.FRAG_LOAD_TIMEOUT:case a.a.KEY_LOAD_ERROR:case a.a.KEY_LOAD_TIMEOUT:e.fatal||(this.fragLoadError+1<=this.config.fragLoadingMaxRetry?(t=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout),s.b.warn("mediaController: frag loading failed, retry in "+t+" ms"),this.retryDate=performance.now()+t,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=o.FRAG_LOADING_WAITING_RETRY):(s.b.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=o.ERROR));break;case a.a.LEVEL_LOAD_ERROR:case a.a.LEVEL_LOAD_TIMEOUT:this.state!==o.ERROR&&(e.fatal?(this.state=o.ERROR,s.b.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==o.WAITING_LEVEL||(this.state=o.IDLE));break;case a.a.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==o.PARSING&&this.state!==o.PARSED||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=o.IDLE):(s.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}},t.prototype._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,s.b.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},t.prototype._checkBuffer=function(){if(o=this.config,e=this.media,e&&0!==e.readyState){var e,t,o,i,a,c,n=e.currentTime,l=this.mediaBuffer?this.mediaBuffer:e,d=l.buffered;if(!this.loadedmetadata&&d.length)this.loadedmetadata=!0,this._seekToStartPos();else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else if(i=!(e.paused&&e.readyState>1||e.ended||0===e.buffered.length),t=performance.now(),n!==this.lastCurrentTime)this.stallReported&&(s.b.warn("playback not stuck anymore @"+n+", after "+Math.round(t-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,this.nudgeRetry=0;else if(i){if(!this.stalled)return void(this.stalled=t);a=r.a.bufferInfo(e,n,o.maxBufferHole),c=t-this.stalled,this._tryFixBufferStall(a,c)}}},t.prototype.onFragLoadEmergencyAborted=function(){this.state=o.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},t.prototype.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;e&&this.fragmentTracker.detectEvictedFragments(c.a.ElementaryStreamTypes.VIDEO,e.buffered),this.state=o.IDLE,this.fragPrevious=null},t.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},t.prototype.computeLivePosition=function(e,t){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-n)},t.prototype._tryFixBufferStall=function(e,t){var n,s=this.config,o=this.media,i=o.currentTime;this._reportStall(e.len),n=this.fragmentTracker.getPartialFragment(i),n&&this._trySkipBufferHole(n),e.len>.5&&t>1e3*s.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},t.prototype._reportStall=function(e){var t=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,s.b.warn("Playback stalling at @"+n.currentTime+" due to low buffer"),t.trigger(i.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t.prototype._trySkipBufferHole=function(e){for(var r,l=this.hls,t=this.media,n=t.currentTime,c=0,o=0;o<t.buffered.length;o++){if(r=t.buffered.start(o),n>=c&&n<r)return t.currentTime=Math.max(r,t.currentTime+.1),s.b.warn("skipping hole, adjusting currentTime from "+n+" to "+t.currentTime),this.stalled=null,void l.trigger(i.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+t.currentTime,frag:e});c=t.buffered.end(o)}},t.prototype._tryNudgeBuffer=function(){var o,e=this.config,r=this.hls,c=this.media,t=c.currentTime,n=(this.nudgeRetry||0)+1;this.nudgeRetry=n,n<e.nudgeMaxRetry?(o=t+n*e.nudgeOffset,s.b.log("adjust currentTime from "+t+" to "+o),c.currentTime=o,r.trigger(i.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_NUDGE_ON_STALL,fatal:!1})):(s.b.error("still stuck in high buffer @"+t+" after "+e.nudgeMaxRetry+", raise fatal error"),r.trigger(i.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.BUFFER_STALLED_ERROR,fatal:!0}))},t.prototype._seekToStartPos=function(){var e=this.media,t=e.currentTime,n=e.seeking?t:this.startPosition;t!==n&&(s.b.log("target start position not buffered, seek to buffered.start(0) "+n+" from current time "+t+" "),e.currentTime=n)},j(t,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,s.b.log("main stream:"+t+"->"+e),this.hls.trigger(i.a.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e,t=this.media;return t&&(e=this.getBufferedFrag(t.currentTime),e)?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(b.a);t.a=_},function(e,t,n){function s(e){function t(s){if(n[s])return n[s].exports;var o=n[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var s,n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t.oe=function(e){throw console.error(e),e},s=t(t.s=ENTRY_MODULE),s.default||s}function o(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function r(e,t,s){c={},c[s]=[];var r,c,l,u,d=t.toString(),h=d.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!h)return c;for(u=h[1],l=new RegExp(`(\\\\n|\\W)`+o(u)+a,"g");r=l.exec(d);)"dll-reference"!==r[3]&&c[s].push(r[3]);for(l=new RegExp("\\("+o(u)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+a,"g");r=l.exec(d);)e[r[2]]||(c[s].push(r[1]),e[r[2]]=n(r[1]).m),c[r[2]]=c[r[2]]||[],c[r[2]].push(r[4]);return c}function c(e){return Object.keys(e).reduce(function(t,n){return t||e[n].length>0},!1)}function l(e,t){for(var u,h,s={main:[t]},l={main:[]},d={main:{}};c(s);)for(h=Object.keys(s),u=0;u<h.length;u++){var n=h[u],f=s[n],a=f.pop();if(d[n]=d[n]||{},!d[n][a]&&e[n][a]){d[n][a]=!0,l[n]=l[n]||[],l[n].push(a);for(var m=r(e,e[n][a],n),i=Object.keys(m),o=0;o<i.length;o++)s[i[o]]=s[i[o]]||[],s[i[o]]=s[i[o]].concat(m[i[o]])}}return l}var i="[\\.|\\-|\\+|\\w|/|@]+",a="\\((/\\*.*?\\*/)?s?.*?("+i+").*?\\)";e.exports=function(e,t){t=t||{};var r,o={main:n.m},i=t.all?{main:Object.keys(o)}:l(o,e),a="";if(Object.keys(i).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;i[e][t];)t++;i[e].push(t),o[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+e+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+i[e].map(function(t){return JSON.stringify(t)+": "+o[e][t].toString()}).join(",")+`});
`}),a=a+"("+s.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+i.main.map(function(e){return JSON.stringify(e)+": "+o.main[e].toString()}).join(",")+"})(self);",r=new window.Blob([a],{type:"text/javascript"}),t.bare)return r;var u=window.URL||window.webkitURL||window.mozURL||window.msURL,c=u.createObjectURL(r),d=new window.Worker(c);return d.objectURL=c,d}},function(e,t){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(t,n){s(this,e),this.subtle=t,this.aesIV=n}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}();t.a=o},function(e,t){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(t,n){s(this,e),this.subtle=t,this.key=n}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}();t.a=o},function(e,t){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=e.byteLength,n=t&&new DataView(e).getUint8(t-1);return n?e.slice(0,t-n):e}var i=function(){function e(){s(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return e.prototype.uint8ArrayToUint32Array_=function(e){for(var s=new DataView(e),n=new Uint32Array(4),t=0;t<4;t++)n[t]=s.getUint32(4*t);return n},e.prototype.initTable=function(){var t,v=this.sBox,y=this.invSBox,a=this.subMix,j=a[0],b=a[1],u=a[2],g=a[3],c=this.invSubMix,p=c[0],f=c[1],m=c[2],h=c[3],s=new Uint32Array(256),n=0,i=0,o=0;for(o=0;o<256;o++)s[o]=o<128?o<<1:o<<1^283;for(o=0;o<256;o++){t=i^i<<1^i<<2^i<<3^i<<4,t=t>>>8^255&t^99,v[n]=t,y[t]=n;var r=s[n],d=s[r],l=s[d],e=257*s[t]^16843008*t;j[n]=e<<24|e>>>8,b[n]=e<<16|e>>>16,u[n]=e<<8|e>>>24,g[n]=e,e=16843009*l^65537*d^257*r^16843008*n,p[t]=e<<24|e>>>8,f[t]=e<<16|e>>>16,m[t]=e<<8|e>>>24,h[t]=e,n?(n=r^s[s[s[l^r]]],i^=s[s[i]]):n=i=1}},e.prototype.expandKey=function(e){for(var c=this.uint8ArrayToUint32Array_(e),m=!0,d=0;d<c.length&&m;)m=c[d]===this.key[d],d++;if(!m){if(this.key=c,s=this.keySize=c.length,4!==s&&6!==s&&8!==s)throw new Error("Invalid aes key size="+s);var s,a=this.ksRows=4*(s+6+1),n=void 0,i=void 0,r=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),o=this.sBox,f=this.rcon,l=this.invSubMix,p=l[0],g=l[1],v=l[2],b=l[3],h=void 0,t=void 0;for(n=0;n<a;n++)n<s?h=r[n]=c[n]:(t=h,n%s==0?(t=t<<8|t>>>24,t=o[t>>>24]<<24|o[t>>>16&255]<<16|o[t>>>8&255]<<8|o[255&t],t^=f[n/s|0]<<24):s>6&&n%s==4&&(t=o[t>>>24]<<24|o[t>>>16&255]<<16|o[t>>>8&255]<<8|o[255&t]),r[n]=h=(r[n-s]^t)>>>0);for(i=0;i<a;i++)n=a-i,t=3&i?r[n]:r[n-4],u[i]=i<4||n<=4?t:p[o[t>>>24]]^g[o[t>>>16&255]]^v[o[t>>>8&255]]^b[o[255&t]],u[i]=u[i]>>>0}},e.prototype.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},e.prototype.decrypt=function(e,t,n,s){for(var D=this.keySize+6,a=this.invKeySchedule,i=this.invSBox,g=this.invSubMix,v=g[0],b=g[1],j=g[2],p=g[3],x=this.uint8ArrayToUint32Array_(n),F=x[0],z=x[1],T=x[2],M=x[3],f=new Int32Array(e),m=new Int32Array(f.length),y=void 0,_=void 0,w=void 0,O=void 0,c=void 0,u=void 0,d=void 0,l=void 0,E=void 0,C=void 0,k=void 0,A=void 0,r=void 0,S=void 0,h=this.networkToHostOrderSwap;t<f.length;){for(E=h(f[t]),C=h(f[t+1]),k=h(f[t+2]),A=h(f[t+3]),c=E^a[0],u=A^a[1],d=k^a[2],l=C^a[3],r=4,S=1;S<D;S++)y=v[c>>>24]^b[u>>16&255]^j[d>>8&255]^p[255&l]^a[r],_=v[u>>>24]^b[d>>16&255]^j[l>>8&255]^p[255&c]^a[r+1],w=v[d>>>24]^b[l>>16&255]^j[c>>8&255]^p[255&u]^a[r+2],O=v[l>>>24]^b[c>>16&255]^j[u>>8&255]^p[255&d]^a[r+3],c=y,u=_,d=w,l=O,r+=4;y=i[c>>>24]<<24^i[u>>16&255]<<16^i[d>>8&255]<<8^i[255&l]^a[r],_=i[u>>>24]<<24^i[d>>16&255]<<16^i[l>>8&255]<<8^i[255&c]^a[r+1],w=i[d>>>24]<<24^i[l>>16&255]<<16^i[c>>8&255]<<8^i[255&u]^a[r+2],O=i[l>>>24]<<24^i[c>>16&255]<<16^i[u>>8&255]<<8^i[255&d]^a[r+3],r+=3,m[t]=h(y^F),m[t+1]=h(O^z),m[t+2]=h(w^T),m[t+3]=h(_^M),F=E,z=C,T=k,M=A,t+=4}return s?o(m.buffer):m.buffer},e.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}();t.a=i},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(20),i=n(0),s=n(5),r=function(){function e(t,n,s){a(this,e),this.observer=t,this.config=s,this.remuxer=n}return e.prototype.resetInitSegment=function(e,t,n,s){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:s,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var n=s.a.getID3Data(e,0)||[],t=n.length,a=e.length;t<a;t++)if(o.e(e,t))return i.b.log("ADTS sync word found !"),!0;return!1},e.prototype.append=function(e,t,n,a){for(var u,d=this._audioTrack,c=s.a.getID3Data(e,0)||[],h=s.a.getTimeStamp(c),m=h?90*h:9e4*t,f=0,l=m,p=e.length,r=c.length,g=[{pts:l,dts:l,data:c}];r<p-1;)if(o.d(e,r)&&r+5<p){if(o.c(d,this.observer,e,r,d.manifestCodec),u=o.a(d,e,r,m,f),!u){i.b.log("Unable to parse AAC frame");break}r+=u.length,l=u.sample.pts,f++}else s.a.isHeader(e,r)?(c=s.a.getID3Data(e,r),g.push({pts:l,dts:l,data:c}),r+=c.length):r++;this.remuxer.remux(d,{samples:[]},{samples:g,inputTimeScale:9e4},{samples:[]},t,n,a)},e.prototype.destroy=function(){},e}();t.a=r},function(e,t,n){"use strict";function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(20),r=n(21),c=n(1),a=n(39),d=n(40),s=n(0),i=n(2),u={video:0,audio:1,id3:2,text:3},h=function(){function e(t,n,s,o){l(this,e),this.observer=t,this.config=s,this.typeSupported=o,this.remuxer=n,this.sampleAes=null}return e.prototype.setDecryptData=function(e){e!=null&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new d.a(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){var n=e._syncOffset(t);return!(n<0)&&(n&&s.b.warn("MPEG2-TS detected but first sync word found @ offset "+n+", junk ahead ?"),!0)},e._syncOffset=function(e){for(var n=Math.min(1e3,e.length-564),t=0;t<n;){if(71===e[t]&&71===e[t+188]&&71===e[t+376])return t;t++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:u[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},e.prototype.resetInitSegment=function(t,n,s,o){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",o),this._audioTrack=e.createTrack("audio",o),this._id3Track=e.createTrack("id3",o),this._txtTrack=e.createTrack("text",o),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=n,this.videoCodec=s,this._duration=o},e.prototype.resetTimeStamp=function(){},e.prototype.append=function(t,n,o,a){var l=void 0,C=t.length,b=void 0,A=void 0,d=void 0,r=void 0,O=!1;this.contiguous=o;var j,k=this.pmtParsed,p=this._avcTrack,h=this._audioTrack,g=this._id3Track,y=p.pid,_=h.pid,w=g.pid,E=this._pmtId,f=p.pesData,u=h.pesData,m=g.pesData,z=this._parsePAT,D=this._parsePMT,v=this._parsePES,S=this._parseAVCPES.bind(this),M=this._parseAACPES.bind(this),F=this._parseMPEGPES.bind(this),T=this._parseID3PES.bind(this),x=e._syncOffset(t);for(C-=(C+x)%188,l=x;l<C;l+=188)if(71===t[l]){if(b=!!(64&t[l+1]),A=((31&t[l+1])<<8)+t[l+2],(48&t[l+3])>>4>1){if((d=l+5+t[l+4])===l+188)continue}else d=l+4;switch(A){case y:b&&(f&&(r=v(f))&&void 0!==r.pts&&S(r,!1),f={data:[],size:0}),f&&(f.data.push(t.subarray(d,l+188)),f.size+=l+188-d);break;case _:b&&(u&&(r=v(u))&&void 0!==r.pts&&(h.isAAC?M(r):F(r)),u={data:[],size:0}),u&&(u.data.push(t.subarray(d,l+188)),u.size+=l+188-d);break;case w:b&&(m&&(r=v(m))&&void 0!==r.pts&&T(r),m={data:[],size:0}),m&&(m.data.push(t.subarray(d,l+188)),m.size+=l+188-d);break;case 0:b&&(d+=t[d]+1),E=this._pmtId=z(t,d);break;case E:b&&(d+=t[d]+1),j=D(t,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes),y=j.avc,y>0&&(p.pid=y),_=j.audio,_>0&&(h.pid=_,h.isAAC=j.isAAC),w=j.id3,w>0&&(g.pid=w),O&&!k&&(s.b.log("reparse from beginning"),O=!1,l=x-188),k=this.pmtParsed=!0;break;case 17:case 8191:break;default:O=!0}}else this.observer.trigger(c.a.ERROR,{type:i.b.MEDIA_ERROR,details:i.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});f&&(r=v(f))&&void 0!==r.pts?(S(r,!0),p.pesData=null):p.pesData=f,u&&(r=v(u))&&void 0!==r.pts?(h.isAAC?M(r):F(r),h.pesData=null):(u&&u.size&&s.b.log("last AAC PES packet truncated,might overlap between fragments"),h.pesData=u),m&&(r=v(m))&&void 0!==r.pts?(T(r),g.pesData=null):g.pesData=m,null==this.sampleAes?this.remuxer.remux(h,p,g,this._txtTrack,n,o,a):this.decryptAndRemux(h,p,g,this._txtTrack,n,o,a)},e.prototype.decryptAndRemux=function(e,t,n,s,o,i,a){if(e.samples&&e.isAAC){var r=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){r.decryptAndRemuxAvc(e,t,n,s,o,i,a)})}else this.decryptAndRemuxAvc(e,t,n,s,o,i,a)},e.prototype.decryptAndRemuxAvc=function(e,t,n,s,o,i,a){if(t.samples){var r=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){r.remuxer.remux(e,t,n,s,o,i,a)})}else this.remuxer.remux(e,t,n,s,o,i,a)},e.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},e.prototype._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},e.prototype._parsePMT=function(e,t,n,o){var r=void 0,c=void 0,l=void 0,a=void 0,i={audio:-1,avc:-1,id3:-1,isAAC:!0};for(r=(15&e[t+1])<<8|e[t+2],c=t+3+r-4,l=(15&e[t+10])<<8|e[t+11],t+=12+l;t<c;){switch(a=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!o){s.b.log("unkown stream type:"+e[t]);break}case 15:-1===i.audio&&(i.audio=a);break;case 21:-1===i.id3&&(i.id3=a);break;case 219:if(!o){s.b.log("unkown stream type:"+e[t]);break}case 27:-1===i.avc&&(i.avc=a);break;case 3:case 4:n?-1===i.audio&&(i.audio=a,i.isAAC=!1):s.b.log("MPEG audio found, not supported in this browser for now");break;case 36:s.b.warn("HEVC stream type found, not supported for now");break;default:s.b.log("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return i},e.prototype._parsePES=function(e){var c,l,d,p,f=0,t=void 0,m=void 0,r=void 0,u=void 0,h=void 0,o=void 0,i=void 0,a=void 0,n=e.data;if(!e||0===e.size)return null;for(;n[0].length<19&&n.length>1;)l=new Uint8Array(n[0].length+n[1].length),l.set(n[0]),l.set(n[1],n[0].length),n[0]=l,n.splice(1,1);if(t=n[0],1===(t[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;m=t[7],192&m&&(o=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,o>4294967295&&(o-=8589934592),64&m?(i=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,i>4294967295&&(i-=8589934592),o-i>54e5&&(s.b.warn(Math.round((o-i)/9e4)+"s delta between PTS and DTS, align them"),o=i)):i=o),u=t[8],a=u+9,e.size-=a,h=new Uint8Array(e.size);for(d=0,p=n.length;d<p;d++){if(t=n[d],c=t.byteLength,a){if(a>c){a-=c;continue}t=t.subarray(a),c-=a,a=0}h.set(t,f),f+=c}return r&&(r-=u+3),{data:h,pts:o,dts:i,len:r}}return null},e.prototype.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var n=t.samples,o=n.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(o||this.contiguous)?(e.id=o,n.push(e)):t.dropped++}e.debug.length&&s.b.log(e.pts+"/"+e.dts+":"+e.debug)},e.prototype._parseAVCPES=function(e,t){var c=this,o=this._avcTrack,u=this._parseAVCNALu(e.data),s=void 0,n=this.avcSample,r=void 0,h=!1,i=void 0,d=this.pushAccesUnit.bind(this),l=function(e,t,n,s){return{key:e,pts:t,dts:n,units:[],debug:s}};e.data=null,n&&u.length&&!o.audFound&&(d(n,o),n=this.avcSample=l(!1,e.pts,e.dts,"")),u.forEach(function(t){switch(t.type){case 1:r=!0,n||(n=c.avcSample=l(!0,e.pts,e.dts,"")),n.frame=!0,b=t.data,h&&b.length>4&&(m=new a.a(b).readSliceType(),2!==m&&4!==m&&7!==m&&9!==m||(n.key=!0));break;case 5:r=!0,n||(n=c.avcSample=l(!0,e.pts,e.dts,"")),n.key=!0,n.frame=!0;break;case 6:r=!0,s=new a.a(c.discardEPB(t.data)),s.readUByte();for(var m,f,v,b,j,O,y=0,g=0,_=!1,u=0;!_&&s.bytesAvailable>1;){y=0;do u=s.readUByte(),y+=u;while(255===u)g=0;do u=s.readUByte(),g+=u;while(255===u)if(4===y&&0!==s.bytesAvailable){if(_=!0,181===s.readUByte()&&49===s.readUShort()&&1195456820===s.readUInt()&&3===s.readUByte()){var w=s.readUByte(),x=s.readUByte(),C=31&w,p=[w,x];for(i=0;i<C;i++)p.push(s.readUByte()),p.push(s.readUByte()),p.push(s.readUByte());c._insertSampleInOrder(c._txtTrack.samples,{type:3,pts:e.pts,bytes:p})}}else if(g<s.bytesAvailable)for(i=0;i<g;i++)s.readUByte()}break;case 7:if(r=!0,h=!0,!o.sps){s=new a.a(t.data),v=s.readSPS(),o.width=v.width,o.height=v.height,o.pixelRatio=v.pixelRatio,o.sps=[t.data],o.duration=c._duration,O=t.data.subarray(1,4),j="avc1.";for(i=0;i<3;i++)f=O[i].toString(16),f.length<2&&(f="0"+f),j+=f;o.codec=j}break;case 8:r=!0,o.pps||(o.pps=[t.data]);break;case 9:r=!1,o.audFound=!0,n&&d(n,o),n=c.avcSample=l(!1,e.pts,e.dts,"");break;case 12:r=!1;break;default:r=!1,n&&(n.debug+="unknown NAL "+t.type+" ")}n&&r&&n.units.push(t)}),t&&n&&(d(n,o),this.avcSample=null)},e.prototype._insertSampleInOrder=function(e,t){var n,s=e.length;if(s>0){if(t.pts>=e[s-1].pts)e.push(t);else for(n=s-1;n>=0;n--)if(t.pts<e[n].pts){e.splice(n,0,t);break}}else e.push(t)},e.prototype._getLastNalUnit=function(){var t,n,o,e=this.avcSample,s=void 0;return(!e||0===e.units.length)&&(o=this._avcTrack,t=o.samples,e=t[t.length-1]),e&&(n=e.units,s=n[n.length-1]),s},e.prototype._parseAVCNALu=function(e){var n,o,d,u,s=0,f=e.byteLength,a=void 0,m=void 0,g=this._avcTrack,t=g.naluState||0,h=t,c=[],r=void 0,p=void 0,i=-1,l=void 0;for(-1===t&&(i=0,l=31&e[0],t=0,s=1);s<f;)a=e[s++],t?1!==t?a?1===a?(i>=0?(r={data:e.subarray(i,s-t-1),type:l},c.push(r)):(n=this._getLastNalUnit(),n&&(h&&s<=4-h&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-h)),(m=s-t-1)>0)&&(d=new Uint8Array(n.data.byteLength+m),d.set(n.data,0),d.set(e.subarray(0,m),n.data.byteLength),n.data=d)),s<f?(p=31&e[s],i=s,l=p,t=0):t=-1):t=0:t=3:t=a?0:2:t=a?0:1;return(i>=0&&t>=0&&(r={data:e.subarray(i,f),type:l,state:t},c.push(r)),0===c.length)&&(o=this._getLastNalUnit(),o&&(u=new Uint8Array(o.data.byteLength+e.byteLength),u.set(o.data,0),u.set(e,o.data.byteLength),o.data=u)),g.naluState=t,c},e.prototype.discardEPB=function(e){for(var s,a=e.byteLength,n=[],t=1,o=void 0,i=void 0;t<a-2;)0===e[t]&&0===e[t+1]&&3===e[t+2]?(n.push(t+2),t+=2):t++;if(0===n.length)return e;o=a-n.length,i=new Uint8Array(o),s=0;for(t=0;t<o;s++,t++)s===n[0]&&(s++,n.shift()),i[t]=e[s];return i},e.prototype._parseAACPES=function(e){var l,d,h,m,f,g=this._audioTrack,n=e.data,u=e.pts,r=this.aacOverFlow,v=this.aacLastPTS,b=void 0,p=void 0,t=void 0,j=void 0,a=void 0;r&&(h=new Uint8Array(r.byteLength+n.byteLength),h.set(r,0),h.set(n,r.byteLength),n=h);for(t=0,a=n.length;t<a-1&&!o.d(n,t);t++);if(t&&(l=void 0,d=void 0,t<a-1?(l="AAC PES did not start with ADTS header,offset:"+t,d=!1):(l="no ADTS header found in AAC PES",d=!0),s.b.warn("parsing error:"+l),this.observer.trigger(c.a.ERROR,{type:i.b.MEDIA_ERROR,details:i.a.FRAG_PARSING_ERROR,fatal:d,reason:l}),d))return;for((o.c(g,this.observer,n,t,this.audioCodec),p=0,b=o.b(g.samplerate),r&&v)&&(m=v+b,Math.abs(m-u)>1&&(s.b.log("AAC: align PTS for overlapping frames by "+Math.round((m-u)/90)),u=m));t<a;)if(o.d(n,t)&&t+5<a){if(f=o.a(g,n,t,u,p),!f)break;t+=f.length,j=f.sample.pts,p++}else t++;r=t<a?n.subarray(t,a):null,this.aacOverFlow=r,this.aacLastPTS=j},e.prototype._parseMPEGPES=function(e){for(var s,n=e.data,i=n.length,o=0,t=0,a=e.pts;t<i;)if(r.a.isHeader(n,t)){if(s=r.a.appendFrame(this._audioTrack,n,t,a,o),!s)break;t+=s.length,o++}else t++},e.prototype._parseID3PES=function(e){this._id3Track.samples.push(e)},e}();t.a=h},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(0),i=function(){function e(t){s(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return e.prototype.loadWord=function(){var t=this.data,n=this.bytesAvailable,s=t.byteLength-n,o=new Uint8Array(4),e=Math.min(4,n);if(0===e)throw new Error("no bytes available");o.set(t.subarray(s,s+e)),this.word=new DataView(o.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},e.prototype.skipBits=function(e){var t=void 0;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},e.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&o.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n},e.prototype.skipLZ=function(){var e=void 0;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},e.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},e.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},e.prototype.readBoolean=function(){return 1===this.readBits(1)},e.prototype.readUByte=function(){return this.readBits(8)},e.prototype.readUShort=function(){return this.readBits(16)},e.prototype.readUInt=function(){return this.readBits(32)},e.prototype.skipScalingList=function(e){var n=8,t=8,s=void 0,o=void 0;for(s=0;s<e;s++)0!==t&&(o=this.readEG(),t=(n+o+256)%256),n=0===t?n:t},e.prototype.readSPS=function(){var e,l,d,p=0,y=0,m=0,g=0,t=void 0,v=void 0,j=void 0,b=void 0,c=void 0,h=void 0,i=void 0,s=this.readUByte.bind(this),f=this.readBits.bind(this),n=this.readUEG.bind(this),a=this.readBoolean.bind(this),o=this.skipBits.bind(this),u=this.skipEG.bind(this),r=this.skipUEG.bind(this),_=this.skipScalingList.bind(this);if((s(),t=s(),f(5),o(3),s(),r(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t)&&(d=n(),3===d&&o(1),r(),r(),o(1),a()))for(h=3!==d?8:12,i=0;i<h;i++)a()&&_(i<6?16:64);if(r(),l=n(),0===l)n();else if(1===l)for(o(1),u(),u(),v=n(),i=0;i<v;i++)u();if(r(),o(1),j=n(),b=n(),c=f(1),0===c&&o(1),o(1),a()&&(p=n(),y=n(),m=n(),g=n()),e=[1,1],a()&&a())switch(s()){case 1:e=[1,1];break;case 2:e=[12,11];break;case 3:e=[10,11];break;case 4:e=[16,11];break;case 5:e=[40,33];break;case 6:e=[24,11];break;case 7:e=[20,11];break;case 8:e=[32,11];break;case 9:e=[80,33];break;case 10:e=[18,11];break;case 11:e=[15,11];break;case 12:e=[64,33];break;case 13:e=[160,99];break;case 14:e=[4,3];break;case 15:e=[3,2];break;case 16:e=[2,1];break;case 255:e=[s()<<8|s(),s()<<8|s()]}return{width:Math.ceil(16*(j+1)-2*p-2*y),height:(2-c)*(b+1)*16-(c?2:4)*(m+g),pixelRatio:e}},e.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();t.a=i},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(11),i=function(){function e(t,n,i,a){s(this,e),this.decryptdata=i,this.discardEPB=a,this.decrypter=new o.a(t,n,{removePKCS7Padding:!1})}return e.prototype.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},e.prototype.decryptAacSample=function(e,t,n,s){var o=e[t].unit,i=o.subarray(16,o.length-o.length%16),a=i.buffer.slice(i.byteOffset,i.byteOffset+i.length),r=this;this.decryptBuffer(a,function(i){i=new Uint8Array(i),o.set(i,16),s||r.decryptAacSamples(e,t+1,n)})},e.prototype.decryptAacSamples=function(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)){var s=this.decrypter.isSync();if(this.decryptAacSample(e,t,n,s),!s)return}}},e.prototype.getAvcEncryptedData=function(e){for(var o=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(o),s=0,t=32;t<=e.length-16;t+=160,s+=16)n.set(e.subarray(t,t+16),s);return n},e.prototype.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var n=0,s=32;s<=e.length-16;s+=160,n+=16)e.set(t.subarray(n,n+16),s);return e},e.prototype.decryptAvcSample=function(e,t,n,s,o,i){var a=this.discardEPB(o.data),c=this.getAvcEncryptedData(a),r=this;this.decryptBuffer(c.buffer,function(c){o.data=r.getAvcDecryptedUnit(a,c),i||r.decryptAvcSamples(e,t,n+1,s)})},e.prototype.decryptAvcSamples=function(e,t,n,s){for(;;t++,n=0){if(t>=e.length)return void s();for(var o,i,a=e[t].units;!(n>=a.length);n++)if(o=a[n],!(o.length<=48||1!==o.type&&5!==o.type)&&(i=this.decrypter.isSync(),this.decryptAvcSample(e,t,n,s,o,i),!i))return}},e}();t.a=i},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=n(5),a=n(0),o=n(21),r=function(){function e(t,n,s){i(this,e),this.observer=t,this.config=s,this.remuxer=n}return e.prototype.resetInitSegment=function(e,t,n,s){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:s,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){var t=void 0,i=void 0,n=s.a.getID3Data(e,0);if(n&&void 0!==s.a.getTimeStamp(n))for(t=n.length,i=Math.min(e.length-1,t+100);t<i;t++)if(o.a.probe(e,t))return a.b.log("MPEG Audio sync word found !"),!0;return!1},e.prototype.append=function(e,t,n,i){for(var c,r=s.a.getID3Data(e,0),u=s.a.getTimeStamp(r),l=u?90*u:9e4*t,a=r.length,p=e.length,h=0,d=0,m=this._audioTrack,f=[{pts:l,dts:l,data:r}];a<p;)if(o.a.isHeader(e,a)){if(c=o.a.appendFrame(m,e,a,l,h),!c)break;a+=c.length,d=c.sample.pts,h++}else s.a.isHeader(e,a)?(r=s.a.getID3Data(e,a),f.push({pts:d,dts:d,data:r}),a+=r.length):a++;this.remuxer.remux(m,{samples:[]},{samples:f,inputTimeScale:9e4},{samples:[]},t,n,i)},e.prototype.destroy=function(){},e}();t.a=r},function(e,t,n){"use strict";function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=n(43),i=n(44),o=n(1),a=n(2),s=n(0),l=function(){function e(t,n,s,o){c(this,e),this.observer=t,this.config=n,this.typeSupported=s;var i=navigator.userAgent;this.isSafari=o&&o.indexOf("Apple")>-1&&i&&!i.match("CriOS"),this.ISGenerated=!1}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},e.prototype.resetInitSegment=function(){this.ISGenerated=!1},e.prototype.remux=function(e,t,n,i,a,r,c){if(this.ISGenerated||this.generateIS(e,t,a),this.ISGenerated){var l,m,f,p,g=e.samples.length,d=t.samples.length,u=a,h=a;g&&d&&(m=(e.samples[0].dts-t.samples[0].dts)/t.inputTimeScale,u+=Math.max(0,m),h+=Math.max(0,-m)),g?(e.timescale||(s.b.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,a)),l=this.remuxAudio(e,u,r,c),d&&(f=void 0,l&&(f=l.endPTS-l.startPTS),t.timescale||(s.b.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,a)),this.remuxVideo(t,h,r,f,c))):d&&(p=this.remuxVideo(t,h,r,0,c),p&&e.codec&&this.remuxEmptyAudio(e,u,r,p))}n.samples.length&&this.remuxID3(n,a),i.samples.length&&this.remuxText(i,a),this.observer.trigger(o.a.FRAG_PARSED)},e.prototype.generateIS=function(e,t,n){var u,f=this.observer,p=e.samples,h=t.samples,m=this.typeSupported,g="audio/mp4",l={},v={tracks:l},d=void 0===this._initPTS,r=void 0,c=void 0;(d&&(r=c=1/0),e.config&&p.length&&(e.timescale=e.samplerate,s.b.log("audio sampling rate : "+e.samplerate),e.isAAC||(m.mpeg?(g="audio/mpeg",e.codec=""):m.mp3&&(e.codec="mp3")),l.audio={container:g,codec:e.codec,initSegment:!e.isAAC&&m.mpeg?new Uint8Array:i.a.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(r=c=p[0].pts-e.inputTimeScale*n)),t.sps&&t.pps&&h.length)&&(u=t.inputTimeScale,t.timescale=u,l.video={container:"video/mp4",codec:t.codec,initSegment:i.a.initSegment([t]),metadata:{width:t.width,height:t.height}},d&&(r=Math.min(r,h[0].pts-u*n),c=Math.min(c,h[0].dts-u*n),this.observer.trigger(o.a.INIT_PTS_FOUND,{initPTS:r}))),Object.keys(l).length?(f.trigger(o.a.FRAG_PARSING_INIT_SEGMENT,v),this.ISGenerated=!0,d&&(this._initPTS=r,this._initDTS=c)):f.trigger(o.a.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},e.prototype.remuxVideo=function(e,t,n,r,c){var m,g,j,_,O,x,E,F,P,H,I,Q,A=8,f=e.timescale,d=void 0,y=void 0,U=void 0,v=void 0,u=void 0,q=void 0,C=void 0,l=e.samples,w=[],S=l.length,Z=this._PTSNormalize,z=this._initDTS,p=this.nextAvcDts,k=this.isSafari;if(0!==S){if(k&&(n|=l.length&&p&&(c&&Math.abs(t-p/f)<.1||Math.abs(l[0].pts-p-z)<f/5)),n||(p=t*f),l.forEach(function(e){e.pts=Z(e.pts-z,p),e.dts=Z(e.dts-z,p)}),l.sort(function(e,t){var n=e.dts-t.dts,s=e.pts-t.pts;return n||s||e.id-t.id}),x=l.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0),x<0){s.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(x/90)+" ms to overcome this issue");for(E=0;E<l.length;E++)l[E].dts+=x}j=l[0],u=Math.max(j.dts,0),v=Math.max(j.pts,0),g=Math.round((u-p)/90),n&&g&&(g>1?s.b.log("AVC:"+g+" ms hole between fragments detected,filling it"):g<-1&&s.b.log("AVC:"+-g+" ms overlapping between fragments detected"),u=p,l[0].dts=u,v=Math.max(v-g,p),l[0].pts=v,s.b.log("Video/PTS/DTS adjusted: "+Math.round(v/90)+"/"+Math.round(u/90)+",delta:"+g+" ms")),u,j=l[l.length-1],C=Math.max(j.dts,0),q=Math.max(j.pts,0,C),k&&(d=Math.round((C-u)/(l.length-1)));for(var X=0,$=0,M=0;M<S;M++){for(var b=l[M],V=b.units,Y=V.length,N=0,L=0;L<Y;L++)N+=V[L].data.length;$+=N,X+=Y,b.length=N,b.dts=k?u+M*d:Math.max(b.dts,u),b.pts=Math.max(b.pts,b.dts)}_=$+4*X+8;try{y=new Uint8Array(_)}catch{return void this.observer.trigger(o.a.ERROR,{type:a.b.MUX_ERROR,details:a.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:_,reason:"fail allocating video mdat "+_})}P=new DataView(y.buffer),P.setUint32(0,_),y.set(i.a.types.mdat,4);for(m=0;m<S;m++){for(var h=l[m],W=h.units,G=0,R=void 0,B=0,ne=W.length;B<ne;B++){var K=W[B],te=K.data,D=K.data.byteLength;P.setUint32(A,D),A+=4,y.set(te,A),A+=D,G+=4+D}if(k)R=Math.max(0,d*Math.round((h.pts-h.dts)/d));else{if(m<S-1)d=l[m+1].dts-h.dts;else if(F=this.config,O=h.dts-l[m>0?m-1:m].dts,F.stretchShortVideoTrack){var ee=F.maxBufferHole,J=Math.floor(ee*f),T=(r?v+r*f:this.nextAudioPts)-h.pts;T>J?(d=T-O,d<0&&(d=O),s.b.log("It is approximately "+T/90+" ms to the next segment; using duration "+d/90+" ms for the last video frame.")):d=O}else d=O;R=Math.round(h.pts-h.dts)}w.push({size:G,duration:d,cts:R,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:h.key?2:1,isNonSync:h.key?0:1}})}return this.nextAvcDts=C+d,Q=e.dropped,(e.len=0,e.nbNalu=0,e.dropped=0,w.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1)&&(H=w[0].flags,H.dependsOn=2,H.isNonSync=0),e.samples=w,U=i.a.moof(e.sequenceNumber++,u,e),e.samples=[],I={data1:U,data2:y,startPTS:v/f,endPTS:(q+d)/f,startDTS:u/f,endDTS:this.nextAvcDts/f,type:"video",hasAudio:!1,hasVideo:!0,nb:w.length,dropped:Q},this.observer.trigger(o.a.FRAG_PARSING_DATA,I),I}},e.prototype.remuxAudio=function(e,t,n,c){var f,v,j,w,O,k,M,T,z,D,N,L,R,P,V,$,d=e.inputTimeScale,Q=e.timescale,F=d/Q,G=e.isAAC?1024:1152,p=G*F,X=this._PTSNormalize,q=this._initDTS,S=!e.isAAC&&this.typeSupported.mpeg,x=void 0,_=void 0,l=void 0,y=void 0,B=void 0,H=void 0,A=void 0,u=e.samples,C=[],h=this.nextAudioPts;if(n|=u.length&&h&&(c&&Math.abs(t-h/d)<.1||Math.abs(u[0].pts-h-q)<20*p),u.forEach(function(e){e.pts=e.dts=X(e.pts-q,t*d)}),u=u.filter(function(e){return e.pts>=0}),0!==u.length){if(n||(h=c?t*d:u[0].pts),e.isAAC)for(var U=this.config.maxAudioFramesDrift,g=0,m=h;g<u.length;)if(f=u[g],$=f.pts,v=$-m,z=Math.abs(1e3*v/d),v<=-U*p)s.b.warn("Dropping 1 audio frame @ "+(m/d).toFixed(3)+"s due to "+Math.round(z)+" ms overlap."),u.splice(g,1),e.len-=f.unit.length;else if(v>=U*p&&z<1e4&&m){N=Math.round(v/p),s.b.warn("Injecting "+N+" audio frame @ "+(m/d).toFixed(3)+"s due to "+Math.round(1e3*v/d)+" ms gap.");for(L=0;L<N;L++)R=Math.max(m,0),l=r.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),l||(s.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),l=f.unit.subarray()),u.splice(g,0,{unit:l,pts:R,dts:R}),e.len+=l.length,m+=p,g++;f.pts=f.dts=m,m+=p,g++}else Math.abs(v),f.pts=f.dts=m,m+=p,g++;for(T=0,V=u.length;T<V;T++){var I=u[T],E=I.unit,b=I.pts;if(void 0!==A)_.duration=Math.round((b-A)/F);else{if(j=Math.round(1e3*(b-h)/d),O=0,n&&e.isAAC&&j){if(j>0&&j<1e4)O=Math.round((b-h)/p),s.b.log(j+" ms hole between AAC samples detected,filling it"),O>0&&(l=r.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),l||(l=E.subarray()),e.len+=O*l.length);else if(j<-12){s.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(h/d).toFixed(3)+"s/"+(b/d).toFixed(3)+"s/"+-j+"ms"),e.len-=E.byteLength;continue}b=h}if(H=b,!(e.len>0))return;w=S?e.len:e.len+8,x=S?0:8;try{y=new Uint8Array(w)}catch{return void this.observer.trigger(o.a.ERROR,{type:a.b.MUX_ERROR,details:a.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:w,reason:"fail allocating audio mdat "+w})}S||(new DataView(y.buffer).setUint32(0,w),y.set(i.a.types.mdat,4));for(P=0;P<O;P++)l=r.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),l||(s.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),l=E.subarray()),y.set(l,x),x+=l.byteLength,_={size:l.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},C.push(_)}y.set(E,x),D=E.byteLength,x+=D,_={size:D,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},C.push(_),A=b}if(M=0,k=C.length,k>=2&&(M=C[k-2].duration,_.duration=M),k){this.nextAudioPts=h=A+F*M,e.len=0,e.samples=C,B=S?new Uint8Array:i.a.moof(e.sequenceNumber++,H/F,e),e.samples=[];var K=H/d,W=h/d,Y={data1:B,data2:y,startPTS:K,endPTS:W,startDTS:K,endDTS:W,type:"audio",hasAudio:!0,hasVideo:!1,nb:k};return this.observer.trigger(o.a.FRAG_PARSING_DATA,Y),Y}return null}},e.prototype.remuxEmptyAudio=function(e,t,n,o){var a,l,d,i=e.inputTimeScale,f=e.samplerate?e.samplerate:i,p=i/f,u=this.nextAudioPts,h=(void 0!==u?u:o.startDTS*i)+this._initDTS,g=o.endDTS*i+this._initDTS,m=1024*p,v=Math.ceil((g-h)/m),c=r.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(s.b.warn("remux empty Audio"),!c)return void s.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(l=[],a=0;a<v;a++)d=h+a*m,l.push({unit:c,pts:d,dts:d}),e.len+=c.length;e.samples=l,this.remuxAudio(e,t,n)},e.prototype.remuxID3=function(e,t){var s,i=e.samples.length,n=void 0,a=e.inputTimeScale,r=this._initPTS,c=this._initDTS;if(i){for(s=0;s<i;s++)n=e.samples[s],n.pts=(n.pts-r)/a,n.dts=(n.dts-c)/a;this.observer.trigger(o.a.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[],t=t},e.prototype.remuxText=function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var n,i=e.samples.length,s=void 0,a=e.inputTimeScale,r=this._initPTS;if(i){for(n=0;n<i;n++)s=e.samples[n],s.pts=(s.pts-r)/a;this.observer.trigger(o.a.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[],t=t},e.prototype._PTSNormalize=function(e,t){var n=void 0;if(void 0===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e},e}();t.a=l},function(e,t){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(){s(this,e)}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}();t.a=o},function(e,t){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=Math.pow(2,32)-1,i=function(){function e(){o(this,e)}return e.init=function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},t=void 0;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),e.HDLR_TYPES={video:n,audio:s},o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]),e.STTS=e.STSC=e.STCO=i,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var t,n,s,o,i,a=new Uint8Array([105,115,111,109]),r=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,a,c,a,r),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,o))},e.box=function(e){for(var o=Array.prototype.slice.call(arguments,1),t=8,n=o.length,i=n,s=void 0;n--;)t+=o[n].byteLength;for(s=new Uint8Array(t),s[0]=t>>24&255,s[1]=t>>16&255,s[2]=t>>8&255,s[3]=255&t,s.set(e,4),n=0,t=8;n<i;n++)s.set(o[n],t),t+=o[n].byteLength;return s},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,n){n*=t;var o=Math.floor(n/(s+1)),i=Math.floor(n%(s+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,o>>24,o>>16&255,o>>8&255,255&o,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,n,s){return e.box(e.types.moof,e.mfhd(t),e.traf(s,n))},e.moov=function(t){for(var n=t.length,s=[];n--;)s[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(s).concat(e.mvex(t)))},e.mvex=function(t){for(var n=t.length,s=[];n--;)s[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(s))},e.mvhd=function(t,n){n*=t;var o=Math.floor(n/(s+1)),i=Math.floor(n%(s+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,o>>24,o>>16&255,o>>8&255,255&o,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)},e.sdtp=function(t){var o=t.samples||[],i=new Uint8Array(4+o.length),s=void 0,n=void 0;for(n=0;n<o.length;n++)s=o[n].flags,i[n+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return e.box(e.types.sdtp,i)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var n=[],a=[],s=void 0,o=void 0,i=void 0;for(s=0;s<t.sps.length;s++)o=t.sps[s],i=o.byteLength,n.push(i>>>8&255),n.push(255&i),n=n.concat(Array.prototype.slice.call(o));for(s=0;s<t.pps.length;s++)o=t.pps[s],i=o.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(o));var u=e.box(e.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|t.sps.length].concat(n).concat([t.pps.length]).concat(a))),l=t.width,d=t.height,r=t.pixelRatio[0],c=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([r>>24,r>>16&255,r>>8&255,255&r,c>>24,c>>16&255,c>>8&255,255&c])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var n=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var n=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var n=t.id,a=t.duration*t.timescale,r=t.width,c=t.height,o=Math.floor(a/(s+1)),i=Math.floor(a%(s+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,c>>8&255,255&c,0,0]))},e.traf=function(t,n){var r=e.sdtp(t),o=t.id,i=Math.floor(n/(s+1)),a=Math.floor(n%(s+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a])),e.trun(t,r.length+16+20+8+16+8+8),r)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,n){var u=t.samples||[],o=u.length,h=12+16*o,d=new Uint8Array(h),i=void 0,a=void 0,r=void 0,c=void 0,s=void 0,l=void 0;for(n+=8+h,d.set([0,0,15,1,o>>>24&255,o>>>16&255,o>>>8&255,255&o,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),i=0;i<o;i++)a=u[i],r=a.duration,c=a.size,s=a.flags,l=a.cts,d.set([r>>>24&255,r>>>16&255,r>>>8&255,255&r,c>>>24&255,c>>>16&255,c>>>8&255,255&c,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return e.box(e.types.trun,d)},e.initSegment=function(t){e.types||e.init();var s=e.moov(t),n=void 0;return n=new Uint8Array(e.FTYP.byteLength+s.byteLength),n.set(e.FTYP),n.set(s,e.FTYP.byteLength),n},e}();t.a=i},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=n(1),i=function(){function e(t){o(this,e),this.observer=t}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(){},e.prototype.resetInitSegment=function(){},e.prototype.remux=function(e,t,n,o,i,a,r,c){var d=this.observer,l="";e&&(l+="audio"),t&&(l+="video"),d.trigger(s.a.FRAG_PARSING_DATA,{data1:c,startPTS:i,startDTS:i,type:l,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),d.trigger(s.a.FRAG_PARSED)},e}();t.a=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(19),s=n(1),i=n(0),a=n(10),r=n.n(a),c=function(e){var n,t=new r.a;t.trigger=function(e){for(var s=arguments.length,o=Array(s>1?s-1:0),n=1;n<s;n++)o[n-1]=arguments[n];t.emit.apply(t,[e,e].concat(o))},t.off=function(e){for(var s=arguments.length,o=Array(s>1?s-1:0),n=1;n<s;n++)o[n-1]=arguments[n];t.removeListener.apply(t,[e].concat(o))},n=function(t,n){e.postMessage({event:t,data:n})},e.addEventListener("message",function(s){var r,a=s.data;switch(a.cmd){case"init":r=JSON.parse(a.config),e.demuxer=new o.a(t,a.typeSupported,r,a.vendor);try{Object(i.a)(!0===r.debug)}catch{console.warn("demuxerWorker: unable to enable logs")}n("init",null);break;case"demux":e.demuxer.push(a.data,a.decryptdata,a.initSegment,a.audioCodec,a.videoCodec,a.timeOffset,a.discontinuity,a.trackSwitch,a.contiguous,a.duration,a.accurateTimeOffset,a.defaultInitPTS)}}),t.on(s.a.FRAG_DECRYPTED,n),t.on(s.a.FRAG_PARSING_INIT_SEGMENT,n),t.on(s.a.FRAG_PARSED,n),t.on(s.a.ERROR,n),t.on(s.a.FRAG_PARSING_METADATA,n),t.on(s.a.FRAG_PARSING_USERDATA,n),t.on(s.a.INIT_PTS_FOUND,n),t.on(s.a.FRAG_PARSING_DATA,function(t,n){var s=[],o={event:t,data:n};n.data1&&(o.data1=n.data1.buffer,s.push(n.data1.buffer),delete n.data1),n.data2&&(o.data2=n.data2.buffer,s.push(n.data2.buffer),delete n.data2),e.postMessage(o,s)})};t.default=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=n(1),d=n(3),i=n(0),s=n(2),a=n(17),u=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),h=function(e){function t(n){r(this,t);var s=c(this,e.call(this,n,o.a.MANIFEST_LOADED,o.a.LEVEL_LOADED,o.a.FRAG_LOADED,o.a.ERROR));return s.canload=!1,s.currentLevelIndex=null,s.manualLevelIndex=-1,s.timer=null,s}return l(t,e),t.prototype.onHandlerDestroying=function(){this.cleanTimer(),this.manualLevelIndex=-1},t.prototype.cleanTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},t.prototype.stopLoad=function(){this.canload=!1},t.prototype.onManifestLoaded=function(e){var r,t=[],l=void 0,h={},d=null,n=!1,c=!1,m=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),u=[];if(e.levels.forEach(function(e){e.loadError=0,e.fragmentError=!1,n=n||!!e.videoCodec,c=c||!!e.audioCodec||!!e.attrs&&!!e.attrs.AUDIO,!0===m&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),d=h[e.bitrate],void 0===d?(e.url=[e.url],e.urlId=0,h[e.bitrate]=e,t.push(e)):d.url.push(e.url)}),!0===n&&!0===c&&(t=t.filter(function(e){return!!e.videoCodec})),t=t.filter(function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||Object(a.a)(t))&&(!n||Object(a.a)(n))}),e.audioTracks&&(u=e.audioTracks.filter(function(e){return!e.audioCodec||Object(a.a)(e.audioCodec,"audio")})),t.length>0){l=t[0].bitrate,t.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=t;for(r=0;r<t.length;r++)if(t[r].bitrate===l){this._firstLevel=r,i.b.log("manifest loaded,"+t.length+" level(s) found, first bitrate:"+l);break}this.hls.trigger(o.a.MANIFEST_PARSED,{levels:t,audioTracks:u,firstLevel:this._firstLevel,stats:e.stats,audio:c,video:n,altAudio:u.length>0&&n})}else this.hls.trigger(o.a.ERROR,{type:s.b.MEDIA_ERROR,details:s.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},t.prototype.setLevelInternal=function(e){var t,r,c,l,n=this._levels,a=this.hls;e>=0&&e<n.length?((this.cleanTimer(),this.currentLevelIndex!==e)&&(i.b.log("switching to level "+e),this.currentLevelIndex=e,r=n[e],r.level=e,a.trigger(o.a.LEVEL_SWITCHING,r)),t=n[e],c=t.details,(!c||!0===c.live)&&(l=t.urlId,a.trigger(o.a.LEVEL_LOADING,{url:t.url[l],level:e,id:l}))):a.trigger(o.a.ERROR,{type:s.b.OTHER_ERROR,details:s.a.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},t.prototype.onError=function(e){if(!0===e.fatal)return void(e.type===s.b.NETWORK_ERROR&&this.cleanTimer());var n=!1,o=!1,t=void 0;switch(e.details){case s.a.FRAG_LOAD_ERROR:case s.a.FRAG_LOAD_TIMEOUT:case s.a.KEY_LOAD_ERROR:case s.a.KEY_LOAD_TIMEOUT:t=e.frag.level,o=!0;break;case s.a.LEVEL_LOAD_ERROR:case s.a.LEVEL_LOAD_TIMEOUT:t=e.context.level,n=!0;break;case s.a.REMUX_ALLOC_ERROR:t=e.level,n=!0}void 0!==t&&this.recoverLevel(e,t,n,o)},t.prototype.recoverLevel=function(e,t,n,s){var u=this,c=this.hls.config,a=e.details,o=this._levels[t],r=void 0,l=void 0,d=void 0;if(o.loadError++,o.fragmentError=s,!0===n){if(!(this.levelRetryCount+1<=c.levelLoadingMaxRetry))return i.b.error("level controller, cannot recover from "+a+" error"),this.currentLevelIndex=null,this.cleanTimer(),void(e.fatal=!0);l=Math.min(Math.pow(2,this.levelRetryCount)*c.levelLoadingRetryDelay,c.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return u.loadLevel()},l),e.levelRetry=!0,this.levelRetryCount++,i.b.warn("level controller, "+a+", retry in "+l+" ms, current retry count is "+this.levelRetryCount)}!0!==n&&!0!==s||(r=o.url.length,r>1&&o.loadError<r?(i.b.warn("level controller, "+a+" for level "+t+": switching to redundant stream id "+o.urlId),o.urlId=(o.urlId+1)%r,o.details=void 0):-1===this.manualLevelIndex?(d=0===t?this._levels.length-1:t-1,i.b.warn("level controller, "+a+": switch to "+d),this.hls.nextAutoLevel=this.currentLevelIndex=d):!0===s&&(i.b.warn("level controller, "+a+": reload a fragment"),this.currentLevelIndex=null))},t.prototype.onFragLoaded=function(e){var t,n=e.frag;void 0!==n&&"main"===n.type&&(t=this._levels[n.level],void 0!==t&&(t.fragmentError=!1,t.loadError=0,this.levelRetryCount=0))},t.prototype.onLevelLoaded=function(e){if(a=this,o=e.level,o===this.currentLevelIndex)if(s=this._levels[o],!1===s.fragmentError&&(s.loadError=0,this.levelRetryCount=0),t=e.details,t.live){var t,s,o,a,r=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),n=r,c=s.details;c&&t.endSN===c.endSN&&(n/=2,i.b.log("same live playlist, reload twice faster")),n-=performance.now()-e.stats.trequest,n=Math.max(r/2,Math.round(n)),i.b.log("live playlist, reload in "+Math.round(n)+" ms"),this.timer=setTimeout(function(){return a.loadLevel()},n)}else this.cleanTimer()},t.prototype.loadLevel=function(){var e=void 0,t=void 0;null!==this.currentLevelIndex&&!0===this.canload&&void 0!==(e=this._levels[this.currentLevelIndex])&&e.url.length>0&&(t=e.urlId,this.hls.trigger(o.a.LEVEL_LOADING,{url:e.url[t],level:this.currentLevelIndex,id:t}))},u(t,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),t}(d.a);t.a=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(1),o=n(3),i=n(5),a=n(25),d=function(e){function t(n){r(this,t);var o=c(this,e.call(this,n,s.a.MEDIA_ATTACHED,s.a.MEDIA_DETACHING,s.a.FRAG_PARSING_METADATA));return o.id3Track=void 0,o.media=void 0,o}return l(t,e),t.prototype.destroy=function(){o.a.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){this.media=e.media,this.media},t.prototype.onMediaDetaching=function(){Object(a.a)(this.id3Track),this.id3Track=void 0,this.media=void 0},t.prototype.getID3Track=function(e){for(var t,n=0;n<e.length;n++)if(t=e[n],"metadata"===t.kind&&"id3"===t.label)return Object(a.b)(t,this.media),t;return this.media.addTextTrack("metadata","id3")},t.prototype.onFragParsingMetadata=function(e){var t,s,o,a,r,c,l,d,u=e.frag,n=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(d=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,t=0;t<n.length;t++)if(s=i.a.getID3Frames(n[t].data),s){r=n[t].pts,o=t<n.length-1?n[t+1].pts:u.endPTS,r===o&&(o+=1e-4);for(a=0;a<s.length;a++)c=s[a],i.a.isTimeStampFrame(c)||(l=new d(r,o,""),l.value=c,this.id3Track.addCue(l))}},t}(o.a);t.a=d},function(e,t,n){"use strict";function s(){var t=Object(o.a)(),e=window.SourceBuffer||window.WebKitSourceBuffer,n=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!n&&!!s}t.a=s;var o=n(12)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var l=n(51),g=n(54),i=n(55),a=n(56),r=n(57),c=n(58),o=n(59),d=n(60),u=n(62),h=n(66),m=n(67),f=n(68),p=n(69),s={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:r.a,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:l.a,bufferController:g.a,capLevelController:i.a,fpsController:a.a,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:p.a};s.subtitleStreamController=m.a,s.subtitleTrackController=h.a,s.timelineController=u.a,s.cueHandler=d,s.enableCEA708Captions=!0,s.enableWebVTT=!0,s.captionsTextTrack1Label="English",s.captionsTextTrack1LanguageCode="en",s.captionsTextTrack2Label="Spanish",s.captionsTextTrack2LanguageCode="es",s.audioStreamController=o.a,s.audioTrackController=c.a,s.emeController=f.a},function(e,t,n){"use strict";function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=n(1),i=n(3),a=n(9),r=n(2),s=n(0),u=n(52),h=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),m=function(e){function t(n){c(this,t);var s=l(this,e.call(this,n,o.a.FRAG_LOADING,o.a.FRAG_LOADED,o.a.FRAG_BUFFERED,o.a.ERROR));return s.lastLoadedFragLevel=0,s._nextAutoLevel=-1,s.hls=n,s.timer=null,s._bwEstimator=null,s.onCheck=s._abandonRulesCheck.bind(s),s}return d(t,e),t.prototype.destroy=function(){this.clearTimer(),i.a.prototype.destroy.call(this)},t.prototype.onFragLoading=function(e){if(n=e.frag,"main"===n.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var n,s=this.hls,a=e.frag.level,r=s.levels[a].details.live,t=s.config,o=void 0,i=void 0;r?(o=t.abrEwmaFastLive,i=t.abrEwmaSlowLive):(o=t.abrEwmaFastVoD,i=t.abrEwmaSlowVoD),this._bwEstimator=new u.a(s,i,o,t.abrEwmaDefaultEstimate)}this.fragCurrent=n}},t.prototype._abandonRulesCheck=function(){var r=this.hls,i=r.media,t=this.fragCurrent,l=t.loader,j=r.minAutoLevel;if(!l||l.stats&&l.stats.aborted)return s.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(e=l.stats,i&&e&&(!i.paused&&0!==i.playbackRate||!i.readyState)&&t.autoLevel&&t.level&&(u=performance.now()-e.trequest,h=Math.abs(i.playbackRate),u>500*t.duration/h)){var e,n,d,u,h,v,c=r.levels,g=Math.max(1,e.bw?e.bw/8:1e3*e.loaded/u),m=c[t.level],_=m.realBitrate?Math.max(m.realBitrate,m.bitrate):m.bitrate,y=e.total?e.total:Math.max(e.loaded,Math.round(t.duration*_/8)),b=i.currentTime,p=(y-e.loaded)/g,f=(a.a.bufferInfo(i,b,r.config.maxBufferHole).end-b)/h;if(f<2*t.duration/h&&p>f){d=void 0,n=void 0;for(n=t.level-1;n>j;n--)if(v=c[n].realBitrate?Math.max(c[n].realBitrate,c[n].bitrate):c[n].bitrate,(d=t.duration*v/(6.4*g))<f)break;d<p&&(s.b.warn("loading too slow, abort fragment loading and switch to level "+n+":fragLoadedDelay["+n+"]<fragLoadedDelay["+(t.level-1)+"];bufferStarvationDelay:"+d.toFixed(1)+"<"+p.toFixed(1)+":"+f.toFixed(1)),r.nextLoadLevel=n,this._bwEstimator.sample(u,e.loaded),l.abort(),this.clearTimer(),r.trigger(o.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,stats:e}))}}},t.prototype.onFragLoaded=function(e){if(n=e.frag,"main"===n.type&&!isNaN(n.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n,s,t=this.hls.levels[n.level],o=(t.loaded?t.loaded.bytes:0)+e.stats.loaded,i=(t.loaded?t.loaded.duration:0)+e.frag.duration;t.loaded={bytes:o,duration:i},t.realBitrate=Math.round(8*o/i)}e.frag.bitrateTest&&(s=e.stats,s.tparsed=s.tbuffered=s.tload,this.onFragBuffered(e))}},t.prototype.onFragBuffered=function(e){var o,t=e.stats,n=e.frag;!0===t.aborted||"main"!==n.type||isNaN(n.sn)||n.bitrateTest&&t.tload!==t.tbuffered||(o=t.tparsed-t.trequest,s.b.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(o,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0)},t.prototype.onError=function(e){switch(e.details){case r.a.FRAG_LOAD_ERROR:case r.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},t.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},t.prototype._findBestLevel=function(e,t,n,o,i,a,r,c,l){for(d=i;d>=o;d--){var d,g=l[d],u=g.details,p=u?u.totalduration/u.fragments.length:t,v=!!u&&u.live,h=void 0,h=d<=e?r*n:c*n,m=l[d].realBitrate?Math.max(l[d].realBitrate,l[d].bitrate):l[d].bitrate,f=m*p/h;if(s.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+d+"/"+Math.round(h)+"/"+m+"/"+p+"/"+a+"/"+f),h>m&&(!f||v&&!this.bitrateTestDelay||f<a))return d}return-1},h(t,[{key:"nextAutoLevel",get:function(){var t,e=this._nextAutoLevel,n=this._bwEstimator;return-1===e||n&&n.canEstimate()?(t=this._nextABRAutoLevel,-1!==e&&(t=Math.min(e,t)),t):e},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var i,o=this.hls,v=o.maxAutoLevel,f=o.levels,e=o.config,d=o.minAutoLevel,t=o.media,m=this.lastLoadedFragLevel,n=this.fragCurrent?this.fragCurrent.duration:0,h=t?t.currentTime:0,b=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,u=this._bwEstimator?this._bwEstimator.getEstimate():e.abrEwmaDefaultEstimate,c=(a.a.bufferInfo(t,h,e.maxBufferHole).end-h)/b,r=this._findBestLevel(m,n,u,d,v,c,e.abrBandWidthFactor,e.abrBandWidthUpFactor,f);if(r>=0)return r;s.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var l=n?Math.min(n,e.maxStarvationDelay):e.maxStarvationDelay,p=e.abrBandWidthFactor,g=e.abrBandWidthUpFactor;return 0===c&&(i=this.bitrateTestDelay,i&&(l=(n?Math.min(n,e.maxLoadingDelay):e.maxLoadingDelay)-i,s.b.trace("bitrate test took "+Math.round(1e3*i)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*l)+" ms"),p=g=1)),r=this._findBestLevel(m,n,u,d,v,c+l,p,g,f),Math.max(r,0)}}]),t}(i.a);t.a=m},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=n(53),i=function(){function e(t,n,i,a){o(this,e),this.hls=t,this.defaultEstimate_=a,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new s.a(n),this.fast_=new s.a(i)}return e.prototype.sample=function(e,t){e=Math.max(e,this.minDelayMs_);var n=8e3*t/e,s=e/1e3;this.fast_.sample(s,n),this.slow_.sample(s,n)},e.prototype.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},e.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.prototype.destroy=function(){},e}();t.a=i},function(e,t){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(t){s(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return e.prototype.sample=function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e},e.prototype.getTotalWeight=function(){return this.totalWeight_},e.prototype.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}();t.a=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=n(1),a=n(3),s=n(0),i=n(2),d=n(12),u=Object(d.a)(),h=function(e){function t(n){r(this,t);var s=c(this,e.call(this,n,o.a.MEDIA_ATTACHING,o.a.MEDIA_DETACHING,o.a.MANIFEST_PARSED,o.a.BUFFER_RESET,o.a.BUFFER_APPENDING,o.a.BUFFER_CODECS,o.a.BUFFER_EOS,o.a.BUFFER_FLUSHING,o.a.LEVEL_PTS_UPDATED,o.a.LEVEL_UPDATED));return s._msDuration=null,s._levelDuration=null,s._live=null,s._objectUrl=null,s.onsbue=s.onSBUpdateEnd.bind(s),s.onsbe=s.onSBUpdateError.bind(s),s.pendingTracks={},s.tracks={},s}return l(t,e),t.prototype.destroy=function(){a.a.prototype.destroy.call(this)},t.prototype.onLevelPtsUpdated=function(e){var t,n,i=e.type,o=this.tracks.audio;if("audio"===i&&o&&"audio/mpeg"===o.container&&(t=this.sourceBuffer.audio,Math.abs(t.timestampOffset-e.start)>.1)){n=t.updating;try{t.abort()}catch(e){n=!0,s.b.warn("can not abort audio buffer: "+e)}n?this.audioTimestampOffset=e.start:(s.b.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+e.start),t.timestampOffset=e.start)}},t.prototype.onManifestParsed=function(e){var n=e.audio,o=e.video||e.levels.length&&e.altAudio,t=0;e.altAudio&&(n||o)&&(t=(n?1:0)+(o?1:0),s.b.log(t+" sourceBuffer(s) expected")),this.sourceBufferNb=t},t.prototype.onMediaAttaching=function(e){var t,n=this.media=e.media;n&&(t=this.mediaSource=new u,this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),t.addEventListener("sourceopen",this.onmso),t.addEventListener("sourceended",this.onmse),t.addEventListener("sourceclose",this.onmsc),n.src=URL.createObjectURL(t),this._objectUrl=n.src)},t.prototype.onMediaDetaching=function(){s.b.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){s.b.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):s.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(o.a.MEDIA_DETACHED)},t.prototype.onMediaSourceOpen=function(){s.b.log("media source opened"),this.hls.trigger(o.a.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},t.prototype.checkPendingTracks=function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())},t.prototype.onMediaSourceClose=function(){s.b.log("media source closed")},t.prototype.onMediaSourceEnded=function(){s.b.log("media source ended")},t.prototype.onSBUpdateEnd=function(){this.audioTimestampOffset&&(e=this.sourceBuffer.audio,s.b.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset),this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var e,a,t=this.parent,r=this.segments.reduce(function(e,n){return n.parent===t?e+1:e},0),n={},i=this.sourceBuffer;for(a in i)n[a]=i[a].buffered;this.hls.trigger(o.a.BUFFER_APPENDED,{parent:t,pending:r,timeRanges:n}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},t.prototype.onSBUpdateError=function(e){s.b.error("sourceBuffer error:",e),this.hls.trigger(o.a.ERROR,{type:i.b.MEDIA_ERROR,details:i.a.BUFFER_APPENDING_ERROR,fatal:!1})},t.prototype.onBufferReset=function(){var e,n,t=this.sourceBuffer;for(n in t){e=t[n];try{this.mediaSource.removeSourceBuffer(e),e.removeEventListener("updateend",this.onsbue),e.removeEventListener("error",this.onsbe)}catch{}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},t.prototype.onBufferCodecs=function(e){if(0===Object.keys(this.sourceBuffer).length){for(t in e)this.pendingTracks[t]=e[t];var t,n=this.mediaSource;n&&"open"===n.readyState&&this.checkPendingTracks()}},t.prototype.createSourceBuffers=function(e){r=this.sourceBuffer,l=this.mediaSource;for(n in e)if(!r[n]){var n,a,r,l,t=e[n],d=t.levelCodec||t.codec,c=t.container+";codecs="+d;s.b.log("creating sourceBuffer("+c+")");try{a=r[n]=l.addSourceBuffer(c),a.addEventListener("updateend",this.onsbue),a.addEventListener("error",this.onsbe),this.tracks[n]={codec:d,container:t.container},t.buffer=a}catch(e){s.b.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(o.a.ERROR,{type:i.b.MEDIA_ERROR,details:i.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:c})}}this.hls.trigger(o.a.BUFFER_CREATED,{tracks:e})},t.prototype.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},t.prototype.onBufferAppendFail=function(e){s.b.error("sourceBuffer error:",e.event),this.hls.trigger(o.a.ERROR,{type:i.b.MEDIA_ERROR,details:i.a.BUFFER_APPENDING_ERROR,fatal:!1})},t.prototype.onBufferEos=function(e){var t,n=this.sourceBuffer,o=e.type;for(t in n)o&&t!==o||n[t].ended||(n[t].ended=!0,s.b.log(t+" sourceBuffer now EOS"));this.checkEos()},t.prototype.checkEos=function(){var t,o,n=this.sourceBuffer,e=this.mediaSource;if(!e||"open"!==e.readyState)return void(this._needsEos=!1);for(o in n){if(t=n[o],!t.ended)return;if(t.updating)return void(this._needsEos=!0)}s.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch{s.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},t.prototype.onBufferFlushing=function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()},t.prototype.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._live=t.live,this.updateMediaElementDuration())},t.prototype.updateMediaElementDuration=function(){var n,t=this.hls.config,e=void 0;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(n in this.sourceBuffer)if(!0===this.sourceBuffer[n].updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(s.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||e===1/0||isNaN(e))&&(s.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},t.prototype.doFlush=function(){for(;this.flushRange.length;){if(e=this.flushRange[0],!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e,i,t=0,n=this.sourceBuffer;try{for(i in n)t+=n[i].buffered.length}catch{s.b.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(o.a.BUFFER_FLUSHED)}},t.prototype.doAppending=function(){var e,t,r,l,a=this.hls,c=this.sourceBuffer,n=this.segments;if(Object.keys(c).length){if(this.media.error)return this.segments=[],void s.b.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(n&&n.length){t=n.shift();try{l=t.type,r=c[l],r?r.updating?n.unshift(t):(r.ended=!1,this.parent=t.parent,r.appendBuffer(t.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(r){s.b.error("error while trying to append buffer:"+r.message),n.unshift(t),e={type:i.b.MEDIA_ERROR,parent:t.parent},22!==r.code?(this.appendError?this.appendError++:this.appendError=1,e.details=i.a.BUFFER_APPEND_ERROR,this.appendError>a.config.appendErrorMaxRetry?(s.b.log("fail "+a.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),n=[],e.fatal=!0,a.trigger(o.a.ERROR,e)):(e.fatal=!1,a.trigger(o.a.ERROR,e))):(this.segments=[],e.details=i.a.BUFFER_FULL_ERROR,e.fatal=!1,a.trigger(o.a.ERROR,e))}}}},t.prototype.flushBuffer=function(e,t,n){var u,o=void 0,i=void 0,l=void 0,c=void 0,a=void 0,r=void 0,d=this.sourceBuffer;if(Object.keys(d).length){if(s.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(u in d)if(!n||u===n){if(o=d[u],o.ended=!1,o.updating)return s.b.warn("cannot flush, sb updating in progress"),!1;try{for(i=0;i<o.buffered.length;i++)if(l=o.buffered.start(i),c=o.buffered.end(i),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(a=e,r=t):(a=Math.max(l,e),r=Math.min(c,t)),Math.min(r,c)-a>.5)return this.flushBufferCounter++,s.b.log("flush "+u+" ["+a+","+r+"], of ["+l+","+c+"], pos:"+this.media.currentTime),o.remove(a,r),!1}catch{s.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else s.b.warn("abort flushing too many retries");s.b.log("buffer flushed")}return!0},t}(a.a);t.a=h},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(1),r=n(3),c=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=function(e){function t(n){return o(this,t),i(this,e.call(this,n,s.a.FPS_DROP_LEVEL_CAPPING,s.a.MEDIA_ATTACHING,s.a.MANIFEST_PARSED))}return a(t,e),t.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))},t.prototype.onFpsDropLevelCapping=function(e){t.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},t.prototype.onMediaAttaching=function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null},t.prototype.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],t.config.capLevelToPlayerSize&&(e.video||e.levels.length&&e.altAudio)&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,t.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.prototype.detectPlayerSize=function(){if(this.media){var e,t=this.levels?this.levels.length:0;t&&(e=this.hls,e.autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping)}},t.prototype.getMaxLevel=function(e){var n,s=this;return this.levels?(n=this.levels.filter(function(n,o){return t.isLevelAllowed(o,s.restrictedLevels)&&o<=e}),t.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)):-1},t.isLevelAllowed=function(e){return-1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).indexOf(e)},t.getMaxLevelByMediaSize=function(e,t,n){if(!e||e&&!e.length)return-1;for(var o,i=e.length-1,s=0;s<e.length;s+=1)if(o=e[s],(o.width>=t||o.height>=n)&&function(e,t){return!t||e.width!==t.width||e.height!==t.height}(o,e[s+1])){i=s;break}return i},c(t,[{key:"mediaWidth",get:function(){var n=void 0,e=this.media;return e&&(n=e.width||e.clientWidth||e.offsetWidth,n*=t.contentScaleFactor),n}},{key:"mediaHeight",get:function(){var n=void 0,e=this.media;return e&&(n=e.height||e.clientHeight||e.offsetHeight,n*=t.contentScaleFactor),n}}],[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch{}return e}}]),t}(r.a);t.a=l},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(1),r=n(3),c=n(0),l=function(e){function t(n){return o(this,t),i(this,e.call(this,n,s.a.MEDIA_ATTACHING))}return a(t,e),t.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},t.prototype.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},t.prototype.checkFPS=function(e,t,n){if(a=performance.now(),t){if(this.lastTime){var i,a,d=a-this.lastTime,r=n-this.lastDroppedFrames,l=t-this.lastDecodedFrames,u=1e3*r/d,o=this.hls;o.trigger(s.a.FPS_DROP,{currentDropped:r,currentDecoded:l,totalDroppedFrames:n}),u>0&&r>o.config.fpsDroppedMonitoringThreshold*l&&(i=o.currentLevel,c.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+i),i>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=i)&&(i-=1,o.trigger(s.a.FPS_DROP_LEVEL_CAPPING,{level:i,droppedLevel:o.currentLevel}),o.autoLevelCapping=i,o.streamController.nextLevelSwitch()))}this.lastTime=a,this.lastDroppedFrames=n,this.lastDecodedFrames=t}},t.prototype.checkFPSInterval=function(){var t,e=this.video;e&&(this.isVideoPlaybackQualityAvailable?(t=e.getVideoPlaybackQuality(),this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)):this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount))},t}(r.a);t.a=l},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=n(0),i=function(){function e(t){o(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return e.prototype.destroy=function(){this.abort(),this.loader=null},e.prototype.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},e.prototype.load=function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},e.prototype.loadInternal=function(){var n,e=void 0,t=this.context,e=this.loader=new XMLHttpRequest,s=this.stats;s.tfirst=0,s.loaded=0,n=this.xhrSetup;try{if(n)try{n(e,t.url)}catch{e.open("GET",t.url,!0),n(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(n){return void this.callbacks.onError({code:e.status,text:n.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},e.prototype.readystatechange=function(e){var o,i,r,d,n=e.currentTarget,l=n.readyState,t=this.stats,a=this.context,c=this.config;!t.aborted&&l>=2&&(window.clearTimeout(this.requestTimeout),0===t.tfirst&&(t.tfirst=Math.max(performance.now(),t.trequest)),4===l?(o=n.status,o>=200&&o<300?(t.tload=Math.max(t.tfirst,performance.now()),i=void 0,r=void 0,"arraybuffer"===a.responseType?(i=n.response,r=i.byteLength):(i=n.responseText,r=i.length),t.loaded=t.total=r,d={url:n.responseURL,data:i},this.callbacks.onSuccess(d,t,a,n)):t.retry>=c.maxRetry||o>=400&&o<499?(s.b.error(o+" while loading "+a.url),this.callbacks.onError({code:o,text:n.statusText},a,n)):(s.b.warn(o+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,c.maxRetryDelay),t.retry++)):this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),c.timeout))},e.prototype.loadtimeout=function(){s.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},e.prototype.loadprogress=function(e){var n,s=e.currentTarget,t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total),n=this.callbacks.onProgress,n&&n(t,this.context,null,s)},e}();t.a=i},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(1),i=n(3),o=n(0),l=n(2),d=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),u=function(e){function t(n){a(this,t);var o=r(this,e.call(this,n,s.a.MANIFEST_LOADING,s.a.MANIFEST_PARSED,s.a.AUDIO_TRACK_LOADED,s.a.ERROR));return o.ticks=0,o.ontick=o.tick.bind(o),o}return c(t,e),t.prototype.destroy=function(){this.cleanTimer(),i.a.prototype.destroy.call(this)},t.prototype.cleanTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.tick=function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},t.prototype.doTick=function(){this.updateTrack(this.trackId)},t.prototype.onError=function(e){e.fatal&&e.type===l.b.NETWORK_ERROR&&this.cleanTimer()},t.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},t.prototype.onManifestParsed=function(e){var i,a=this,t=e.audioTracks||[],n=!1;this.tracks=t,this.hls.trigger(s.a.AUDIO_TRACKS_UPDATED,{audioTracks:t}),i=0,t.forEach(function(e){if(e.default&&!n)return a.audioTrack=i,void(n=!0);i++}),!1===n&&t.length&&(o.b.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)},t.prototype.onAudioTrackLoaded=function(e){e.id<this.tracks.length&&(o.b.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&this.cleanTimer())},t.prototype.setAudioTrackInternal=function(e){if(e>=0&&e<this.tracks.length){this.cleanTimer(),this.trackId=e,o.b.log("switching to audioTrack "+e);var i,t=this.tracks[e],a=this.hls,r=t.type,n=t.url,c={id:e,type:r,url:n};a.trigger(s.a.AUDIO_TRACK_SWITCHING,c),i=t.details,!n||void 0!==i&&!0!==i.live||(o.b.log("(re)loading playlist for audioTrack "+e),a.trigger(s.a.AUDIO_TRACK_LOADING,{url:n,id:e}))}},t.prototype.updateTrack=function(e){if(e>=0&&e<this.tracks.length){this.cleanTimer(),this.trackId=e,o.b.log("updating audioTrack "+e);var t=this.tracks[e],n=t.url,i=t.details;!n||void 0!==i&&!0!==i.live||(o.b.log("(re)loading playlist for audioTrack "+e),this.hls.trigger(s.a.AUDIO_TRACK_LOADING,{url:n,id:e}))}},d(t,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.trackId===e&&void 0!==this.tracks[e].details||this.setAudioTrackInternal(e)}}]),t}(i.a);t.a=u},function(e,t,n){"use strict";function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=n(8),r=n(9),d=n(18),o=n(1),c=n(22),l=n(23),a=n(2),i=n(0),f=n(24),p=n(13),g=n(7),v=n(6),b=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),s={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},y=function(e){function t(n,i){u(this,t);var a=j(this,e.call(this,n,o.a.MEDIA_ATTACHED,o.a.MEDIA_DETACHING,o.a.AUDIO_TRACKS_UPDATED,o.a.AUDIO_TRACK_SWITCHING,o.a.AUDIO_TRACK_LOADED,o.a.KEY_LOADED,o.a.FRAG_LOADED,o.a.FRAG_PARSING_INIT_SEGMENT,o.a.FRAG_PARSING_DATA,o.a.FRAG_PARSED,o.a.ERROR,o.a.BUFFER_RESET,o.a.BUFFER_CREATED,o.a.BUFFER_APPENDED,o.a.BUFFER_FLUSHED,o.a.INIT_PTS_FOUND));return a.fragmentTracker=i,a.config=n.config,a.audioCodecSwap=!1,a._state=s.STOPPED,a.initPTS=[],a.waitingFragment=null,a.videoTrackCC=null,a}return m(t,e),t.prototype.onHandlerDestroying=function(){this.stopLoad()},t.prototype.onHandlerDestroyed=function(){this.state=s.STOPPED,this.fragmentTracker=null},t.prototype.onInitPtsFound=function(e){var o=e.id,t=e.frag.cc,n=e.initPTS;"main"===o&&(this.initPTS[t]=n,this.videoTrackCC=t,i.b.log("InitPTS for cc: "+t+" found from video track: "+n),this.state===s.WAITING_INIT_PTS&&this.tick())},t.prototype.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(i.b.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=s.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=s.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=s.STOPPED},t.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=s.STOPPED},t.prototype.doTick=function(){var d=void 0,u=void 0,t=void 0,M=this.hls,m=M.config;switch(this.state){case s.ERROR:case s.PAUSED:case s.BUFFER_FLUSHING:break;case s.STARTING:this.state=s.WAITING_TRACK,this.loadedmetadata=!1;break;case s.IDLE:if(w=this.tracks,!w)break;if(!this.media&&(this.startFragRequested||!m.startFragPrefetch))break;if(this.loadedmetadata)d=this.media.currentTime;else if(void 0===(d=this.nextLoadPosition))break;var y,w,x,C,E,S,F,D,_=this.mediaBuffer?this.mediaBuffer:this.media,L=this.videoBuffer?this.videoBuffer:this.media,l=r.a.bufferInfo(_,d,m.maxBufferHole),R=r.a.bufferInfo(L,d,m.maxBufferHole),N=l.len,a=l.end,c=this.fragPrevious,H=Math.min(m.maxBufferLength,m.maxMaxBufferLength),P=Math.max(H,R.len),j=this.audioSwitch,b=this.trackId;if((N<P||j)&&b<w.length){if(void 0===(t=w[b].details)){this.state=s.WAITING_TRACK;break}if(!j&&!t.live&&c&&c.sn===t.endSN&&!l.nextStart&&(!this.media.seeking||this.media.duration-a<c.duration/2)){this.hls.trigger(o.a.BUFFER_EOS,{type:"audio"}),this.state=s.ENDED;break}var n=t.fragments,k=n.length,p=n[0].start,T=n[k-1].start+n[k-1].duration,e=void 0;if(j)if(t.live&&!t.PTSKnown)i.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),a=0;else if(a=d,t.PTSKnown&&d<p){if(!(l.end>p||l.nextStart))return;i.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=p+.05}if(t.initSegment&&!t.initSegment.data)e=t.initSegment;else if(a<=p){if(e=n[0],null!==this.videoTrackCC&&e.cc!==this.videoTrackCC&&(e=Object(f.b)(n,this.videoTrackCC)),t.live&&e.loadIdx&&e.loadIdx===this.fragLoadIdx)return S=l.nextStart?l.nextStart:p,i.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(S+.05)),void(this.media.currentTime=S+.05)}else{var v=void 0,O=m.maxFragLookUpTolerance,A=c?n[c.sn-n[0].sn+1]:void 0,z=function(e){var t=Math.min(O,e.duration);return e.start+e.duration-t<=a?1:e.start-t>a&&e.start?-1:0};a<T?(a>T-O&&(O=0),v=A&&!z(A)?A:h.a.search(n,z)):v=n[k-1],v&&(e=v,p=v.start,c&&e.level===c.level&&e.sn===c.sn&&(e.sn<t.endSN?(e=n[e.sn+1-t.startSN],i.b.log("SN just loaded, load next one: "+e.sn)):e=null))}e&&(e.decryptdata&&null!=e.decryptdata.uri&&null==e.decryptdata.key?(i.b.log("Loading key for "+e.sn+" of ["+t.startSN+" ,"+t.endSN+"],track "+b),this.state=s.KEY_LOADING,M.trigger(o.a.KEY_LOADING,{frag:e})):(i.b.log("Loading "+e.sn+", cc: "+e.cc+" of ["+t.startSN+" ,"+t.endSN+"],track "+b+", currentTime:"+d+",bufferEnd:"+a.toFixed(3)),(j||this.fragmentTracker.getState(e)===g.a.NOT_LOADED)&&(this.fragCurrent=e,this.startFragRequested=!0,isNaN(e.sn)||(this.nextLoadPosition=e.start+e.duration),M.trigger(o.a.FRAG_LOADING,{frag:e}),this.state=s.FRAG_LOADING)))}break;case s.WAITING_TRACK:u=this.tracks[this.trackId],u&&u.details&&(this.state=s.IDLE);break;case s.FRAG_LOADING_WAITING_RETRY:F=performance.now(),E=this.retryDate,_=this.media,D=_&&_.seeking,(!E||F>=E||D)&&(i.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=s.IDLE);break;case s.WAITING_INIT_PTS:if(y=this.videoTrackCC,void 0===this.initPTS[y])break;C=this.waitingFragment,C?(x=C.frag.cc,y!==x?(u=this.tracks[this.trackId],u.details&&u.details.live&&(i.b.warn("Waiting fragment CC ("+x+") does not match video track CC ("+y+")"),this.waitingFragment=null,this.state=s.IDLE)):(this.state=s.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)):this.state=s.IDLE;break;case s.STOPPED:case s.FRAG_LOADING:case s.PARSING:case s.PARSED:case s.ENDED:}},t.prototype.onMediaAttached=function(e){var t,n=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended),t=this.config,this.tracks&&t.autoStartLoad&&this.startLoad(t.startPosition)},t.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(i.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},t.prototype.onMediaSeeking=function(){this.state===s.ENDED&&(this.state=s.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),this.tick()},t.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},t.prototype.onAudioTracksUpdated=function(e){i.b.log("audio tracks updated"),this.tracks=e.audioTracks},t.prototype.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=s.PAUSED,this.waitingFragment=null,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=s.IDLE),this.tick()},t.prototype.onAudioTrackLoaded=function(e){var n,o,t=e.details,a=e.id,r=this.tracks[a],d=t.totalduration,l=0;i.b.log("track "+a+" loaded ["+t.startSN+","+t.endSN+"],duration:"+d),t.live?(o=r.details,o&&t.fragments.length>0?(c.a(o,t),l=t.fragments[0].start,t.PTSKnown?i.b.log("live audio playlist sliding:"+l.toFixed(3)):i.b.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,i.b.log("live audio playlist - first load, unknown sliding"))):t.PTSKnown=!1,(r.details=t,!this.startFragRequested)&&(-1===this.startPosition&&(n=t.startTimeOffset,isNaN(n)?this.startPosition=0:(i.b.log("start time offset found in playlist, adjust startPosition to "+n),this.startPosition=n)),this.nextLoadPosition=this.startPosition),this.state===s.WAITING_TRACK&&(this.state=s.IDLE),this.tick()},t.prototype.onKeyLoaded=function(){this.state===s.KEY_LOADING&&(this.state=s.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){if(t=this.fragCurrent,a=e.frag,this.state===s.FRAG_LOADING&&t&&"audio"===a.type&&a.level===t.level&&a.sn===t.sn){var t,a,l,f,u=this.tracks[this.trackId],n=u.details,p=n.totalduration,h=t.level,r=t.sn,m=t.cc,g=this.config.defaultAudioCodec||u.audioCodec||"mp4a.40.2",c=this.stats=e.stats;"initSegment"===r?(this.state=s.IDLE,c.tparsed=c.tbuffered=performance.now(),n.initSegment.data=e.payload,this.hls.trigger(o.a.FRAG_BUFFERED,{stats:c,frag:t,id:"audio"}),this.tick()):(this.state=s.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new d.a(this.hls,"audio")),l=this.initPTS[m],f=n.initSegment?n.initSegment.data:[],n.initSegment||void 0!==l?(this.pendingBuffering=!0,i.b.log("Demuxing "+r+" of ["+n.startSN+" ,"+n.endSN+"],track "+h),this.demuxer.push(e.payload,f,g,null,t,p,!1,l)):(i.b.log("unknown video PTS for continuity counter "+m+", waiting for video PTS before demuxing audio frag "+r+" of ["+n.startSN+" ,"+n.endSN+"],track "+h),this.waitingFragment=e,this.state=s.WAITING_INIT_PTS))}this.fragLoadError=0},t.prototype.onFragParsingInitSegment=function(e){var t,n,r,c,a=this.fragCurrent,l=e.frag;a&&"audio"===e.id&&l.sn===a.sn&&l.level===a.level&&this.state===s.PARSING&&(n=e.tracks,t=void 0,(n.video&&delete n.video,t=n.audio)&&(t.levelCodec=t.codec,t.id=e.id,this.hls.trigger(o.a.BUFFER_CODECS,n),i.b.log("audio track:audio,container:"+t.container+",codecs[level/parsed]=["+t.levelCodec+"/"+t.codec+"]"),r=t.initSegment,r&&(c={type:"audio",data:r,parent:"audio",content:"initSegment"},this.audioSwitch?this.pendingData=[c]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(o.a.BUFFER_APPENDING,c))),this.tick()))},t.prototype.onFragParsingData=function(e){var n,h,l=this,t=this.fragCurrent,m=e.frag;if(t&&"audio"===e.id&&"audio"===e.type&&m.sn===t.sn&&m.level===t.level&&this.state===s.PARSING){var d=this.trackId,p=this.tracks[d],r=this.hls;isNaN(e.endPTS)&&(e.endPTS=e.startPTS+t.duration,e.endDTS=e.startDTS+t.duration),t.addElementaryStream(v.a.ElementaryStreamTypes.AUDIO),i.b.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),c.b(p.details,t,e.startPTS,e.endPTS);var g=this.audioSwitch,u=this.media,f=!1;if(g&&u&&(u.readyState?(h=u.currentTime,i.b.log("switching audio track : currentTime:"+h),h>=e.startPTS&&(i.b.log("switching audio track : flushing all audio"),this.state=s.BUFFER_FLUSHING,r.trigger(o.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),f=!0,this.audioSwitch=!1,r.trigger(o.a.AUDIO_TRACK_SWITCHED,{id:d}))):(this.audioSwitch=!1,r.trigger(o.a.AUDIO_TRACK_SWITCHED,{id:d}))),n=this.pendingData,!n)return console.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void r.trigger(o.a.ERROR,{type:a.b.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&n.push({type:e.type,data:t,parent:"audio",content:"data"})}),!f&&n.length&&(n.forEach(function(e){l.state===s.PARSING&&(l.pendingBuffering=!0,l.hls.trigger(o.a.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}},t.prototype.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===s.PARSING&&(this.stats.tparsed=performance.now(),this.state=s.PARSED,this._checkAppendedParsed())},t.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},t.prototype.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},t.prototype.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==s.PARSING&&t!==s.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},t.prototype._checkAppendedParsed=function(){if(!(this.state!==s.PARSED||this.appended&&this.pendingBuffering)){var a,e=this.fragCurrent,t=this.stats,n=this.hls;e&&(this.fragPrevious=e,t.tbuffered=performance.now(),n.trigger(o.a.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"}),a=this.mediaBuffer?this.mediaBuffer:this.media,i.b.log("audio buffered : "+l.a.toString(a.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(o.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=s.IDLE),this.tick()}},t.prototype.onError=function(e){if(l=e.frag,!l||"audio"===l.type)switch(e.details){case a.a.FRAG_LOAD_ERROR:case a.a.FRAG_LOAD_TIMEOUT:e.fatal||(t=this.fragLoadError,t?t++:t=1,c=this.config,t<=c.fragLoadingMaxRetry?(this.fragLoadError=t,d=Math.min(Math.pow(2,t-1)*c.fragLoadingRetryDelay,c.fragLoadingMaxRetryTimeout),i.b.warn("audioStreamController: frag loading failed, retry in "+d+" ms"),this.retryDate=performance.now()+d,this.state=s.FRAG_LOADING_WAITING_RETRY):(i.b.error("audioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=s.ERROR));break;case a.a.AUDIO_TRACK_LOAD_ERROR:case a.a.AUDIO_TRACK_LOAD_TIMEOUT:case a.a.KEY_LOAD_ERROR:case a.a.KEY_LOAD_TIMEOUT:this.state!==s.ERROR&&(this.state=e.fatal?s.ERROR:s.IDLE,i.b.warn("audioStreamController: "+e.details+" while loading frag,switch to "+this.state+" state ..."));break;case a.a.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===s.PARSING||this.state===s.PARSED)){var t,n,c,l,d,u=this.mediaBuffer,h=this.media.currentTime;u&&r.a.isBuffered(u,h)&&r.a.isBuffered(u,h+.5)?(n=this.config,n.maxMaxBufferLength>=n.maxBufferLength&&(n.maxMaxBufferLength/=2,i.b.warn("audio:reduce max buffer length to "+n.maxMaxBufferLength+"s")),this.state=s.IDLE):(i.b.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=s.BUFFER_FLUSHING,this.hls.trigger(o.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}))}}},t.prototype.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(i.b.log("appending pending audio data on Buffer Flushed"),e.forEach(function(e){t.hls.trigger(o.a.BUFFER_APPENDING,e)}),this.appended=!0,this.pendingData=[],this.state=s.PARSED):(this.state=s.IDLE,this.fragPrevious=null,this.tick())},b(t,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,i.b.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),t}(p.a);t.a=y},function(e,t,n){"use strict";function s(e,t,n,s){for(var l,a=void 0,r=void 0,d=void 0,c=void 0,u=void 0,h=window.VTTCue||window.TextTrackCue,i=0;i<s.rows.length;i++)if(a=s.rows[i],d=!0,c=0,u="",!a.isEmpty()){for(l=0;l<a.chars.length;l++)a.chars[l].uchar.match(/\s/)&&d?c++:(u+=a.chars[l].uchar,d=!1);a.cueStartTime=t,t===n&&(n+=1e-4),r=new h(t,n,Object(o.b)(u.trim())),c>=16?c--:c++,navigator.userAgent.match(/Firefox\//)?r.line=i+1:r.line=i>7?i-2:i+1,r.align="left",r.position=Math.max(0,Math.min(100,c/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.newCue=s;var o=n(26)},function(e,t){"use strict";t.a=function(){function s(e){return"string"==typeof e&&!!i[e.toLowerCase()]&&e.toLowerCase()}function t(e){return"string"==typeof e&&!!a[e.toLowerCase()]&&e.toLowerCase()}function e(e){for(var n,s,t=1;t<arguments.length;t++){n=arguments[t];for(s in n)e[s]=n[s]}return e}function n(n,i,a){var r=this,p=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),c={};p?r=document.createElement("custom"):c.enumerable=!0,r.hasBeenReset=!1;var g="",u=!1,h=n,m=i,f=a,l=null,d="",v=!0,b="auto",j="start",y=50,_="middle",w=50,O="middle";if(Object.defineProperty(r,"id",e({},c,{get:function(){return g},set:function(e){g=""+e}})),Object.defineProperty(r,"pauseOnExit",e({},c,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(r,"startTime",e({},c,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"endTime",e({},c,{get:function(){return m},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"text",e({},c,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(r,"region",e({},c,{get:function(){return l},set:function(e){l=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"vertical",e({},c,{get:function(){return d},set:function(e){var t=s(e);if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"snapToLines",e({},c,{get:function(){return v},set:function(e){v=!!e,this.hasBeenReset=!0}})),Object.defineProperty(r,"line",e({},c,{get:function(){return b},set:function(e){if("number"!=typeof e&&e!==o)throw new SyntaxError("An invalid number or illegal string was specified.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"lineAlign",e({},c,{get:function(){return j},set:function(e){var n=t(e);if(!n)throw new SyntaxError("An invalid or illegal string was specified.");j=n,this.hasBeenReset=!0}})),Object.defineProperty(r,"position",e({},c,{get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"positionAlign",e({},c,{get:function(){return _},set:function(e){var n=t(e);if(!n)throw new SyntaxError("An invalid or illegal string was specified.");_=n,this.hasBeenReset=!0}})),Object.defineProperty(r,"size",e({},c,{get:function(){return w},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");w=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"align",e({},c,{get:function(){return O},set:function(e){var n=t(e);if(!n)throw new SyntaxError("An invalid or illegal string was specified.");O=n,this.hasBeenReset=!0}})),r.displayState=void 0,p)return r}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var o="auto",i={"":!0,lr:!0,rl:!0},a={start:!0,middle:!0,end:!0,left:!0,right:!0};return n.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},n}()},function(e,t,n){"use strict";function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){return e&&e.label===t.name&&!e.textTrack1&&!e.textTrack2}function c(e,t,n,s){return Math.min(t,s)-Math.max(e,n)}var s=n(1),a=n(3),d=n(63),i=n(64),h=n(65),m=n(0),o=n(25),p=function(e){function t(n){if(l(this,t),o=f(this,e.call(this,n,s.a.MEDIA_ATTACHING,s.a.MEDIA_DETACHING,s.a.FRAG_PARSING_USERDATA,s.a.FRAG_DECRYPTED,s.a.MANIFEST_LOADING,s.a.MANIFEST_LOADED,s.a.FRAG_LOADED,s.a.LEVEL_SWITCHING,s.a.INIT_PTS_FOUND)),o.hls=n,o.config=n.config,o.enabled=!0,o.Cues=n.config.cueHandler,o.textTracks=[],o.tracks=[],o.unparsedVttFrags=[],o.initPTS=void 0,o.cueRanges=[],o.captionsTracks={},o.captionsProperties={textTrack1:{label:o.config.captionsTextTrack1Label,languageCode:o.config.captionsTextTrack1LanguageCode},textTrack2:{label:o.config.captionsTextTrack2Label,languageCode:o.config.captionsTextTrack2LanguageCode}},o.config.enableCEA708Captions){var o,a=new i.a(o,"textTrack1"),r=new i.a(o,"textTrack2");o.cea608Parser=new d.a(0,a,r)}return o}return u(t,e),t.prototype.addCues=function(e,t,n,s){for(var o,a,i=this.cueRanges,r=!1,l=i.length;l--;)if(o=i[l],a=c(o[0],o[1],t,n),a>=0&&(o[0]=Math.min(o[0],t),o[1]=Math.max(o[1],n),r=!0,a/(n-t)>.5))return;r||i.push([t,n]),this.Cues.newCue(this.captionsTracks[e],t,n,s)},t.prototype.onInitPtsFound=function(e){var t=this;void 0===this.initPTS&&(this.initPTS=e.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(e){t.onFragLoaded(e)}),this.unparsedVttFrags=[])},t.prototype.getExistingTrack=function(e){var t,s,n=this.media;if(n)for(t=0;t<n.textTracks.length;t++)if(s=n.textTracks[t],s[e])return s;return null},t.prototype.createCaptionsTrack=function(e){var n,s,i=this.captionsProperties[e],a=i.label,r=i.languageCode,t=this.captionsTracks;t[e]||(s=this.getExistingTrack(e),s?(t[e]=s,Object(o.a)(t[e]),Object(o.b)(t[e],this.media)):(n=this.createTextTrack("captions",a,r),n&&(n[e]=!0,t[e]=n)))},t.prototype.createTextTrack=function(e,t,n){var s=this.media;if(s)return s.addTextTrack(e,t,n)},t.prototype.destroy=function(){a.a.prototype.destroy.call(this)},t.prototype.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},t.prototype.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){Object(o.a)(e[t]),delete e[t]})},t.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},t.prototype._cleanTracks=function(){var e,t,n=this.media;if(n&&(e=n.textTracks,e))for(t=0;t<e.length;t++)Object(o.a)(e[t])},t.prototype.onManifestLoaded=function(e){var n,t=this;this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT&&(this.tracks=e.subtitles||[],n=this.media?this.media.textTracks:[],this.tracks.forEach(function(e,s){var i,o=void 0;s<n.length&&(i=n[s],r(i,e)&&(o=i)),o||(o=t.createTextTrack("subtitles",e.name,e.lang)),e.default?o.mode=t.hls.subtitleDisplay?"showing":"hidden":o.mode="disabled",t.textTracks.push(o)}))},t.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},t.prototype.onFragLoaded=function(e){var n,o,i,t=e.frag,a=e.payload;if("main"===t.type)o=t.sn,o!==this.lastSn+1&&(i=this.cea608Parser,i&&i.reset()),this.lastSn=o;else if("subtitle"===t.type)if(a.byteLength){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(e);n=t.decryptdata,n!=null&&null!=n.key&&"AES-128"===n.method||this._parseVTTs(t,a)}else this.hls.trigger(s.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},t.prototype._parseVTTs=function(e,t){n=this.vttCCs,n[e.cc]||(n[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);var n,i=this.textTracks,o=this.hls;h.a.parse(t,this.initPTS,n,e.cc,function(t){var n=i[e.trackId];if("disabled"===n.mode)return void o.trigger(s.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e});t.forEach(function(e){if(!n.cues.getCueById(e.id))try{n.addCue(e)}catch{var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,n.addCue(t)}}),o.trigger(s.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){m.b.log("Failed to parse VTT cue: "+t),o.trigger(s.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},t.prototype.onFragDecrypted=function(e){var n=e.payload,t=e.frag;if("subtitle"===t.type){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(e);this._parseVTTs(t,n)}},t.prototype.onFragParsingUserdata=function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var n,t=0;t<e.samples.length;t++)n=this.extractCea608Data(e.samples[t].bytes),this.cea608Parser.addData(e.samples[t].pts,n)},t.prototype.extractCea608Data=function(e){for(var l=31&e[0],t=2,n=void 0,s=void 0,o=void 0,a=void 0,r=void 0,i=[],c=0;c<l;c++)n=e[t++],s=127&e[t++],o=127&e[t++],a=0!=(4&n),r=3&n,0===s&&0===o||a&&0===r&&(i.push(s),i.push(o));return i},t}(a.a);t.a=p},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},d=function(e){var t=e;return u.hasOwnProperty(e)&&(t=u[e]),String.fromCharCode(t)},o=15,i=100,v={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},g={17:2,18:4,21:6,22:8,23:10,19:13,20:15},m={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},p=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],s={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var n=this.verboseFilter[e];this.verboseLevel>=n&&console.log(this.time+" ["+e+"] "+t)}},a=function(e){for(var n=[],t=0;t<e.length;t++)n.push(e[t].toString(16));return n},l=function(){function e(t,n,s,o,i){r(this,e),this.foreground=t||"white",this.underline=n||!1,this.italics=s||!1,this.background=o||"black",this.flash=i||!1}return e.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.prototype.setStyles=function(e){for(var t,s=["foreground","underline","italics","background","flash"],n=0;n<s.length;n++)t=s[n],e.hasOwnProperty(t)&&(this[t]=e[t])},e.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.prototype.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},e.prototype.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},e.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),b=function(){function e(t,n,s,o,i,a){r(this,e),this.uchar=t||" ",this.penState=new l(n,s,o,i,a)}return e.prototype.reset=function(){this.uchar=" ",this.penState.reset()},e.prototype.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},e.prototype.setPenState=function(e){this.penState.copy(e)},e.prototype.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},e.prototype.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},e.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),j=function(){function e(){r(this,e),this.chars=[];for(var t=0;t<i;t++)this.chars.push(new b);this.pos=0,this.currPenState=new l}return e.prototype.equals=function(e){for(var n=!0,t=0;t<i;t++)if(!this.chars[t].equals(e.chars[t])){n=!1;break}return n},e.prototype.copy=function(e){for(var t=0;t<i;t++)this.chars[t].copy(e.chars[t])},e.prototype.isEmpty=function(){for(var t=!0,e=0;e<i;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},e.prototype.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(s.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>i&&(s.log("ERROR","Too large cursor position "+this.pos),this.pos=i)},e.prototype.moveCursor=function(e){var t,n=this.pos+e;if(e>1)for(t=this.pos+1;t<n+1;t++)this.chars[t].setPenState(this.currPenState);this.setCursor(n)},e.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.prototype.insertChar=function(e){e>=144&&this.backSpace();var t=d(e);if(this.pos>=i)return void s.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)},e.prototype.clearFromPos=function(e){var t=void 0;for(t=e;t<i;t++)this.chars[t].reset()},e.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.prototype.getTextString=function(){for(var t,n=[],s=!0,e=0;e<i;e++)t=this.chars[e].uchar," "!==t&&(s=!1),n.push(t);return s?"":n.join("")},e.prototype.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),c=function(){function e(){r(this,e),this.rows=[];for(var t=0;t<o;t++)this.rows.push(new j);this.currRow=o-1,this.nrRollUpRows=null,this.reset()}return e.prototype.reset=function(){for(var e=0;e<o;e++)this.rows[e].clear();this.currRow=o-1},e.prototype.equals=function(e){for(var n=!0,t=0;t<o;t++)if(!this.rows[t].equals(e.rows[t])){n=!1;break}return n},e.prototype.copy=function(e){for(var t=0;t<o;t++)this.rows[t].copy(e.rows[t])},e.prototype.isEmpty=function(){for(var t=!0,e=0;e<o;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},e.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},e.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.prototype.insertChar=function(e){this.rows[this.currRow].insertChar(e)},e.prototype.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},e.prototype.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},e.prototype.setCursor=function(e){s.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},e.prototype.setPAC=function(e){if(s.log("INFO","pacData = "+JSON.stringify(e)),t=e.row-1,this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(i=0;i<o;i++)this.rows[i].clear();var t,n,i,r,c,d,u,h,l=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a&&(r=a.rows[l].cueStartTime,r&&r<s.time))for(n=0;n<this.nrRollUpRows;n++)this.rows[t-this.nrRollUpRows+n+1].copy(a.rows[l+n])}this.currRow=t,c=this.rows[this.currRow],null!==e.indent&&(d=e.indent,u=Math.max(d-1,0),c.setCursor(e.indent),e.color=c.chars[u].penState.foreground),h={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1},this.setPen(h)},e.prototype.setBkgData=function(e){s.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},e.prototype.setRollUpRows=function(e){this.nrRollUpRows=e},e.prototype.rollUp=function(){if(null===this.nrRollUpRows)return void s.log("DEBUG","roll_up but nrRollUpRows not set yet");s.log("TEXT",this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),s.log("INFO","Rolling up")},e.prototype.getDisplayText=function(e){e=e||!1;for(var s,t=[],i="",a=-1,n=0;n<o;n++)s=this.rows[n].getTextString(),s&&(a=n+1,e?t.push("Row "+a+": '"+s+"'"):t.push(s.trim()));return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join(`
`)),i},e.prototype.getTextAndFormat=function(){return this.rows},e}(),h=function(){function e(t,n){r(this,e),this.chNr=t,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new c,this.nonDisplayedMemory=new c,this.lastOutputScreen=new c,this.currRollUpRow=this.displayedMemory.rows[o-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return e.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[o-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},e.prototype.getHandler=function(){return this.outputFilter},e.prototype.setHandler=function(e){this.outputFilter=e},e.prototype.setPAC=function(e){this.writeScreen.setPAC(e)},e.prototype.setBkgData=function(e){this.writeScreen.setBkgData(e)},e.prototype.setMode=function(e){e!==this.mode&&(this.mode=e,s.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},e.prototype.insertChars=function(e){for(var n,t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP",s.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(s.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.prototype.ccRCL=function(){s.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.prototype.ccBS=function(){s.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.prototype.ccAOF=function(){},e.prototype.ccAON=function(){},e.prototype.ccDER=function(){s.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.prototype.ccRU=function(e){s.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},e.prototype.ccFON=function(){s.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.prototype.ccRDC=function(){s.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.prototype.ccTR=function(){s.log("INFO","TR"),this.setMode("MODE_TEXT")},e.prototype.ccRTD=function(){s.log("INFO","RTD"),this.setMode("MODE_TEXT")},e.prototype.ccEDM=function(){s.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.prototype.ccCR=function(){s.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.prototype.ccENM=function(){s.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.prototype.ccEOC=function(){if(s.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,s.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.prototype.ccTO=function(e){s.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},e.prototype.ccMIDROW=function(e){if(t={flash:!1},t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var t,n=Math.floor(e/2)-16,o=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=o[n]}s.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},e.prototype.outputDataUpdate=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=s.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),!0===t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},e.prototype.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),y=function(){function e(t,n,s){r(this,e),this.field=t||1,this.outputs=[n,s],this.channels=[new h(1,n),new h(2,s)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return e.prototype.getHandler=function(e){return this.channels[e].getHandler()},e.prototype.setHandler=function(e,t){this.channels[e].setHandler(t)},e.prototype.addData=function(e,t){var r,l,n=void 0,o=void 0,i=void 0,c=!1;this.lastTime=e,s.setTime(e);for(r=0;r<t.length;r+=2)o=127&t[r],i=127&t[r+1],0!==o||0!==i?((s.log("DATA","["+a([t[r],t[r+1]])+"] -> ("+a([o,i])+")"),n=this.parseCmd(o,i),n||(n=this.parseMidrow(o,i)),n||(n=this.parsePAC(o,i)),n||(n=this.parseBackgroundAttributes(o,i)),!n&&(c=this.parseChars(o,i)))&&(this.currChNr&&this.currChNr>=0?(l=this.channels[this.currChNr-1],l.insertChars(c)):s.log("WARNING","No channel found yet. TEXT-MODE?")),n?this.dataCounters.cmd+=2:c?this.dataCounters.char+=2:(this.dataCounters.other+=2,s.log("WARNING","Couldn't parse cleaned data "+a([o,i])+" orig: "+a([t[r],t[r+1]])))):this.dataCounters.padding+=2},e.prototype.parseCmd=function(e,t){var n,o=null,i=(20===e||28===e)&&t>=32&&t<=47,r=(23===e||31===e)&&t>=33&&t<=35;return!(!i&&!r)&&(e===this.lastCmdA&&t===this.lastCmdB?(this.lastCmdA=null,this.lastCmdB=null,s.log("DEBUG","Repeated command ("+a([e,t])+") is dropped"),!0):(o=20===e||23===e?1:2,n=this.channels[o-1],20===e||28===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=o,!0))},e.prototype.parseMidrow=function(e,t){var n=null;return(17===e||25===e)&&t>=32&&t<=47&&((n=17===e?1:2)!==this.currChNr?(s.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[n-1].ccMIDROW(t),s.log("DEBUG","MIDROW ("+a([e,t])+")"),!0))},e.prototype.parsePAC=function(e,t){var o,n=null,s=null,i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,a=(16===e||24===e)&&t>=64&&t<=95;return!(!i&&!a)&&(e===this.lastCmdA&&t===this.lastCmdB?(this.lastCmdA=null,this.lastCmdB=null,!0):(n=e<=23?1:2,s=t>=64&&t<=95?1===n?v[e]:m[e]:1===n?g[e]:f[e],o=this.interpretPAC(s,t),this.channels[n-1].setPAC(o),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0))},e.prototype.interpretPAC=function(e,t){var n=t,s={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,s.underline=1==(1&n),n<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(s.italics=!0,s.color="white"):s.indent=4*Math.floor((n-16)/2),s},e.prototype.parseChars=function(e,t){var i,c,r=null,o=null,n=null;return e>=25?(r=2,n=e-8):(r=1,n=e),n>=17&&n<=19?(i=t,i=17===n?t+80:18===n?t+112:t+144,s.log("INFO","Special char '"+d(i)+"' in channel "+r),o=[i]):e>=32&&e<=127&&(o=0===t?[e]:[e,t]),o&&(c=a(o),s.log("DEBUG","Char codes =  "+c.join(",")),this.lastCmdA=null,this.lastCmdB=null),o},e.prototype.parseBackgroundAttributes=function(e,t){var n=void 0,s=void 0,o=void 0,i=void 0,a=(16===e||24===e)&&t>=32&&t<=47,r=(23===e||31===e)&&t>=45&&t<=47;return!(!a&&!r)&&(n={},16===e||24===e?(s=Math.floor((t-32)/2),n.background=p[s],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),o=e<24?1:2,i=this.channels[o-1],i.setBkgData(n),this.lastCmdA=null,this.lastCmdB=null,!0)},e.prototype.reset=function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},e.prototype.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)},e}();t.a=y},function(e,t){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(t,n){s(this,e),this.timelineController=t,this.trackName=n,this.startTime=null,this.endTime=null,this.screen=null}return e.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},e.prototype.newCue=function(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},e}();t.a=o},function(e,t,n){"use strict";var i=n(26),a=n(5),s=function(e,t,n){return e.substr(n||0,t.length)===t},r=function(e){var t=parseInt(e.substr(-3)),n=parseInt(e.substr(-6,2)),s=parseInt(e.substr(-9,2)),o=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;return isNaN(t)||isNaN(n)||isNaN(s)||isNaN(o)?-1:(t+=1e3*n,t+=6e4*s,t+=36e5*o)},o=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()},c=function(e,t,n){var s=e[t],o=e[s.prevCC];if(!o||!o.new&&s.new)return e.ccOffset=e.presentationOffset=s.start,void(s.new=!1);for(;o&&o.new;)e.ccOffset+=s.start-o.start,s.new=!1,s=o,o=e[s.prevCC];e.presentationOffset=n},l={parse:function(e,t,n,l,d,u){var y=/\r\n|\n\r|\n|\r/g,_=Object(a.b)(new Uint8Array(e)).trim().replace(y,`
`).split(`
`),b="00:00.000",g=0,h=0,p=0,j=[],m=void 0,v=!0,f=new i.a;f.oncue=function(e){var s=n[l],t=n.ccOffset;s&&s.new&&(void 0!==h?t=n.ccOffset=s.start:c(n,l,p)),p&&(t=p+n.ccOffset-n.presentationOffset),e.startTime+=t-h,e.endTime+=t-h,e.id=o(e.startTime.toString())+o(e.endTime.toString())+o(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&j.push(e)},f.onparsingerror=function(e){m=e},f.onflush=function(){if(m&&u)return void u(m);d(j)},_.forEach(function(e){if(v){if(s(e,"X-TIMESTAMP-MAP=")){v=!1,e.substr(16).split(",").forEach(function(e){s(e,"LOCAL:")?b=e.substr(6):s(e,"MPEGTS:")&&(g=parseInt(e.substr(7)))});try{t=t<0?t+8589934592:t,g-=t,h=r(b)/1e3,p=g/9e4,-1===h&&(m=new Error("Malformed X-TIMESTAMP-MAP: "+e))}catch{m=new Error("Malformed X-TIMESTAMP-MAP: "+e)}return}""===e&&(v=!1)}f.parse(e+`
`)}),f.flush()}};t.a=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){for(var n=[],t=0;t<e.length;t++)"subtitles"===e[t].kind&&n.push(e[t]);return n}var s=n(1),a=n(3),o=n(0),d=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),u=function(e){function t(n){r(this,t);var o=c(this,e.call(this,n,s.a.MEDIA_ATTACHED,s.a.MEDIA_DETACHING,s.a.MANIFEST_LOADING,s.a.MANIFEST_LOADED,s.a.SUBTITLE_TRACK_LOADED));return o.tracks=[],o.trackId=-1,o.media=void 0,o.subtitleDisplay=!1,o}return l(t,e),t.prototype._onTextTracksChanged=function(){if(this.media){for(var t=-1,n=i(this.media.textTracks),e=0;e<n.length;e++)if("hidden"===n[e].mode)t=e;else if("showing"===n[e].mode){t=e;break}this.subtitleTrack=t}},t.prototype.destroy=function(){a.a.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(void 0!==this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},t.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=void 0)},t.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},t.prototype.onManifestLoaded=function(e){var t=this,n=e.subtitles||[];this.tracks=n,this.trackId=-1,this.hls.trigger(s.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:n}),n.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})},t.prototype.onTick=function(){var n,e=this.trackId,t=this.tracks[e];t&&(n=t.details,void 0!==n&&!0!==n.live||(o.b.log("(re)loading playlist for subtitle track "+e),this.hls.trigger(s.a.SUBTITLE_TRACK_LOADING,{url:t.url,id:e})))},t.prototype.onSubtitleTrackLoaded=function(e){var t=this;e.id<this.tracks.length&&(o.b.log("subtitle track "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(function(){t.onTick()},1e3*e.details.targetduration,this)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))},t.prototype.setSubtitleTrackInternal=function(e){if(!(e<-1||e>=this.tracks.length)){this.timer&&(clearInterval(this.timer),this.timer=null);var n,a,t=i(this.media.textTracks);-1!==this.trackId&&(t[this.trackId].mode="disabled"),this.trackId=e,o.b.log("switching to subtitle track "+e),this.hls.trigger(s.a.SUBTITLE_TRACK_SWITCH,{id:e}),-1!==e&&(n=this.tracks[e],e<t.length&&(t[e].mode=this.subtitleDisplay?"showing":"hidden"),a=n.details,void 0!==a&&!0!==a.live||(o.b.log("(re)loading playlist for subtitle track "+e),this.hls.trigger(s.a.SUBTITLE_TRACK_LOADING,{url:n.url,id:e})))}},d(t,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&this.setSubtitleTrackInternal(e)}}]),t}(a.a);t.a=u},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(1),i=n(0),l=n(11),d=n(13),o={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"},u=function(e){function t(n){a(this,t);var i=r(this,e.call(this,n,s.a.MEDIA_ATTACHED,s.a.ERROR,s.a.KEY_LOADED,s.a.FRAG_LOADED,s.a.SUBTITLE_TRACKS_UPDATED,s.a.SUBTITLE_TRACK_SWITCH,s.a.SUBTITLE_TRACK_LOADED,s.a.SUBTITLE_FRAG_PROCESSED));return i.config=n.config,i.vttFragSNsProcessed={},i.vttFragQueues=void 0,i.currentlyProcessing=null,i.state=o.STOPPED,i.currentTrackId=-1,i.decrypter=new l.a(n.observer,n.config),i}return c(t,e),t.prototype.onHandlerDestroyed=function(){this.state=o.STOPPED},t.prototype.clearVttFragQueues=function(){var e=this;this.vttFragQueues={},this.tracks.forEach(function(t){e.vttFragQueues[t.id]=[]})},t.prototype.nextFrag=function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var e=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=e,this.hls.trigger(s.a.FRAG_LOADING,{frag:e}),this.state=o.FRAG_LOADING}},t.prototype.onSubtitleFragProcessed=function(e){e.success&&this.vttFragSNsProcessed[e.frag.trackId].push(e.frag.sn),this.currentlyProcessing=null,this.state=o.IDLE,this.nextFrag()},t.prototype.onMediaAttached=function(){this.state=o.IDLE},t.prototype.onError=function(e){var t=e.frag;t&&"subtitle"!==t.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},t.prototype.doTick=function(){switch(t=this,this.state){case o.IDLE:var t,a,n=this.tracks,e=this.currentTrackId,c=this.vttFragSNsProcessed[e],r=this.vttFragQueues[e],l=this.currentlyProcessing?this.currentlyProcessing.sn:-1,d=function(e){return c.indexOf(e.sn)>-1},u=function(e){return r.some(function(t){return t.sn===e.sn})};if(!n)break;if(e<n.length&&(a=n[e].details),void 0===a)break;a.fragments.forEach(function(n){d(n)||n.sn===l||u(n)||(n.decryptdata&&null!=n.decryptdata.uri&&null==n.decryptdata.key?(i.b.log("Loading key for "+n.sn),t.state=o.KEY_LOADING,t.hls.trigger(s.a.KEY_LOADING,{frag:n})):(n.trackId=e,r.push(n),t.nextFrag()))})}},t.prototype.onSubtitleTracksUpdated=function(e){var t=this;i.b.log("subtitle tracks updated"),this.tracks=e.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(e){t.vttFragSNsProcessed[e.id]=[]})},t.prototype.onSubtitleTrackSwitch=function(e){this.currentTrackId=e.id,-1!==this.currentTrackId&&void 0!==this.tracks[this.currentTrackId].details&&this.tick()},t.prototype.onSubtitleTrackLoaded=function(){this.tick()},t.prototype.onKeyLoaded=function(){this.state===o.KEY_LOADING&&(this.state=o.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var n,i=this.fragCurrent,t=e.frag.decryptdata,a=e.frag,r=this.hls;if(this.state===o.FRAG_LOADING&&i&&"subtitle"===e.frag.type&&i.sn===e.frag.sn&&e.payload.byteLength>0&&t!=null&&null!=t.key&&"AES-128"===t.method){n=void 0;try{n=performance.now()}catch{n=Date.now()}this.decrypter.decrypt(e.payload,t.key.buffer,t.iv.buffer,function(e){var t=void 0;try{t=performance.now()}catch{t=Date.now()}r.trigger(s.a.FRAG_DECRYPTED,{frag:a,payload:e,stats:{tstart:n,tdecrypt:t}})})}},t}(d.a);t.a=u},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var d=n(3),i=n(1),o=n(2),s=n(0),u=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),a={WIDEVINE:"com.widevine.alpha",PLAYREADY:"com.microsoft.playready"},h=function(e,t){var s={videoCapabilities:[]};return t.forEach(function(e){s.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})}),[s]},m=function(e,t,n){switch(e){case a.WIDEVINE:return h(0,n);default:throw Error("Unknown key-system: "+e)}},f=function(e){function t(n){r(this,t);var s=c(this,e.call(this,n,i.a.MEDIA_ATTACHED,i.a.MANIFEST_PARSED));return s._widevineLicenseUrl=n.config.widevineLicenseUrl,s._licenseXhrSetup=n.config.licenseXhrSetup,s._emeEnabled=n.config.emeEnabled,s._requestMediaKeySystemAccess=n.config.requestMediaKeySystemAccessFunc,s._mediaKeysList=[],s._media=null,s._hasSetMediaKeys=!1,s._isMediaEncrypted=!1,s._requestLicenseFailureCount=0,s}return l(t,e),t.prototype.getLicenseServerUrl=function(e){var t=void 0;switch(e){case a.WIDEVINE:t=this._widevineLicenseUrl;break;default:t=null}return t||(s.b.error('No license server URL configured for key-system "'+e+'"'),this.hls.trigger(i.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),t},t.prototype._attemptKeySystemAccess=function(e,t,n){var i=this,o=m(e,0,n);if(!o)return void s.b.warn("Can not create config for key-system (maybe because platform is not supported):",e);s.b.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(e,o).then(function(t){i._onMediaKeySystemAccessObtained(e,t)}).catch(function(t){s.b.error('Failed to obtain key-system "'+e+'" access:',t)})},t.prototype._onMediaKeySystemAccessObtained=function(e,t){var n,o=this;s.b.log('Access for key-system "'+e+'" obtained'),n={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e},this._mediaKeysList.push(n),t.createMediaKeys().then(function(t){n.mediaKeys=t,s.b.log('Media-keys created for key-system "'+e+'"'),o._onMediaKeysCreated()}).catch(function(e){s.b.error("Failed to create media-keys:",e)})},t.prototype._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},t.prototype._onNewMediaKeySession=function(e){var t=this;s.b.log("New key-system session "+e.sessionId),e.addEventListener("message",function(n){t._onKeySessionMessage(e,n.message)},!1)},t.prototype._onKeySessionMessage=function(e,t){s.b.log("Got EME message event, creating license request"),this._requestLicense(t,function(t){s.b.log("Received license data, updating key-session"),e.update(t)})},t.prototype._onMediaEncrypted=function(e,t){s.b.log('Media is encrypted using "'+e+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=e,this._mediaEncryptionInitData=t,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},t.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return s.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(i.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_NO_KEYS,fatal:!0});s.b.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},t.prototype._generateRequestWithPreferredKeySession=function(){var t,n,a,r=this,e=this._mediaKeysList[0];if(!e)return s.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(i.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(e.mediaKeysSessionInitialized)return void s.b.warn("Key-Session already initialized but requested again");t=e.mediaKeysSession,t||(s.b.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(i.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_NO_SESSION,fatal:!0})),n=this._mediaEncryptionInitDataType,a=this._mediaEncryptionInitData,s.b.log('Generating key-session request for "'+n+'" init data type'),e.mediaKeysSessionInitialized=!0,t.generateRequest(n,a).then(function(){s.b.debug("Key-session generation succeeded")}).catch(function(e){s.b.error("Error generating key-session request:",e),r.hls.trigger(i.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_NO_SESSION,fatal:!1})})},t.prototype._createLicenseXhr=function(e,t,n){var a=new XMLHttpRequest,r=this._licenseXhrSetup;try{if(r)try{r(a,e)}catch{a.open("POST",e,!0),r(a,e)}a.readyState||a.open("POST",e,!0)}catch(e){return s.b.error("Error setting up key-system license XHR",e),void this.hls.trigger(i.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return a.responseType="arraybuffer",a.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,a,e,t,n),a},t.prototype._onLicenseRequestReadyStageChange=function(e,t,n,a){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,s.b.log("License request succeeded"),a(e.response);else{if(s.b.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),++this._requestLicenseFailureCount<=3){var r=3-this._requestLicenseFailureCount+1;return s.b.warn("Retrying license request, "+r+" attempts left"),void this._requestLicense(n,a)}this.hls.trigger(i.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},t.prototype._generateLicenseRequestChallenge=function(e,t){var n=void 0;return e.mediaKeySystemDomain===a.PLAYREADY?s.b.error("PlayReady is not supported (yet)"):e.mediaKeySystemDomain===a.WIDEVINE?n=t:s.b.error("Unsupported key-system:",e.mediaKeySystemDomain),n},t.prototype._requestLicense=function(e,t){if(s.b.log("Requesting content license for key-system"),n=this._mediaKeysList[0],!n)return s.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(i.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});var n,a=this.getLicenseServerUrl(n.mediaKeySystemDomain),r=this._createLicenseXhr(a,e,t);s.b.log("Sending license request to URL: "+a),r.send(this._generateLicenseRequestChallenge(n,e))},t.prototype.onMediaAttached=function(e){var t,n=this;this._emeEnabled&&(t=e.media,this._media=t,t.addEventListener("encrypted",function(e){n._onMediaEncrypted(e.initDataType,e.initData)}))},t.prototype.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map(function(e){return e.audioCodec}),n=e.levels.map(function(e){return e.videoCodec});this._attemptKeySystemAccess(a.WIDEVINE,t,n)}},u(t,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),t}(d.a);t.a=f},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var s=function(){return"undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null}()},function(){String.prototype.endsWith||function(){"use strict";var e=function(){try{var e={},t=Object.defineProperty,n=t(e,e,e)&&t}catch{}return n}(),n={}.toString,t=function(e){if(null==this)throw TypeError();if(i=String(this),e&&"[object RegExp]"==n.call(e))throw TypeError();var s,o,i,a,d,r=i.length,c=String(e),l=c.length,t=r;if(arguments.length>1&&(s=arguments[1],void 0!==s&&(t=s?Number(s):0)!=t&&(t=0)),d=Math.min(Math.max(t,0),r),a=d-l,a<0)return!1;for(o=-1;++o<l;)if(i.charCodeAt(a+o)!=c.charCodeAt(o))return!1;return!0};e?e(String.prototype,"endsWith",{value:t,configurable:!0,writable:!0}):String.prototype.endsWith=t}()}]).default})